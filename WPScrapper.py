import base64
import sys

ENCRYPTED_CODE = """
IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMw0KIyBNYXNzIFdvcmRwcmVzcyBTY3JhcHBlciAtIERldmVsb3BlZCBieSBSZWRIeWRyYQ0KIyBBbiBhZHZhbmNlZCBkaXNjb3ZlcnkgdG9vbCB3aXRoIGEgY29uY3VycmVudCBkb3JrIGFuZCBzdWJkb21haW4gc2Nhbm5pbmcgZW5naW5lLg0KIyBDb21wYXRpYmxlIHdpdGggV2luZG93cyBhbmQgTGludXgNCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KaW1wb3J0IHRpbWUNCmltcG9ydCBxdWV1ZQ0KaW1wb3J0IHJhbmRvbQ0KaW1wb3J0IGFzeW5jaW8NCmltcG9ydCB0aHJlYWRpbmcNCmltcG9ydCB0cmFjZWJhY2sNCmltcG9ydCB3ZWJicm93c2VyDQppbXBvcnQgcmUNCmltcG9ydCBodG1sDQppbXBvcnQgYmFzZTY0DQpmcm9tIGhhc2hsaWIgaW1wb3J0IHNoYTI1Ng0KZnJvbSB1cmxsaWIucGFyc2UgaW1wb3J0IHVybHBhcnNlLCBxdW90ZSwgdXJsam9pbg0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUNCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0LCBUdXBsZSwgU2V0DQppbXBvcnQgcGxhdGZvcm0NCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgbG9nZ2luZw0KDQojIFN1cHByZXNzIGFpb2h0dHAgd2FybmluZ3MNCmxvZ2dpbmcuZ2V0TG9nZ2VyKCJhaW9odHRwIikuc2V0TGV2ZWwobG9nZ2luZy5FUlJPUikNCg0KIyBGaXggZm9yIExpbnV4IGVudmlyb25tZW50IHZhcmlhYmxlcyB3aGVuIHJ1bm5pbmcgYXMgcm9vdA0KaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIkxpbnV4IjoNCiAgICAjIFNldCBYREdfUlVOVElNRV9ESVIgaWYgbm90IHNldA0KICAgIGlmICdYREdfUlVOVElNRV9ESVInIG5vdCBpbiBvcy5lbnZpcm9uOg0KICAgICAgICBydW50aW1lX2RpciA9ICcvdG1wL3J1bnRpbWUtcm9vdCcNCiAgICAgICAgb3MuZW52aXJvblsnWERHX1JVTlRJTUVfRElSJ10gPSBydW50aW1lX2Rpcg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBvcy5tYWtlZGlycyhydW50aW1lX2RpciwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICAgICAgICAgIG9zLmNobW9kKHJ1bnRpbWVfZGlyLCAwbzcwMCkNCiAgICAgICAgICAgIHByaW50KGYiW0lORk9dIFhER19SVU5USU1FX0RJUiBzZXQgdG8ge3J1bnRpbWVfZGlyfSIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHByaW50KGYiW1dBUk5JTkddIENvdWxkIG5vdCBzZXQgWERHX1JVTlRJTUVfRElSOiB7ZX0iKQ0KICAgIA0KICAgICMgU2V0IERJU1BMQVkgaWYgbm90IHNldA0KICAgIGlmICdESVNQTEFZJyBub3QgaW4gb3MuZW52aXJvbjoNCiAgICAgICAgb3MuZW52aXJvblsnRElTUExBWSddID0gJzowJw0KICAgICAgICBwcmludCgiW0lORk9dIERJU1BMQVkgc2V0IHRvIDowIikNCiAgICANCiAgICAjIFRyeSB0byBzdGFydCBhIHZpcnR1YWwgZGlzcGxheSBpZiBuZWVkZWQNCiAgICB0cnk6DQogICAgICAgIGlmIG5vdCBvcy5lbnZpcm9uLmdldCgnRElTUExBWScpIG9yIG5vdCBvcy5wYXRoLmV4aXN0cygnL3RtcC8uWDExLXVuaXgvWDAnKToNCiAgICAgICAgICAgIHByaW50KCJbSU5GT10gU3RhcnRpbmcgdmlydHVhbCBkaXNwbGF5Li4uIikNCiAgICAgICAgICAgIHN1YnByb2Nlc3MuUG9wZW4oWydYdmZiJywgJzowJywgJy1zY3JlZW4nLCAnMCcsICcxMjgweDEwMjR4MjQnLCAnLWFjJ10pDQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIEdpdmUgWHZmYiB0aW1lIHRvIHN0YXJ0DQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIltXQVJOSU5HXSBDb3VsZCBub3Qgc3RhcnQgdmlydHVhbCBkaXNwbGF5OiB7ZX0iKQ0KDQojIFJlcXVpcmVkIGltcG9ydHMgZm9yIFN1YmRvbWFpbiBTY2FubmVyDQp0cnk6DQogICAgaW1wb3J0IGFpb2Rucw0KICAgIGltcG9ydCBhaW9odHRwDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgcHJpbnQoIlBsZWFzZSBpbnN0YWxsIHJlcXVpcmVkIGxpYnJhcmllczogcGlwIGluc3RhbGwgYWlvZG5zIGFpb2h0dHAiKQ0KICAgIHN5cy5leGl0KDEpDQoNCiMgUmVxdWlyZWQgZm9yIHNlYXJjaCBmdW5jdGlvbmFsaXR5DQp0cnk6DQogICAgZnJvbSBkZGdzIGltcG9ydCBEREdTDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgcHJpbnQoIlBsZWFzZSBpbnN0YWxsIHRoZSByZXF1aXJlZCBzZWFyY2ggbGlicmFyeTogcGlwIGluc3RhbGwgZGRncyIpDQogICAgc3lzLmV4aXQoMSkNCg0KIyBSZXF1aXJlZCBpbXBvcnRzIGZvciBQeVF0NSBVSQ0KZnJvbSBQeVF0NS5RdFdpZGdldHMgaW1wb3J0IChRQXBwbGljYXRpb24sIFFNYWluV2luZG93LCBRV2lkZ2V0LCBRVkJveExheW91dCwgUUhCb3hMYXlvdXQsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFHcm91cEJveCwgUUZvcm1MYXlvdXQsIFFMYWJlbCwgUUxpbmVFZGl0LCBRUHVzaEJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUVRleHRFZGl0LCBRVGFiV2lkZ2V0LCBRVGFibGVXaWRnZXQsIFFUYWJsZVdpZGdldEl0ZW0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFDaGVja0JveCwgUVNwaW5Cb3gsIFFDb21ib0JveCwgUUZpbGVEaWFsb2csIFFNZXNzYWdlQm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBRUHJvZ3Jlc3NCYXIsIFFTY3JvbGxBcmVhLCBRU3BsaXR0ZXIsIFFUb29sVGlwLCBRRnJhbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFTaXplUG9saWN5LCBRSGVhZGVyVmlldywgUUFic3RyYWN0SXRlbVZpZXcsIFFTdGF0dXNCYXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFUb29sQnV0dG9uLCBRU3R5bGUsIFFNZW51LCBRQWN0aW9uLCBRR3JhcGhpY3NEcm9wU2hhZG93RWZmZWN0KQ0KZnJvbSBQeVF0NS5RdENvcmUgaW1wb3J0IChRT2JqZWN0LCBweXF0U2lnbmFsLCBRVGhyZWFkLCBRRXZlbnRMb29wLCBRVGltZXIsIFF0KQ0KZnJvbSBQeVF0NS5RdEd1aSBpbXBvcnQgKFFGb250LCBRUGFsZXR0ZSwgUUNvbG9yLCBRQnJ1c2gsIFFMaW5lYXJHcmFkaWVudCwgUUljb24sDQogICAgICAgICAgICAgICAgICAgICAgICAgUUN1cnNvciwgUUludFZhbGlkYXRvciwgUURvdWJsZVZhbGlkYXRvciwgUUZvbnRNZXRyaWNzLA0KICAgICAgICAgICAgICAgICAgICAgICAgIFFLZXlTZXF1ZW5jZSwgUUNsaXBib2FyZCwgUVRleHRDdXJzb3IsIFFQaXhtYXApDQoNCiMgUmVxdWlyZWQgaW1wb3J0cyBmb3IgY29sb3JlZCBjb25zb2xlIG91dHB1dA0KZnJvbSBjb2xvcmFtYSBpbXBvcnQgaW5pdCwgRm9yZQ0KDQojIFJlcXVpcmVkIGZvciBBSSBmZWF0dXJlcw0KdHJ5Og0KICAgIGltcG9ydCBnb29nbGUuZ2VuZXJhdGl2ZWFpIGFzIGdlbmFpDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgZ2VuYWkgPSBOb25lDQoNCiMgSW5pdGlhbGl6ZSBjb2xvcmFtYSBmb3IgY3Jvc3MtcGxhdGZvcm0gY29sb3JlZCBvdXRwdXQNCmluaXQoYXV0b3Jlc2V0PVRydWUpDQoNCmNsYXNzIFJhdGVMaW1pdGVyOg0KICAgICIiIkEgc2ltcGxlIHJhdGUgbGltaXRlciB0byBhdm9pZCBvdmVyd2hlbG1pbmcgc2VydmljZXMuIiIiDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHJlcXVlc3RzX3Blcl9wZXJpb2Q6IGludCwgcGVyaW9kX3NlY29uZHM6IGludCk6DQogICAgICAgIHNlbGYucmVxdWVzdHNfcGVyX3BlcmlvZCA9IHJlcXVlc3RzX3Blcl9wZXJpb2QNCiAgICAgICAgc2VsZi5wZXJpb2Rfc2Vjb25kcyA9IHBlcmlvZF9zZWNvbmRzDQogICAgICAgIHNlbGYucmVxdWVzdF90aW1lc3RhbXBzID0gW10NCiAgICAgICAgc2VsZi5sb2NrID0gdGhyZWFkaW5nLkxvY2soKQ0KDQogICAgYXN5bmMgZGVmIHdhaXQoc2VsZik6DQogICAgICAgICIiIldhaXRzIGlmIG5lY2Vzc2FyeSB0byByZXNwZWN0IHRoZSByYXRlIGxpbWl0LiIiIg0KICAgICAgICB3aXRoIHNlbGYubG9jazoNCiAgICAgICAgICAgIG5vdyA9IHRpbWUubW9ub3RvbmljKCkNCiAgICAgICAgICAgIHNlbGYucmVxdWVzdF90aW1lc3RhbXBzID0gW3QgZm9yIHQgaW4gc2VsZi5yZXF1ZXN0X3RpbWVzdGFtcHMgaWYgbm93IC0gdCA8IHNlbGYucGVyaW9kX3NlY29uZHNdDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJlcXVlc3RfdGltZXN0YW1wcykgPj0gc2VsZi5yZXF1ZXN0c19wZXJfcGVyaW9kOg0KICAgICAgICAgICAgICAgIHdhaXRfdGltZSA9IHNlbGYucGVyaW9kX3NlY29uZHMgLSAobm93IC0gc2VsZi5yZXF1ZXN0X3RpbWVzdGFtcHNbMF0pDQogICAgICAgICAgICAgICAgaWYgd2FpdF90aW1lID4gMDoNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCh3YWl0X3RpbWUpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYucmVxdWVzdF90aW1lc3RhbXBzLmFwcGVuZCh0aW1lLm1vbm90b25pYygpKQ0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT0gU3ViZG9tYWluIFNjYW5uZXIgSW50ZWdyYXRpb24gPT09PT09PT09PT09PT09PT09PT0NCg0KY2xhc3MgRG5zQ2xpZW50Og0KICAgICIiIkFzeW5jIEROUyBjbGllbnQgd2l0aCBjYWNoaW5nLiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0aW1lb3V0OiBmbG9hdCA9IDIuMCk6DQogICAgICAgIHNlbGYucmVzb2x2ZXIgPSBhaW9kbnMuRE5TUmVzb2x2ZXIodGltZW91dD10aW1lb3V0LCB0cmllcz0yKQ0KICAgICAgICBzZWxmLmNhY2hlID0ge30NCiAgICAgICAgc2VsZi5zZW0gPSBhc3luY2lvLlNlbWFwaG9yZSg1MDApDQoNCiAgICBhc3luYyBkZWYgcmVzb2x2ZV9hbGwoc2VsZiwgZnFkbjogc3RyKSAtPiBEaWN0W3N0ciwgQW55XToNCiAgICAgICAgaWYgZnFkbiBpbiBzZWxmLmNhY2hlOiByZXR1cm4gc2VsZi5jYWNoZVtmcWRuXQ0KICAgICAgICBhc3luYyB3aXRoIHNlbGYuc2VtOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFfcmVjb3Jkc190YXNrID0gc2VsZi5yZXNvbHZlci5xdWVyeShmcWRuLCAiQSIpDQogICAgICAgICAgICAgICAgY25hbWVfcmVjb3JkX3Rhc2sgPSBzZWxmLnJlc29sdmVyLnF1ZXJ5KGZxZG4sICJDTkFNRSIpDQogICAgICAgICAgICAgICAgYV9yZWNvcmRzLCBjbmFtZV9yZWNvcmQgPSBhd2FpdCBhc3luY2lvLmdhdGhlcihhX3JlY29yZHNfdGFzaywgY25hbWVfcmVjb3JkX3Rhc2ssIHJldHVybl9leGNlcHRpb25zPVRydWUpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmVzID0gew0KICAgICAgICAgICAgICAgICAgICAiQSI6IFtyLmhvc3QgZm9yIHIgaW4gYV9yZWNvcmRzXSBpZiBub3QgaXNpbnN0YW5jZShhX3JlY29yZHMsIEV4Y2VwdGlvbikgZWxzZSBbXSwNCiAgICAgICAgICAgICAgICAgICAgIkNOQU1FIjogY25hbWVfcmVjb3JkLmNuYW1lIGlmIG5vdCBpc2luc3RhbmNlKGNuYW1lX3JlY29yZCwgRXhjZXB0aW9uKSBhbmQgY25hbWVfcmVjb3JkIGVsc2UgTm9uZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgcmVzID0geyJBIjogW10sICJDTkFNRSI6IE5vbmV9DQogICAgICAgICAgICBzZWxmLmNhY2hlW2ZxZG5dID0gcmVzDQogICAgICAgICAgICByZXR1cm4gcmVzDQoNCmNsYXNzIEh0dHBDbGllbnQ6DQogICAgIiIiQXN5bmMgSFRUUCBjbGllbnQgZm9yIHByb2JpbmcgV29yZFByZXNzIHNpdGVzIHdpdGggaW1wcm92ZWQgZXJyb3IgaGFuZGxpbmcuIiIiDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHZlcmlmeV90bHM6IGJvb2wsIG1heF9jb25jOiBpbnQgPSAxMDApOg0KICAgICAgICBzZWxmLnNlbSA9IGFzeW5jaW8uU2VtYXBob3JlKG1heF9jb25jKQ0KICAgICAgICBzZWxmLnRpbWVvdXQgPSBhaW9odHRwLkNsaWVudFRpbWVvdXQodG90YWw9MTAuMCwgY29ubmVjdD01LjApDQogICAgICAgICMgQ3VzdG9tIGNvbm5lY3RvciB3aXRoIGJldHRlciBlcnJvciBoYW5kbGluZw0KICAgICAgICBjb25uZWN0b3IgPSBhaW9odHRwLlRDUENvbm5lY3RvcigNCiAgICAgICAgICAgIHNzbD12ZXJpZnlfdGxzLA0KICAgICAgICAgICAgZm9yY2VfY2xvc2U9VHJ1ZSwNCiAgICAgICAgICAgIGVuYWJsZV9jbGVhbnVwX2Nsb3NlZD1UcnVlLA0KICAgICAgICAgICAgbGltaXRfcGVyX2hvc3Q9MTANCiAgICAgICAgKQ0KICAgICAgICAjIEN1c3RvbSBoZWFkZXJzIHRvIGF2b2lkIHNvbWUgY29tbW9uIGlzc3Vlcw0KICAgICAgICBoZWFkZXJzID0gew0KICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgU2FmYXJpLzUzNy4zNicsDQogICAgICAgICAgICAnQWNjZXB0JzogJ3RleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsKi8qO3E9MC44JywNCiAgICAgICAgICAgICdBY2NlcHQtTGFuZ3VhZ2UnOiAnZW4tVVMsZW47cT0wLjUnLA0KICAgICAgICAgICAgJ0FjY2VwdC1FbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywNCiAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLA0KICAgICAgICAgICAgJ1VwZ3JhZGUtSW5zZWN1cmUtUmVxdWVzdHMnOiAnMScNCiAgICAgICAgfQ0KICAgICAgICBzZWxmLnNlc3Npb24gPSBhaW9odHRwLkNsaWVudFNlc3Npb24oDQogICAgICAgICAgICB0aW1lb3V0PXNlbGYudGltZW91dCwgDQogICAgICAgICAgICB0cnVzdF9lbnY9VHJ1ZSwgDQogICAgICAgICAgICBjb25uZWN0b3I9Y29ubmVjdG9yLA0KICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzLA0KICAgICAgICAgICAgYXV0b19kZWNvbXByZXNzPUZhbHNlICAjIEhhbmRsZSBkZWNvbXByZXNzaW9uIG1hbnVhbGx5DQogICAgICAgICkNCg0KICAgIGFzeW5jIGRlZiBjbG9zZShzZWxmKToNCiAgICAgICAgIiIiQ2xvc2VzIHRoZSB1bmRlcmx5aW5nIGFpb2h0dHAgc2Vzc2lvbi4iIiINCiAgICAgICAgaWYgc2VsZi5zZXNzaW9uIGFuZCBub3Qgc2VsZi5zZXNzaW9uLmNsb3NlZDoNCiAgICAgICAgICAgIGF3YWl0IHNlbGYuc2Vzc2lvbi5jbG9zZSgpDQoNCiAgICBhc3luYyBkZWYgcHJvYmVfaG9zdChzZWxmLCBob3N0OiBzdHIpIC0+IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXToNCiAgICAgICAgZm9yIHNjaGVtZSwgcG9ydCBpbiBbKCJodHRwcyIsIDQ0MyksICgiaHR0cCIsIDgwKV06DQogICAgICAgICAgICB1cmwgPSBmIntzY2hlbWV9Oi8ve2hvc3R9Ontwb3J0fSINCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIHNlbGYuc2VtLCBzZWxmLnNlc3Npb24uZ2V0KHVybCwgYWxsb3dfcmVkaXJlY3RzPVRydWUsIHNzbD1GYWxzZSkgYXMgcjoNCiAgICAgICAgICAgICAgICAgICAgIyBTa2lwIGVtcHR5IHJlc3BvbnNlcyBhbmQgY29tbW9uIG5vbi1jb250ZW50IHN0YXR1c2VzDQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzIGluIFsyMDQsIDMwNF06DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICMgSGFuZGxlIGNvbnRlbnQgbGVuZ3RoDQogICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoID0gci5oZWFkZXJzLmdldCgnQ29udGVudC1MZW5ndGgnLCAnMCcpDQogICAgICAgICAgICAgICAgICAgIGlmIGNvbnRlbnRfbGVuZ3RoID09ICcwJyBhbmQgci5zdGF0dXMgPT0gMjAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBTb21lIHNlcnZlcnMgc2VuZCAyMDAgd2l0aCBlbXB0eSBjb250ZW50LCB0cnkgdG8gcmVhZCBhbnl3YXkNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICMgUmVhZCByZXNwb25zZSB3aXRoIGJldHRlciBlcnJvciBoYW5kbGluZw0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gYXdhaXQgci5yZWFkKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBIYW5kbGUgZW1wdHkgYm9keQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGJvZHk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICMgSGFuZGxlIGd6aXAgZGVjb21wcmVzc2lvbiBtYW51YWxseSBpZiBuZWVkZWQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHIuaGVhZGVycy5nZXQoJ0NvbnRlbnQtRW5jb2RpbmcnKSA9PSAnZ3ppcCc6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgZ3ppcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5ID0gZ3ppcC5kZWNvbXByZXNzKGJvZHkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIElmIGRlY29tcHJlc3Npb24gZmFpbHMsIGNvbnRpbnVlIHdpdGggcmF3IGJvZHkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX3dvcmRwcmVzc19zaXRlKGJvZHksIHN0cihyLnVybCkpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7InVybCI6IHN0cihyLnVybCksICJ0aXRsZSI6IHNlbGYuZXh0cmFjdF90aXRsZShib2R5KX0NCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiByZWFkaW5nIGZhaWxzLCBjb250aW51ZSB0byBuZXh0IHNjaGVtZQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZXhjZXB0IChhaW9odHRwLkNsaWVudEVycm9yLCBhc3luY2lvLlRpbWVvdXRFcnJvcik6DQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBpc193b3JkcHJlc3Nfc2l0ZShzZWxmLCBib2R5OiBieXRlcywgdXJsOiBzdHIpIC0+IGJvb2w6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgQ29udmVydCB0byBzdHJpbmcgZm9yIGVhc2llciBzZWFyY2hpbmcNCiAgICAgICAgICAgIGJvZHlfc3RyID0gYm9keS5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKQ0KICAgICAgICAgICAgcmV0dXJuIGFueShpbmRpY2F0b3IgaW4gYm9keV9zdHIubG93ZXIoKSBmb3IgaW5kaWNhdG9yIGluIFsNCiAgICAgICAgICAgICAgICAnd3AtY29udGVudCcsICd3cC1pbmNsdWRlcycsICd3b3JkcHJlc3MnLCAnd3AtanNvbicNCiAgICAgICAgICAgIF0pIG9yIGFueShwYXRoIGluIHVybC5sb3dlcigpIGZvciBwYXRoIGluIFsnL3dwLWFkbWluJywgJy93cC1sb2dpbi5waHAnXSkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgIyBJZiBkZWNvZGluZyBmYWlscywgY2hlY2sgcmF3IGJ5dGVzDQogICAgICAgICAgICByZXR1cm4gYW55KGluZGljYXRvciBpbiBib2R5IGZvciBpbmRpY2F0b3IgaW4gWw0KICAgICAgICAgICAgICAgIGInd3AtY29udGVudCcsIGInd3AtaW5jbHVkZXMnLCBiJ1dvcmRQcmVzcycNCiAgICAgICAgICAgIF0pIG9yIGFueShwYXRoIGluIHVybCBmb3IgcGF0aCBpbiBbJy93cC1hZG1pbicsICcvd3AtbG9naW4ucGhwJ10pDQoNCiAgICBkZWYgZXh0cmFjdF90aXRsZShzZWxmLCBib2R5OiBieXRlcykgLT4gc3RyOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyYic8dGl0bGU+KC4qPyk8L3RpdGxlPicsIGJvZHksIHJlLkkgfCByZS5TKQ0KICAgICAgICAgICAgcmV0dXJuIGh0bWwudW5lc2NhcGUobWF0Y2guZ3JvdXAoMSkuZGVjb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkuc3RyaXAoKSBpZiBtYXRjaCBlbHNlICJObyBUaXRsZSINCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcmV0dXJuICJObyBUaXRsZSINCg0KY2xhc3MgR2VtaW5pU2VlZGVyOg0KICAgICIiIkdlbmVyYXRlcyBzdWJkb21haW4gYW5kIGRvcmsgY2FuZGlkYXRlcyB3aXRoIEdvb2dsZSBHZW1pbmkuIiIiDQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFwaV9rZXk6IHN0ciwgbW9kZWxfbmFtZTogc3RyKToNCiAgICAgICAgc2VsZi5hcGlfa2V5ID0gYXBpX2tleQ0KICAgICAgICBzZWxmLm1vZGVsX25hbWUgPSBtb2RlbF9uYW1lDQogICAgICAgIHNlbGYuX29rID0gRmFsc2UNCiAgICAgICAgc2VsZi5fbW9kZWwgPSBOb25lDQogICAgICAgIGlmIGdlbmFpIGFuZCBhcGlfa2V5Og0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGdlbmFpLmNvbmZpZ3VyZShhcGlfa2V5PWFwaV9rZXkpDQogICAgICAgICAgICAgICAgc2VsZi5fbW9kZWwgPSBnZW5haS5HZW5lcmF0aXZlTW9kZWwobW9kZWxfbmFtZSkNCiAgICAgICAgICAgICAgICBzZWxmLl9vayA9IFRydWUNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLllFTExPV31HZW1pbmkgY29uZmlndXJhdGlvbiBmYWlsZWQ6IHtlfSIpDQogICAgICAgIGVsaWYgbm90IGdlbmFpOg0KICAgICAgICAgICAgcHJpbnQoZiJ7Rm9yZS5ZRUxMT1d9R2VtaW5pIGRpc2FibGVkLiBgcGlwIGluc3RhbGwgZ29vZ2xlLWdlbmVyYXRpdmVhaWAgdG8gZW5hYmxlLiIpDQoNCiAgICBhc3luYyBkZWYgZ2VuZXJhdGVfZG9ya3Moc2VsZiwga2V5d29yZHM6IExpc3Rbc3RyXSwgY291bnQ6IGludCA9IDUwKSAtPiBTZXRbc3RyXToNCiAgICAgICAgaWYgbm90IHNlbGYuX29rOiByZXR1cm4gc2V0KCkNCiAgICAgICAga2V5d29yZF9zdHIgPSAiLCAiLmpvaW4oa2V5d29yZHMpDQogICAgICAgIHByb21wdCA9IChmIllvdSBhcmUgYSBjeWJlcnNlY3VyaXR5IGV4cGVydC4gR2VuZXJhdGUge2NvdW50fSBjcmVhdGl2ZSBHb29nbGUgRG9ya3MgdG8gZmluZCBXb3JkUHJlc3Mgd2Vic2l0ZXMgIg0KICAgICAgICAgICAgICAgICAgZiJyZWxhdGVkIHRvIHRoZXNlIGtleXdvcmRzOiAne2tleXdvcmRfc3RyfScuIENvbWJpbmUgb3BlcmF0b3JzIGxpa2UgaW51cmw6LCBpbnRpdGxlOiwgZXRjLiAiDQogICAgICAgICAgICAgICAgICBmIlJldHVybiBPTkxZIGEgZmxhdCwgbmV3bGluZS1zZXBhcmF0ZWQgbGlzdCBvZiB0aGUgZnVsbCBkb3JrIHN0cmluZ3MuIikNCiAgICAgICAgDQogICAgICAgIGRlZiBfcnVuKCk6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuX21vZGVsLmdlbmVyYXRlX2NvbnRlbnQocHJvbXB0LCByZXF1ZXN0X29wdGlvbnM9eyd0aW1lb3V0JzogMjB9KQ0KICAgICAgICAgICAgICAgIHJldHVybiB7ZG9yay5zdHJpcCgpIGZvciBkb3JrIGluIGdldGF0dHIocmVzcCwgInRleHQiLCAiIikuc3BsaXRsaW5lcygpIGlmIGRvcmsuc3RyaXAoKX0NCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLlJFRH1HZW1pbmkgZG9yayBnZW5lcmF0aW9uIGVycm9yOiB7ZX0iKQ0KICAgICAgICAgICAgICAgIHJldHVybiBzZXQoKQ0KICAgICAgICByZXR1cm4gYXdhaXQgYXN5bmNpby50b190aHJlYWQoX3J1bikNCg0KY2xhc3MgU3ViZG9tYWluU2Nhbm5lcjoNCiAgICAiIiJTY2FubmVyIGZvciBkaXNjb3ZlcmluZyBXb3JkUHJlc3Mgc2l0ZXMgYWNyb3NzIHN1YmRvbWFpbnMgdXNpbmcgbXVsdGlwbGUgbWV0aG9kcy4iIiINCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZmlnKToNCiAgICAgICAgc2VsZi5jb25maWcgPSBjb25maWcNCg0KICAgIGFzeW5jIGRlZiBkaXNjb3Zlcl93b3JkcHJlc3Nfc3ViZG9tYWlucyhzZWxmLCBkb21haW46IHN0ciwgaHR0cF9jbGllbnQ6IEh0dHBDbGllbnQsIGxvZ19iYXRjaDogbGlzdCwgbG9jazogYXN5bmNpby5Mb2NrKToNCiAgICAgICAgIiIiRmluZHMgc3ViZG9tYWlucyB1c2luZyBtdWx0aXBsZSBtZXRob2RzIGFuZCBwcm9iZXMgdGhlbSBmb3IgV29yZFByZXNzLiIiIg0KICAgICAgICBmb3VuZF9zdWJkb21haW5zID0gc2V0KCkNCiAgICAgICAgDQogICAgICAgICMgTWV0aG9kIDE6IGNydC5zaA0KICAgICAgICB0cnk6DQogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vY3J0LnNoLz9xPSUue2RvbWFpbn0mb3V0cHV0PWpzb24iDQogICAgICAgICAgICBhc3luYyB3aXRoIGh0dHBfY2xpZW50LnNlc3Npb24uZ2V0KHVybCwgdGltZW91dD0yMCkgYXMgcmVzcG9uc2U6DQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDIwMDoNCiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oY29udGVudF90eXBlPU5vbmUpDQogICAgICAgICAgICAgICAgICAgIGZvciBlbnRyeSBpbiBkYXRhOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZV92YWx1ZSA9IGVudHJ5LmdldCgnbmFtZV92YWx1ZScsICcnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3ViZG9tYWlucyA9IG5hbWVfdmFsdWUuc3BsaXQoJ1xuJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzdWIgaW4gc3ViZG9tYWluczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhbl9zdWIgPSBzdWIuc3RyaXAoKS5sb3dlcigpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2xlYW5fc3ViLmVuZHN3aXRoKGYnLntkb21haW59JykgYW5kICcqJyBub3QgaW4gY2xlYW5fc3ViOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF9zdWJkb21haW5zLmFkZChjbGVhbl9zdWIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgICAgICBsb2dfYmF0Y2guYXBwZW5kKGYiW0RJQUdOT1NUSUNdIGNydC5zaCBxdWVyeSBmb3Ige2RvbWFpbn0gZmFpbGVkOiB7cmVwcihlKX0uIFVzaW5nIGZhbGxiYWNrIG1ldGhvZHMuIikNCg0KICAgICAgICAjIE1ldGhvZCAyOiBFeHBhbmRlZCBiYXNlIHNlZWRzDQogICAgICAgIGJhc2Vfc2VlZHMgPSB7DQogICAgICAgICAgICAid3d3IiwgImJsb2ciLCAic2hvcCIsICJuZXdzIiwgInN0b3JlIiwgInBvcnRhbCIsICJkZXYiLCAic3RhZ2luZyIsDQogICAgICAgICAgICAiYXBpIiwgImFwcCIsICJhZG1pbiIsICJjZG4iLCAibWFpbCIsICJmdHAiLCAidGVzdCIsICJiYWNrdXAiLCAid2ViIiwNCiAgICAgICAgICAgICJ3ZWJtYWlsIiwgInNlY3VyZSIsICJtb2JpbGUiLCAibSIsICJzdGFnZSIsICJ1YXQiLCAiZGVtbyIsICJ0ZW1wIiwgDQogICAgICAgICAgICAiYmV0YSIsICJhbHBoYSIsICJjbG91ZCIsICJmaWxlcyIsICJtZWRpYSIsICJpbWFnZXMiLCAiaW1nIiwgInN0YXRpYyIsDQogICAgICAgICAgICAiYXNzZXRzIiwgImNvbnRlbnQiLCAiZG9jcyIsICJzdXBwb3J0IiwgImhlbHAiLCAiZm9ydW0iLCAiY29tbXVuaXR5IiwNCiAgICAgICAgICAgICJtZW1iZXJzIiwgInVzZXIiLCAidXNlcnMiLCAibG9naW4iLCAic2lnbmluIiwgInJlZ2lzdGVyIiwgInNpZ251cCIsIA0KICAgICAgICAgICAgImF1dGgiLCAicGF5bWVudCIsICJwYXltZW50cyIsICJjaGVja291dCIsICJjYXJ0IiwgIm9yZGVyIiwgIm9yZGVycyIsIA0KICAgICAgICAgICAgImFjY291bnQiLCAiYWNjb3VudHMiLCAicHJvZmlsZSIsICJkYXNoYm9hcmQiLCAiY3BhbmVsIiwgInBhbmVsIiwgIndwIiwgDQogICAgICAgICAgICAid3AtYWRtaW4iLCAiY21zIiwgImJhY2tlbmQiLCAiYmFjayIsICJmcm9udCIsICJmcm9udGVuZCIsICJzaXRlIiwgInNpdGVzIiwgDQogICAgICAgICAgICAiZGF0YSIsICJkYiIsICJkYXRhYmFzZSIsICJzcWwiLCAibXlzcWwiLCAicG9zdGdyZXMiLCAicmVkaXMiLCAiY2FjaGUiLCANCiAgICAgICAgICAgICJzZWFyY2giLCAiZWxhc3RpYyIsICJsb2ciLCAibG9ncyIsICJtb25pdG9yIiwgIm1vbml0b3JpbmciLCAic3RhdHMiLCANCiAgICAgICAgICAgICJhbmFseXRpY3MiLCAidHJhY2tpbmciLCAicmVwb3J0IiwgInJlcG9ydHMiLCAiYXBpMiIsICJhcHAyIiwgInYyIiwgInYzIiwgDQogICAgICAgICAgICAidmVyc2lvbjIiLCAidmVyc2lvbjMiLCAibmV3IiwgIm9sZCIsICJsZWdhY3kiLCAiYXJjaGl2ZSIsICJiYWNrdXAyIiwgDQogICAgICAgICAgICAiYmFja3VwMyIsICJzdGFnaW5nMiIsICJkZXYyIiwgImRldjMiLCAidGVzdDIiLCAidGVzdDMiLCAidGVtcDIiLCAidGVtcDMiLCANCiAgICAgICAgICAgICJiZXRhMiIsICJiZXRhMyIsICJhbHBoYTIiLCAiYWxwaGEzIiwgImdhbW1hIiwgImRlbHRhIiwgImVwc2lsb24iLCAiemV0YSIsIA0KICAgICAgICAgICAgImV0YSIsICJ0aGV0YSIsICJpb3RhIiwgImthcHBhIiwgImxhbWJkYSIsICJtdSIsICJudSIsICJ4aSIsICJvbWljcm9uIiwgDQogICAgICAgICAgICAicGkiLCAicmhvIiwgInNpZ21hIiwgInRhdSIsICJ1cHNpbG9uIiwgInBoaSIsICJjaGkiLCAicHNpIiwgIm9tZWdhIg0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmb3Igc2VlZCBpbiBiYXNlX3NlZWRzOg0KICAgICAgICAgICAgZm91bmRfc3ViZG9tYWlucy5hZGQoZiJ7c2VlZH0ue2RvbWFpbn0iKQ0KDQogICAgICAgICMgTWV0aG9kIDM6IENvbW1vbiBXb3JkUHJlc3MtcmVsYXRlZCBzdWJkb21haW5zDQogICAgICAgIHdwX3NlZWRzID0gew0KICAgICAgICAgICAgIndwIiwgIndwLWFkbWluIiwgIndwLWxvZ2luIiwgIndwLWNvbnRlbnQiLCAid3AtaW5jbHVkZXMiLCAid3AtanNvbiIsDQogICAgICAgICAgICAid29yZHByZXNzIiwgIndwMSIsICJ3cDIiLCAid3AzIiwgIndwNCIsICJ3cDUiLCAid3A2IiwgIndwNyIsICJ3cDgiLCAid3A5IiwNCiAgICAgICAgICAgICJ3cHRlc3QiLCAid3BkZXYiLCAid3BzdGFnZSIsICJ3cGxpdmUiLCAid3B0ZW1wIiwgIndwZGVtbyIsICJ3cHVhdCIsDQogICAgICAgICAgICAid3BiZXRhIiwgIndwYWxwaGEiLCAid3BnYW1tYSIsICJ3cHByb2QiLCAid3Bwcm9kdWN0aW9uIiwgIndwc2FuZGJveCINCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgZm9yIHNlZWQgaW4gd3Bfc2VlZHM6DQogICAgICAgICAgICBmb3VuZF9zdWJkb21haW5zLmFkZChmIntzZWVkfS57ZG9tYWlufSIpDQoNCiAgICAgICAgIyBNZXRob2QgNDogQ29tbW9uIHN1YmRvbWFpbiBlbnVtZXJhdGlvbiBwYXR0ZXJucw0KICAgICAgICBwYXR0ZXJucyA9IFsNCiAgICAgICAgICAgICJ7ZG9tYWlufS17dGxkfSIsICJ3d3cue2RvbWFpbn0iLCAibWFpbC57ZG9tYWlufSIsICJmdHAue2RvbWFpbn0iLA0KICAgICAgICAgICAgImxvY2FsaG9zdC57ZG9tYWlufSIsICJ3ZWJtYWlsLntkb21haW59IiwgInNtdHAue2RvbWFpbn0iLCAicG9wLntkb21haW59IiwNCiAgICAgICAgICAgICJuczEue2RvbWFpbn0iLCAibnMyLntkb21haW59IiwgImRucy57ZG9tYWlufSIsICJob3N0Lntkb21haW59Ig0KICAgICAgICBdDQogICAgICAgIA0KICAgICAgICB0bGQgPSBkb21haW4uc3BsaXQoJy4nKVstMV0NCiAgICAgICAgYmFzZV9kb21haW4gPSBkb21haW4ucmVwbGFjZShmIi57dGxkfSIsICIiKQ0KICAgICAgICANCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6DQogICAgICAgICAgICBzdWJkb21haW4gPSBwYXR0ZXJuLmZvcm1hdChkb21haW49YmFzZV9kb21haW4sIHRsZD10bGQpDQogICAgICAgICAgICBmb3VuZF9zdWJkb21haW5zLmFkZChzdWJkb21haW4pDQoNCiAgICAgICAgYXN5bmMgd2l0aCBsb2NrOg0KICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltESUFHTk9TVElDXSBGb3VuZCB7bGVuKGZvdW5kX3N1YmRvbWFpbnMpfSB0b3RhbCBjYW5kaWRhdGVzIGZvciB7ZG9tYWlufSB1c2luZyBtdWx0aXBsZSBtZXRob2RzLiIpDQoNCiAgICAgICAgaWYgbm90IGZvdW5kX3N1YmRvbWFpbnM6DQogICAgICAgICAgICByZXR1cm4ge30NCiAgICAgICAgDQogICAgICAgIGRuc19jbGllbnQgPSBEbnNDbGllbnQoKQ0KICAgICAgICB0YXNrcyA9IFtzZWxmLnByb2JlX2ZxZG4oZnFkbiwgZG5zX2NsaWVudCwgaHR0cF9jbGllbnQpIGZvciBmcWRuIGluIGZvdW5kX3N1YmRvbWFpbnNdDQogICAgICAgIHJlc3VsdHMgPSBhd2FpdCBhc3luY2lvLmdhdGhlcigqdGFza3MsIHJldHVybl9leGNlcHRpb25zPVRydWUpDQogICAgICAgIHJldHVybiB7ZnFkbjogaW5mbyBmb3IgZnFkbiwgaW5mbyBpbiByZXN1bHRzIGlmIGZxZG4gYW5kIGluZm99DQoNCiAgICBhc3luYyBkZWYgcHJvYmVfZnFkbihzZWxmLCBmcWRuOiBzdHIsIGRuc19jbGllbnQ6IERuc0NsaWVudCwgaHR0cF9jbGllbnQ6IEh0dHBDbGllbnQpIC0+IFR1cGxlW09wdGlvbmFsW3N0cl0sIE9wdGlvbmFsW0RpY3RdXToNCiAgICAgICAgIiIiQ2hlY2tzIGlmIGEgZnVsbHktcXVhbGlmaWVkIGRvbWFpbiBoYXMgRE5TIHJlY29yZHMgYW5kIGhvc3RzIGEgV29yZFByZXNzIHNpdGUuIiIiDQogICAgICAgIGRuc19pbmZvID0gYXdhaXQgZG5zX2NsaWVudC5yZXNvbHZlX2FsbChmcWRuKQ0KICAgICAgICBpZiBkbnNfaW5mbyBhbmQgZG5zX2luZm8uZ2V0KCJBIik6DQogICAgICAgICAgICBodHRwX2luZm8gPSBhd2FpdCBodHRwX2NsaWVudC5wcm9iZV9ob3N0KGZxZG4pDQogICAgICAgICAgICBpZiBodHRwX2luZm86DQogICAgICAgICAgICAgICAgcmV0dXJuIGZxZG4sIHsqKmRuc19pbmZvLCAqKmh0dHBfaW5mb30NCiAgICAgICAgcmV0dXJuIE5vbmUsIE5vbmUNCg0KIyA9PT09PT09PT09PT09PT09PT09PSBNYWluIEFwcGxpY2F0aW9uIExvZ2ljID09PT09PT09PT09PT09PT09PT09DQoNCmNsYXNzIFdvcmRQcmVzc1NjYW5uZXI6DQogICAgIiIiTWFpbiBXb3JkUHJlc3Mgc2Nhbm5lciBjbGFzcyB0aGF0IGhhbmRsZXMgZG9yayBnZW5lcmF0aW9uIGFuZCBzY2FubmluZy4iIiINCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZmlnPU5vbmUpOg0KICAgICAgICBzZWxmLmNvbmZpZyA9IGNvbmZpZyBvciBzZWxmLmxvYWRfZGVmYXVsdF9jb25maWcoKQ0KICAgICAgICBzZWxmLnJhdGVfbGltaXRlciA9IFJhdGVMaW1pdGVyKHJlcXVlc3RzX3Blcl9wZXJpb2Q9NSwgcGVyaW9kX3NlY29uZHM9MikNCiAgICAgICAgDQogICAgICAgIHNlbGYuZ2VtaW5pX3NlZWRlciA9IE5vbmUNCiAgICAgICAgaWYgc2VsZi5jb25maWcuZ2V0KCdnZW1pbmlfYXBpX2tleScpOg0KICAgICAgICAgICAgc2VsZi5nZW1pbmlfc2VlZGVyID0gR2VtaW5pU2VlZGVyKA0KICAgICAgICAgICAgICAgIHNlbGYuY29uZmlnWydnZW1pbmlfYXBpX2tleSddLCANCiAgICAgICAgICAgICAgICBzZWxmLmNvbmZpZy5nZXQoJ2dlbWluaV9tb2RlbCcsICdnZW1pbmktMS41LWZsYXNoLWxhdGVzdCcpDQogICAgICAgICAgICApDQogICAgICAgIA0KICAgICAgICBzZWxmLmRpc2NvdmVyZWRfdXJscyA9IFtdDQogICAgICAgIHNlbGYuZGlzY292ZXJlZF9kb21haW5zID0gW10NCiAgICAgICAgc2VsZi5zdWJkb21haW5fcmVzdWx0cyA9IHt9DQogICAgICAgIA0KICAgICAgICBzZWxmLmRlZmF1bHRfcGF0dGVybnMgPSBbDQogICAgICAgICAgICAnaW51cmw6d3AtY29udGVudCAie2tleXdvcmR9IicsICdpbnVybDp3cC1hZG1pbiAie2tleXdvcmR9IicsDQogICAgICAgICAgICAnaW51cmw6d3AtaW5jbHVkZXMgIntrZXl3b3JkfSInLCAnaW50aXRsZToiV29yZFByZXNzIiAie2tleXdvcmR9IicsDQogICAgICAgICAgICAnaW50ZXh0OiJwb3dlcmVkIGJ5IFdvcmRQcmVzcyIgIntrZXl3b3JkfSInLCAnaW51cmw6L3dwLWpzb24vd3AvdjIvdXNlcnMvJywNCiAgICAgICAgICAgICdzaXRlOntrZXl3b3JkfSAiVGhpcyBzaXRlIGlzIHJ1bm5pbmcgV29yZFByZXNzIicsDQogICAgICAgICAgICAnIntrZXl3b3JkfSIgZmlsZXR5cGU6bG9nIGludXJsOndwLWNvbnRlbnQvZGVidWcubG9nJywNCiAgICAgICAgICAgICdpbnRpdGxlOiJ7a2V5d29yZH0iICsgIkp1c3QgYW5vdGhlciBXb3JkUHJlc3Mgc2l0ZSInLA0KICAgICAgICAgICAgJ2ludXJsOiIvd3AtY29udGVudC91cGxvYWRzLyIgIntrZXl3b3JkfSInDQogICAgICAgIF0NCiAgICAgICAgc2VsZi5kb3JrcyA9IFtdDQogICAgDQogICAgZGVmIGxvYWRfZGVmYXVsdF9jb25maWcoc2VsZikgLT4gRGljdFtzdHIsIEFueV06DQogICAgICAgIGNvbmZpZ19maWxlID0gb3MucGF0aC5qb2luKCJjb25maWcuanNvbiIpDQogICAgICAgIGRlZmF1bHRfY29uZmlnID0gew0KICAgICAgICAgICAgInRpbWVvdXQiOiAxMCwgIm1heF93b3JrZXJzIjogNCwgImRlYnVnX21vZGUiOiBUcnVlLA0KICAgICAgICAgICAgInVybHNfZmlsZSI6IG9zLnBhdGguam9pbigicmVzdWx0cyIsICJ1cmxzLnR4dCIpLCANCiAgICAgICAgICAgICJkb21haW5zX2ZpbGUiOiBvcy5wYXRoLmpvaW4oInJlc3VsdHMiLCAiZG9tYWlucy50eHQiKSwNCiAgICAgICAgICAgICJzdWJkb21haW5zX2ZpbGUiOiBvcy5wYXRoLmpvaW4oInJlc3VsdHMiLCAic3ViZG9tYWlucy50eHQiKSwNCiAgICAgICAgICAgICJzdWJkb21haW5fc2NhbiI6IFRydWUsICJ2ZXJpZnlfdGxzIjogRmFsc2UsDQogICAgICAgICAgICAiZ2VtaW5pX2FwaV9rZXkiOiAiIiwgImdlbWluaV9tb2RlbCI6ICJnZW1pbmktMS41LWZsYXNoLWxhdGVzdCIsDQogICAgICAgICAgICAidXNlX2dlbWluaV9mb3JfZG9ya3MiOiBUcnVlDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGNvbmZpZ19maWxlKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnX2ZpbGUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgZGVmYXVsdF9jb25maWcudXBkYXRlKGNvbmZpZykNCiAgICAgICAgICAgIGV4Y2VwdCAoanNvbi5KU09ORGVjb2RlRXJyb3IsIElPRXJyb3IpOg0KICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0X2NvbmZpZw0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG9zLm1ha2VkaXJzKCJyZXN1bHRzIiwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnX2ZpbGUsICd3JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wKGRlZmF1bHRfY29uZmlnLCBmLCBpbmRlbnQ9NCkNCiAgICAgICAgICAgIGV4Y2VwdCBJT0Vycm9yOg0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnDQogICAgDQogICAgZGVmIGdlbmVyYXRlX2RvcmtzX2Zyb21fa2V5d29yZHMoc2VsZiwga2V5d29yZHM6IExpc3Rbc3RyXSwgcGF0dGVybnM6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lKToNCiAgICAgICAgcGF0dGVybnMgPSBwYXR0ZXJucyBvciBzZWxmLmRlZmF1bHRfcGF0dGVybnMNCiAgICAgICAgZG9ya3MgPSBzZXQoKQ0KICAgICAgICBmb3Iga2V5d29yZCBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGZvciBwYXR0ZXJuIGluIHBhdHRlcm5zOg0KICAgICAgICAgICAgICAgIGRvcmtzLmFkZChwYXR0ZXJuLnJlcGxhY2UoIntrZXl3b3JkfSIsIGtleXdvcmQuc3RyaXAoKSkpDQogICAgICAgIHNlbGYuZG9ya3MgPSBsaXN0KGRvcmtzKQ0KICAgICAgICByZXR1cm4gc2VsZi5kb3Jrcw0KICAgIA0KICAgIGRlZiBnZXRfYmFzZV9kb21haW4oc2VsZiwgdXJsX3N0cjogc3RyKSAtPiBzdHI6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIG5ldGxvYyA9IHVybHBhcnNlKHVybF9zdHIpLm5ldGxvYw0KICAgICAgICAgICAgcGFydHMgPSBuZXRsb2Muc3BsaXQoJy4nKQ0KICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+IDIgYW5kIGxlbihwYXJ0c1stMl0pIDw9IDMgYW5kIGxlbihwYXJ0c1stMV0pIDw9IDM6DQogICAgICAgICAgICAgICAgcmV0dXJuIGYie3BhcnRzWy0zXX0ue3BhcnRzWy0yXX0ue3BhcnRzWy0xXX0iDQogICAgICAgICAgICBpZiBsZW4ocGFydHMpID49IDI6DQogICAgICAgICAgICAgICAgcmV0dXJuIGYie3BhcnRzWy0yXX0ue3BhcnRzWy0xXX0iDQogICAgICAgICAgICByZXR1cm4gbmV0bG9jDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICByZXR1cm4gInVua25vd24iDQoNCiAgICBkZWYgc2F2ZV9yZXN1bHRzKHNlbGYpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBvcy5tYWtlZGlycygicmVzdWx0cyIsIGV4aXN0X29rPVRydWUpDQogICAgICAgICAgICByZXN1bHRzX2RhdGEgPSB7DQogICAgICAgICAgICAgICAgInVybHMiOiBzb3J0ZWQobGlzdChzZXQoc2VsZi5kaXNjb3ZlcmVkX3VybHMpKSksDQogICAgICAgICAgICAgICAgImRvbWFpbnMiOiBzb3J0ZWQobGlzdChzZXQoc2VsZi5kaXNjb3ZlcmVkX2RvbWFpbnMpKSksDQogICAgICAgICAgICAgICAgInN1YmRvbWFpbnMiOiBzZWxmLnN1YmRvbWFpbl9yZXN1bHRzDQogICAgICAgICAgICB9DQogICAgICAgICAgICB3aXRoIG9wZW4ob3MucGF0aC5qb2luKCJyZXN1bHRzIiwgInNjYW5fcmVzdWx0cy5qc29uIiksICd3JykgYXMgZjoNCiAgICAgICAgICAgICAgICBqc29uLmR1bXAocmVzdWx0c19kYXRhLCBmLCBpbmRlbnQ9NCkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGtleSwgZGF0YV9saXN0IGluIFsoInVybHMiLCBzZWxmLmRpc2NvdmVyZWRfdXJscyksICgiZG9tYWlucyIsIHNlbGYuZGlzY292ZXJlZF9kb21haW5zKV06DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY29uZmlnW2Yne2tleX1fZmlsZSddLCAndycpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIHNvcnRlZChsaXN0KHNldChkYXRhX2xpc3QpKSk6DQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYie2l0ZW19XG4iKQ0KDQogICAgICAgICAgICBpZiBzZWxmLmNvbmZpZy5nZXQoJ2RlYnVnX21vZGUnKToNCiAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLkdSRUVOfVJlc3VsdHMgc2F2ZWQgc3VjY2Vzc2Z1bGx5IHRvICdyZXN1bHRzLycgZGlyZWN0b3J5LiIpDQogICAgICAgIGV4Y2VwdCBJT0Vycm9yIGFzIGU6DQogICAgICAgICAgICBpZiBzZWxmLmNvbmZpZy5nZXQoJ2RlYnVnX21vZGUnKToNCiAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLlJFRH1FcnJvciBzYXZpbmcgcmVzdWx0czoge2V9IikNCg0KY2xhc3MgV29ya2VyU2lnbmFscyhRT2JqZWN0KToNCiAgICBsb2dfbWVzc2FnZSA9IHB5cXRTaWduYWwoc3RyKQ0KICAgIGxvZ19tZXNzYWdlcyA9IHB5cXRTaWduYWwobGlzdCkNCiAgICByZXN1bHRzX2ZvdW5kID0gcHlxdFNpZ25hbChsaXN0KQ0KICAgIHN1YmRvbWFpbnNfZm91bmQgPSBweXF0U2lnbmFsKGxpc3QpDQogICAgc2Nhbl9wcm9ncmVzcyA9IHB5cXRTaWduYWwoaW50LCBpbnQpDQogICAgc2Nhbm5pbmdfc3RvcHBlZCA9IHB5cXRTaWduYWwoc3RyKQ0KICAgIGRvcmtzX2dlbmVyYXRlZCA9IHB5cXRTaWduYWwobGlzdCkNCg0KY2xhc3MgR2VtaW5pRG9ya1dvcmtlcihRVGhyZWFkKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgYXBpX2tleSwgbW9kZWwsIGtleXdvcmRzLCBjb3VudCk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQ0KICAgICAgICBzZWxmLmdlbWluaV9zZWVkZXIgPSBHZW1pbmlTZWVkZXIoYXBpX2tleSwgbW9kZWwpDQogICAgICAgIHNlbGYua2V5d29yZHMgPSBrZXl3b3Jkcw0KICAgICAgICBzZWxmLmNvdW50ID0gY291bnQNCiAgICAgICAgc2VsZi5zaWduYWxzID0gV29ya2VyU2lnbmFscygpDQoNCiAgICBkZWYgcnVuKHNlbGYpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpDQogICAgICAgICAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKGxvb3ApDQogICAgICAgICAgICBkb3JrcyA9IGxvb3AucnVuX3VudGlsX2NvbXBsZXRlKHNlbGYuZ2VtaW5pX3NlZWRlci5nZW5lcmF0ZV9kb3JrcyhzZWxmLmtleXdvcmRzLCBzZWxmLmNvdW50KSkNCiAgICAgICAgICAgIHNlbGYuc2lnbmFscy5kb3Jrc19nZW5lcmF0ZWQuZW1pdChsaXN0KGRvcmtzKSkNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoZiJbRVJST1JdIEdlbWluaSB3b3JrZXIgZmFpbGVkOiB7ZX0iKQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgbG9vcC5jbG9zZSgpDQoNCmNsYXNzIFNjYW5uZXJXb3JrZXIoUVRocmVhZCk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNjYW5uZXI6IFdvcmRQcmVzc1NjYW5uZXIpOg0KICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkNCiAgICAgICAgc2VsZi5zY2FubmVyID0gc2Nhbm5lcg0KICAgICAgICBzZWxmLnNpZ25hbHMgPSBXb3JrZXJTaWduYWxzKCkNCiAgICAgICAgc2VsZi5fcnVubmluZyA9IFRydWUNCg0KICAgIGRlZiBydW4oc2VsZik6DQogICAgICAgIHNlbGYubG9vcCA9IGFzeW5jaW8ubmV3X2V2ZW50X2xvb3AoKQ0KICAgICAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKHNlbGYubG9vcCkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgc2VsZi5sb29wLnJ1bl91bnRpbF9jb21wbGV0ZShzZWxmLm1haW4oKSkNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoZiJbRVJST1JdIEFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQgaW4gc2Nhbm5lcjoge3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IikNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIHNlbGYubG9vcC5jbG9zZSgpDQogICAgICAgICAgICBzZWxmLnNpZ25hbHMuc2Nhbm5pbmdfc3RvcHBlZC5lbWl0KCJGaW5pc2hlZCIpDQogICAgDQogICAgYXN5bmMgZGVmIG1haW4oc2VsZik6DQogICAgICAgIGRvbWFpbl9xdWV1ZSA9IGFzeW5jaW8uUXVldWUoKQ0KICAgICAgICBxdWV1ZWRfZG9tYWlucyA9IHNldCgpDQogICAgICAgIA0KICAgICAgICBsb2dfYmF0Y2ggPSBbXQ0KICAgICAgICByZXN1bHRfYmF0Y2ggPSBbXQ0KICAgICAgICBzdWJkb21haW5fYmF0Y2ggPSBbXQ0KICAgICAgICBiYXRjaF9sb2NrID0gYXN5bmNpby5Mb2NrKCkNCiAgICAgICAgc3RvcF9lbWl0dGVyID0gYXN5bmNpby5FdmVudCgpDQoNCiAgICAgICAgY29uc3VtZXIgPSBhc3luY2lvLmNyZWF0ZV90YXNrKHNlbGYuc3ViZG9tYWluX3NjYW5fY29uc3VtZXIoZG9tYWluX3F1ZXVlLCBzdWJkb21haW5fYmF0Y2gsIGxvZ19iYXRjaCwgYmF0Y2hfbG9jaykpDQogICAgICAgIGVtaXR0ZXIgPSBhc3luY2lvLmNyZWF0ZV90YXNrKHNlbGYuYmF0Y2hfZW1pdHRlcihsb2dfYmF0Y2gsIHJlc3VsdF9iYXRjaCwgc3ViZG9tYWluX2JhdGNoLCBiYXRjaF9sb2NrLCBzdG9wX2VtaXR0ZXIpKQ0KICAgICAgICANCiAgICAgICAgZG9ya190YXNrcyA9IFtzZWxmLnByb2Nlc3NfZG9yayhkb3JrLCBkb21haW5fcXVldWUsIHF1ZXVlZF9kb21haW5zLCByZXN1bHRfYmF0Y2gsIGxvZ19iYXRjaCwgYmF0Y2hfbG9jaykgZm9yIGRvcmsgaW4gc2VsZi5zY2FubmVyLmRvcmtzXQ0KDQogICAgICAgIGlmIGRvcmtfdGFza3M6DQogICAgICAgICAgICBzZWxmLnNpZ25hbHMubG9nX21lc3NhZ2UuZW1pdChmIltJTkZPXSBTdGFydGluZyBjb25jdXJyZW50IGRvcmsgYW5kIHN1YmRvbWFpbiBzY2FuLi4uIikNCiAgICAgICAgICAgIHNlbGYuc2lnbmFscy5zY2FuX3Byb2dyZXNzLmVtaXQoMCwgbGVuKGRvcmtfdGFza3MpKQ0KICAgICAgICAgICAgYXdhaXQgc2VsZi5ydW5fdGFza3NfY29uY3VycmVudGx5KGRvcmtfdGFza3MpDQogICAgICAgIA0KICAgICAgICBhd2FpdCBkb21haW5fcXVldWUucHV0KE5vbmUpDQogICAgICAgIGF3YWl0IGNvbnN1bWVyDQogICAgICAgIHN0b3BfZW1pdHRlci5zZXQoKQ0KICAgICAgICBhd2FpdCBlbWl0dGVyDQoNCiAgICBhc3luYyBkZWYgYmF0Y2hfZW1pdHRlcihzZWxmLCBsb2dfYmF0Y2gsIHJlc3VsdF9iYXRjaCwgc3ViZG9tYWluX2JhdGNoLCBsb2NrLCBzdG9wX2V2ZW50KToNCiAgICAgICAgIiIiUGVyaW9kaWNhbGx5IGVtaXRzIGJhdGNoZWQgcmVzdWx0cyB0byB0aGUgVUkgdG8gcHJldmVudCBsYWcuIiIiDQogICAgICAgIHdoaWxlIG5vdCBzdG9wX2V2ZW50LmlzX3NldCgpOg0KICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxLjApDQogICAgICAgICAgICANCiAgICAgICAgICAgIGxvZ3NfdG9fZW1pdCwgcmVzdWx0c190b19lbWl0LCBzdWJkb21haW5zX3RvX2VtaXQgPSBbXSwgW10sIFtdDQogICAgICAgICAgICBhc3luYyB3aXRoIGxvY2s6DQogICAgICAgICAgICAgICAgaWYgbG9nX2JhdGNoOiBsb2dzX3RvX2VtaXQgPSBsb2dfYmF0Y2hbOl07IGxvZ19iYXRjaC5jbGVhcigpDQogICAgICAgICAgICAgICAgaWYgcmVzdWx0X2JhdGNoOiByZXN1bHRzX3RvX2VtaXQgPSByZXN1bHRfYmF0Y2hbOl07IHJlc3VsdF9iYXRjaC5jbGVhcigpDQogICAgICAgICAgICAgICAgaWYgc3ViZG9tYWluX2JhdGNoOiBzdWJkb21haW5zX3RvX2VtaXQgPSBzdWJkb21haW5fYmF0Y2hbOl07IHN1YmRvbWFpbl9iYXRjaC5jbGVhcigpDQoNCiAgICAgICAgICAgIGlmIGxvZ3NfdG9fZW1pdDogc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlcy5lbWl0KGxvZ3NfdG9fZW1pdCkNCiAgICAgICAgICAgIGlmIHJlc3VsdHNfdG9fZW1pdDogc2VsZi5zaWduYWxzLnJlc3VsdHNfZm91bmQuZW1pdChyZXN1bHRzX3RvX2VtaXQpDQogICAgICAgICAgICBpZiBzdWJkb21haW5zX3RvX2VtaXQ6IHNlbGYuc2lnbmFscy5zdWJkb21haW5zX2ZvdW5kLmVtaXQoc3ViZG9tYWluc190b19lbWl0KQ0KICAgICAgICANCiAgICAgICAgbG9nc190b19lbWl0LCByZXN1bHRzX3RvX2VtaXQsIHN1YmRvbWFpbnNfdG9fZW1pdCA9IFtdLCBbXSwgW10NCiAgICAgICAgYXN5bmMgd2l0aCBsb2NrOg0KICAgICAgICAgICAgaWYgbG9nX2JhdGNoOiBsb2dzX3RvX2VtaXQgPSBsb2dfYmF0Y2hbOl07IGxvZ19iYXRjaC5jbGVhcigpDQogICAgICAgICAgICBpZiByZXN1bHRfYmF0Y2g6IHJlc3VsdHNfdG9fZW1pdCA9IHJlc3VsdF9iYXRjaFs6XTsgcmVzdWx0X2JhdGNoLmNsZWFyKCkNCiAgICAgICAgICAgIGlmIHN1YmRvbWFpbl9iYXRjaDogc3ViZG9tYWluc190b19lbWl0ID0gc3ViZG9tYWluX2JhdGNoWzpdOyBzdWJkb21haW5fYmF0Y2guY2xlYXIoKQ0KICAgICAgICANCiAgICAgICAgaWYgbG9nc190b19lbWl0OiBzZWxmLnNpZ25hbHMubG9nX21lc3NhZ2VzLmVtaXQobG9nc190b19lbWl0KQ0KICAgICAgICBpZiByZXN1bHRzX3RvX2VtaXQ6IHNlbGYuc2lnbmFscy5yZXN1bHRzX2ZvdW5kLmVtaXQocmVzdWx0c190b19lbWl0KQ0KICAgICAgICBpZiBzdWJkb21haW5zX3RvX2VtaXQ6IHNlbGYuc2lnbmFscy5zdWJkb21haW5zX2ZvdW5kLmVtaXQoc3ViZG9tYWluc190b19lbWl0KQ0KDQogICAgYXN5bmMgZGVmIHN1YmRvbWFpbl9zY2FuX2NvbnN1bWVyKHNlbGYsIGRvbWFpbl9xdWV1ZTogYXN5bmNpby5RdWV1ZSwgc3ViZG9tYWluX2JhdGNoOiBsaXN0LCBsb2dfYmF0Y2g6IGxpc3QsIGxvY2s6IGFzeW5jaW8uTG9jayk6DQogICAgICAgIHNlbGYuc2lnbmFscy5sb2dfbWVzc2FnZS5lbWl0KCJbSU5GT10gU3ViZG9tYWluIHNjYW4gY29uc3VtZXIgaXMgYWN0aXZlLiIpDQogICAgICAgIA0KICAgICAgICBodHRwX2NsaWVudCA9IEh0dHBDbGllbnQoc2VsZi5zY2FubmVyLmNvbmZpZy5nZXQoJ3ZlcmlmeV90bHMnLCBGYWxzZSkpDQogICAgICAgIHNjYW5fdGFza3MgPSBbXQ0KDQogICAgICAgIHdoaWxlIHNlbGYuX3J1bm5pbmc6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgZG9tYWluID0gYXdhaXQgYXN5bmNpby53YWl0X2Zvcihkb21haW5fcXVldWUuZ2V0KCksIHRpbWVvdXQ9MS4wKQ0KICAgICAgICAgICAgICAgIGlmIGRvbWFpbiBpcyBOb25lOiBicmVhaw0KICAgICAgICAgICAgICAgIHRhc2sgPSBhc3luY2lvLmNyZWF0ZV90YXNrKHNlbGYucnVuX3N1YmRvbWFpbl9zY2FuKGRvbWFpbiwgaHR0cF9jbGllbnQsIHN1YmRvbWFpbl9iYXRjaCwgbG9nX2JhdGNoLCBsb2NrKSkNCiAgICAgICAgICAgICAgICBzY2FuX3Rhc2tzLmFwcGVuZCh0YXNrKQ0KICAgICAgICAgICAgZXhjZXB0IGFzeW5jaW8uVGltZW91dEVycm9yOg0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIA0KICAgICAgICBpZiBzY2FuX3Rhc2tzOiBhd2FpdCBhc3luY2lvLmdhdGhlcigqc2Nhbl90YXNrcykNCiAgICAgICAgYXdhaXQgaHR0cF9jbGllbnQuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoIltJTkZPXSBTdWJkb21haW4gc2NhbiBjb25zdW1lciBoYXMgZmluaXNoZWQuIikNCiAgICAgICAgDQogICAgYXN5bmMgZGVmIHJ1bl9zdWJkb21haW5fc2NhbihzZWxmLCBkb21haW46IHN0ciwgaHR0cF9jbGllbnQ6IEh0dHBDbGllbnQsIHN1YmRvbWFpbl9iYXRjaDogbGlzdCwgbG9nX2JhdGNoOiBsaXN0LCBsb2NrOiBhc3luY2lvLkxvY2spOg0KICAgICAgICBpZiBub3Qgc2VsZi5fcnVubmluZzogcmV0dXJuDQogICAgICAgIA0KICAgICAgICBzdWJfc2Nhbm5lciA9IFN1YmRvbWFpblNjYW5uZXIoc2VsZi5zY2FubmVyLmNvbmZpZykNCiAgICAgICAgcmVzdWx0cyA9IGF3YWl0IHN1Yl9zY2FubmVyLmRpc2NvdmVyX3dvcmRwcmVzc19zdWJkb21haW5zKGRvbWFpbiwgaHR0cF9jbGllbnQsIGxvZ19iYXRjaCwgbG9jaykNCiAgICAgICAgDQogICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgIGlmIHNlbGYuX3J1bm5pbmcgYW5kIHJlc3VsdHM6DQogICAgICAgICAgICAgICAgc2VsZi5zY2FubmVyLnN1YmRvbWFpbl9yZXN1bHRzLnVwZGF0ZShyZXN1bHRzKQ0KICAgICAgICAgICAgICAgIGZvciBmcWRuLCBpbmZvIGluIHJlc3VsdHMuaXRlbXMoKToNCiAgICAgICAgICAgICAgICAgICAgc3ViZG9tYWluX2JhdGNoLmFwcGVuZCgoZnFkbiwgZG9tYWluLCBpbmZvKSkNCiAgICAgICAgICAgIGxvZ19iYXRjaC5hcHBlbmQoZiJbRElBR05PU1RJQ10gUHJvYmUgZmluaXNoZWQgZm9yIHtkb21haW59LiBGb3VuZCB7bGVuKHJlc3VsdHMpfSBXb3JkUHJlc3Mgc3ViZG9tYWlucy4iKQ0KDQogICAgYXN5bmMgZGVmIHJ1bl90YXNrc19jb25jdXJyZW50bHkoc2VsZiwgdGFza3M6IExpc3RbYXN5bmNpby5UYXNrXSk6DQogICAgICAgIHNlbWFwaG9yZSA9IGFzeW5jaW8uU2VtYXBob3JlKHNlbGYuc2Nhbm5lci5jb25maWcuZ2V0KCdtYXhfd29ya2VycycsIDQpKQ0KICAgICAgICB0b3RhbF90YXNrcyA9IGxlbih0YXNrcykNCiAgICAgICAgcHJvY2Vzc2VkX2NvdW50ID0gMA0KDQogICAgICAgIGFzeW5jIGRlZiBydW5fd2l0aF9zZW1hcGhvcmUodGFzayk6DQogICAgICAgICAgICBub25sb2NhbCBwcm9jZXNzZWRfY291bnQNCiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VtYXBob3JlOg0KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9ydW5uaW5nOiByYWlzZSBhc3luY2lvLkNhbmNlbGxlZEVycm9yKCkNCiAgICAgICAgICAgICAgICBhd2FpdCB0YXNrDQogICAgICAgICAgICAgICAgcHJvY2Vzc2VkX2NvdW50ICs9IDENCiAgICAgICAgICAgICAgICBzZWxmLnNpZ25hbHMuc2Nhbl9wcm9ncmVzcy5lbWl0KHByb2Nlc3NlZF9jb3VudCwgdG90YWxfdGFza3MpDQogICAgICAgIA0KICAgICAgICBhd2FpdCBhc3luY2lvLmdhdGhlcigqW2FzeW5jaW8uY3JlYXRlX3Rhc2socnVuX3dpdGhfc2VtYXBob3JlKHRhc2spKSBmb3IgdGFzayBpbiB0YXNrc10sIHJldHVybl9leGNlcHRpb25zPVRydWUpDQoNCiAgICBhc3luYyBkZWYgcHJvY2Vzc19kb3JrKHNlbGYsIGRvcms6IHN0ciwgZG9tYWluX3F1ZXVlOiBhc3luY2lvLlF1ZXVlLCBxdWV1ZWRfZG9tYWluczogc2V0LCByZXN1bHRfYmF0Y2g6IGxpc3QsIGxvZ19iYXRjaDogbGlzdCwgbG9jazogYXN5bmNpby5Mb2NrKToNCiAgICAgICAgaWYgbm90IHNlbGYuX3J1bm5pbmc6IHJldHVybg0KICAgICAgICANCiAgICAgICAgYXdhaXQgc2VsZi5zY2FubmVyLnJhdGVfbGltaXRlci53YWl0KCkNCiAgICAgICAgDQogICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgIGxvZ19iYXRjaC5hcHBlbmQoZiJbRkVUQ0hdIHtkb3JrfSBvbiBEdWNrRHVja0dvIikNCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGRlZiBzZWFyY2hfZGRnKCk6DQogICAgICAgICAgICAgICAgd2l0aCBEREdTKHRpbWVvdXQ9c2VsZi5zY2FubmVyLmNvbmZpZy5nZXQoJ3RpbWVvdXQnLCAxMCkpIGFzIGRkZ3M6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBbclsnaHJlZiddIGZvciByIGluIGRkZ3MudGV4dChkb3JrLCBtYXhfcmVzdWx0cz0yMCldDQogICAgICAgICAgICANCiAgICAgICAgICAgIGxpbmtzID0gYXdhaXQgYXN5bmNpby50b190aHJlYWQoc2VhcmNoX2RkZykNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYXN5bmMgd2l0aCBsb2NrOg0KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9ydW5uaW5nOiByZXR1cm4NCiAgICAgICAgICAgICAgICBmb3IgdXJsIGluIGxpbmtzOg0KICAgICAgICAgICAgICAgICAgICBpZiB1cmwgYW5kICgid3AtY29udGVudCIgaW4gdXJsIG9yICJ3cC1pbmNsdWRlcyIgaW4gdXJsIG9yICJ3b3JkcHJlc3MiIGluIHVybCk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1cmwgbm90IGluIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX3VybHM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2FubmVyLmRpc2NvdmVyZWRfdXJscy5hcHBlbmQodXJsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfZG9tYWluID0gc2VsZi5zY2FubmVyLmdldF9iYXNlX2RvbWFpbih1cmwpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmFzZV9kb21haW4gbm90IGluIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX2RvbWFpbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX2RvbWFpbnMuYXBwZW5kKGJhc2VfZG9tYWluKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdF9iYXRjaC5hcHBlbmQoKHVybCwgYmFzZV9kb21haW4pKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5zY2FubmVyLmNvbmZpZy5nZXQoJ3N1YmRvbWFpbl9zY2FuJykgYW5kIGJhc2VfZG9tYWluIG5vdCBpbiBxdWV1ZWRfZG9tYWluczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVkX2RvbWFpbnMuYWRkKGJhc2VfZG9tYWluKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dfYmF0Y2guYXBwZW5kKGYiW0RJQUdOT1NUSUNdIFF1ZXVlZCB7YmFzZV9kb21haW59IGZvciBzdWJkb21haW4gc2Nhbi4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkb21haW5fcXVldWUucHV0KGJhc2VfZG9tYWluKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBhc3luYyB3aXRoIGxvY2s6DQogICAgICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltFUlJPUl0gRmFpbGVkIHRvIHByb2Nlc3MgZG9yayBvbiBEdWNrRHVja0dvOiB7ZX0iKQ0KDQogICAgZGVmIHN0b3Aoc2VsZik6DQogICAgICAgIGlmIHNlbGYuX3J1bm5pbmc6DQogICAgICAgICAgICBzZWxmLl9ydW5uaW5nID0gRmFsc2UNCiAgICAgICAgICAgIA0KY2xhc3MgV29yZFByZXNzU2Nhbm5lclVJKFFNYWluV2luZG93KToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgbG9nb19waXhtYXA9Tm9uZSk6DQogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQ0KICAgICAgICBzZWxmLnNldFdpbmRvd1RpdGxlKCJNYXNzIFdvcmRwcmVzcyBTY3JhcHBlciIpDQogICAgICAgIA0KICAgICAgICBzZWxmLmxvZ29fcGl4bWFwID0gbG9nb19waXhtYXANCiAgICAgICAgc2VsZi5zY2FubmVyID0gV29yZFByZXNzU2Nhbm5lcigpDQogICAgICAgIHNlbGYud29ya2VyID0gTm9uZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5jcmVhdGVfdWkoKQ0KICAgICAgICBzZWxmLmFwcGx5X2RhcmtfdGhlbWUoKQ0KICAgICAgICBzZWxmLmxvYWRfc2V0dGluZ3MoKQ0KICAgICAgICBzZWxmLnNldHVwX2NvbnRleHRfbWVudXMoKQ0KDQogICAgZGVmIGNyZWF0ZV91aShzZWxmKToNCiAgICAgICAgbWFpbl93aWRnZXQgPSBRV2lkZ2V0KCkNCiAgICAgICAgc2VsZi5zZXRDZW50cmFsV2lkZ2V0KG1haW5fd2lkZ2V0KQ0KICAgICAgICBtYWluX2xheW91dCA9IFFWQm94TGF5b3V0KG1haW5fd2lkZ2V0KQ0KICAgICAgICANCiAgICAgICAgaGVhZGVyX2ZyYW1lID0gUUZyYW1lKCkNCiAgICAgICAgaGVhZGVyX2xheW91dCA9IFFIQm94TGF5b3V0KGhlYWRlcl9mcmFtZSkNCg0KICAgICAgICBoZWFkZXJfdGV4dF9sYXlvdXQgPSBRVkJveExheW91dCgpDQogICAgICAgIGhlYWRlcl90ZXh0X2xheW91dC5zZXRDb250ZW50c01hcmdpbnMoMCwgMCwgMTAsIDApDQogICAgICAgIHRpdGxlX2xhYmVsID0gUUxhYmVsKCJNYXNzIFdvcmRwcmVzcyBTY3JhcHBlciIpDQogICAgICAgIHRpdGxlX2xhYmVsLnNldFN0eWxlU2hlZXQoImZvbnQtc2l6ZTogMjRweDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiAjRTJFOEYwOyIpDQogICAgICAgIGRlc2NfbGFiZWwgPSBRTGFiZWwoIkFkdmFuY2VkIERpc2NvdmVyeSBUb29sIGZvciBXb3JkUHJlc3MgU2l0ZXMiKQ0KICAgICAgICBkZXNjX2xhYmVsLnNldFN0eWxlU2hlZXQoImZvbnQtc2l6ZTogMTRweDsgY29sb3I6ICNBMEFFQzA7IikNCiAgICAgICAgYXV0aG9yX2xhYmVsID0gUUxhYmVsKCJEZXZlbG9wZWQgYnkgUmVkSHlkcmEiKQ0KICAgICAgICBhdXRob3JfbGFiZWwuc2V0U3R5bGVTaGVldCgiZm9udC1zaXplOiAxMXB4OyBjb2xvcjogIzcxODA5NjsiKQ0KICAgICAgICANCiAgICAgICAgaGVhZGVyX3RleHRfbGF5b3V0LmFkZFdpZGdldCh0aXRsZV9sYWJlbCkNCiAgICAgICAgaGVhZGVyX3RleHRfbGF5b3V0LmFkZFdpZGdldChkZXNjX2xhYmVsKQ0KICAgICAgICBoZWFkZXJfdGV4dF9sYXlvdXQuYWRkU3RyZXRjaCgpDQogICAgICAgIGhlYWRlcl90ZXh0X2xheW91dC5hZGRXaWRnZXQoYXV0aG9yX2xhYmVsKQ0KICAgICAgICBoZWFkZXJfbGF5b3V0LmFkZExheW91dChoZWFkZXJfdGV4dF9sYXlvdXQpDQogICAgICAgIGhlYWRlcl9sYXlvdXQuYWRkU3RyZXRjaCgpDQogICAgICAgIA0KICAgICAgICBpZiBzZWxmLmxvZ29fcGl4bWFwIGFuZCBub3Qgc2VsZi5sb2dvX3BpeG1hcC5pc051bGwoKToNCiAgICAgICAgICAgIGxvZ29fbGFiZWwgPSBRTGFiZWwoKQ0KICAgICAgICAgICAgbG9nb19sYWJlbC5zZXRQaXhtYXAoc2VsZi5sb2dvX3BpeG1hcC5zY2FsZWQoOTYsIDk2LCBRdC5LZWVwQXNwZWN0UmF0aW8sIFF0LlNtb290aFRyYW5zZm9ybWF0aW9uKSkNCiAgICAgICAgICAgIGxvZ29fbGFiZWwuc2V0U2l6ZVBvbGljeShRU2l6ZVBvbGljeS5GaXhlZCwgUVNpemVQb2xpY3kuRml4ZWQpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNoYWRvdyA9IFFHcmFwaGljc0Ryb3BTaGFkb3dFZmZlY3Qoc2VsZikNCiAgICAgICAgICAgIHNoYWRvdy5zZXRCbHVyUmFkaXVzKDI1KQ0KICAgICAgICAgICAgc2hhZG93LnNldENvbG9yKFFDb2xvcigiI2EwYzRmZiIpKQ0KICAgICAgICAgICAgc2hhZG93LnNldE9mZnNldCgwLCAwKQ0KICAgICAgICAgICAgbG9nb19sYWJlbC5zZXRHcmFwaGljc0VmZmVjdChzaGFkb3cpDQogICAgICAgICAgICBoZWFkZXJfbGF5b3V0LmFkZFdpZGdldChsb2dvX2xhYmVsKQ0KDQogICAgICAgIG1haW5fbGF5b3V0LmFkZFdpZGdldChoZWFkZXJfZnJhbWUpDQogICAgICAgIA0KICAgICAgICBzZWxmLnRhYnMgPSBRVGFiV2lkZ2V0KCkNCiAgICAgICAgc2VsZi5jcmVhdGVfZG9ya3NfdGFiKCkNCiAgICAgICAgc2VsZi5jcmVhdGVfcmVzdWx0c190YWIoKQ0KICAgICAgICBzZWxmLmNyZWF0ZV9zdWJkb21haW5zX3RhYigpDQogICAgICAgIHNlbGYuY3JlYXRlX3NldHRpbmdzX3RhYigpDQogICAgICAgIHNlbGYuY3JlYXRlX2xvZ190YWIoKQ0KICAgICAgICBtYWluX2xheW91dC5hZGRXaWRnZXQoc2VsZi50YWJzKQ0KICAgICAgICANCiAgICAgICAgY29udHJvbF9ncm91cCA9IFFHcm91cEJveCgiU2NhbiBDb250cm9scyIpDQogICAgICAgIGNvbnRyb2xfbGF5b3V0ID0gUUhCb3hMYXlvdXQoY29udHJvbF9ncm91cCkNCiAgICAgICAgc2VsZi5zdGFydF9idG4gPSBRUHVzaEJ1dHRvbigiU3RhcnQgU2NhbiIpDQogICAgICAgIHNlbGYuc3RhcnRfYnRuLnNldEljb24oc2VsZi5zdHlsZSgpLnN0YW5kYXJkSWNvbihRU3R5bGUuU1BfTWVkaWFQbGF5KSkNCiAgICAgICAgc2VsZi5zdGFydF9idG4uY2xpY2tlZC5jb25uZWN0KHNlbGYuc3RhcnRfc2NhbikNCiAgICAgICAgc2VsZi5zdG9wX2J0biA9IFFQdXNoQnV0dG9uKCJTdG9wIFNjYW4iKQ0KICAgICAgICBzZWxmLnN0b3BfYnRuLnNldEljb24oc2VsZi5zdHlsZSgpLnN0YW5kYXJkSWNvbihRU3R5bGUuU1BfTWVkaWFTdG9wKSkNCiAgICAgICAgc2VsZi5zdG9wX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5zdG9wX3NjYW4pDQogICAgICAgIHNlbGYuc3RvcF9idG4uc2V0RW5hYmxlZChGYWxzZSkNCiAgICAgICAgc2VsZi5wcm9ncmVzc19iYXIgPSBRUHJvZ3Jlc3NCYXIoKQ0KICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRNYXhpbXVtV2lkdGgoMzAwKQ0KICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRUZXh0VmlzaWJsZShUcnVlKQ0KICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRUb29sVGlwKCJQcm9ncmVzcyBvZiB0aGUgZG9yayBzY2FubmluZyBwaGFzZS4iKQ0KICAgICAgICBzZWxmLnVybHNfbGFiZWwgPSBRTGFiZWwoIlVSTHM6IDAiKQ0KICAgICAgICBzZWxmLmRvbWFpbnNfbGFiZWwgPSBRTGFiZWwoIkRvbWFpbnM6IDAiKQ0KICAgICAgICANCiAgICAgICAgY29udHJvbF9sYXlvdXQuYWRkV2lkZ2V0KHNlbGYuc3RhcnRfYnRuKQ0KICAgICAgICBjb250cm9sX2xheW91dC5hZGRXaWRnZXQoc2VsZi5zdG9wX2J0bikNCiAgICAgICAgY29udHJvbF9sYXlvdXQuYWRkU3RyZXRjaCgpDQogICAgICAgIGNvbnRyb2xfbGF5b3V0LmFkZFdpZGdldChzZWxmLnVybHNfbGFiZWwpDQogICAgICAgIGNvbnRyb2xfbGF5b3V0LmFkZFdpZGdldChzZWxmLmRvbWFpbnNfbGFiZWwpDQogICAgICAgIGNvbnRyb2xfbGF5b3V0LmFkZFdpZGdldChzZWxmLnByb2dyZXNzX2JhcikNCiAgICAgICAgbWFpbl9sYXlvdXQuYWRkV2lkZ2V0KGNvbnRyb2xfZ3JvdXApDQoNCiAgICBkZWYgY3JlYXRlX2RvcmtzX3RhYihzZWxmKToNCiAgICAgICAgZG9ya3NfdGFiID0gUVdpZGdldCgpDQogICAgICAgIHNlbGYudGFicy5hZGRUYWIoZG9ya3NfdGFiLCAiRG9yayBHZW5lcmF0aW9uIikNCiAgICAgICAgbGF5b3V0ID0gUUhCb3hMYXlvdXQoZG9ya3NfdGFiKQ0KICAgICAgICANCiAgICAgICAgbGVmdF9wYW5lbCA9IFFXaWRnZXQoKQ0KICAgICAgICBsZWZ0X2xheW91dCA9IFFWQm94TGF5b3V0KGxlZnRfcGFuZWwpDQogICAgICAgIGtleXdvcmRzX2dyb3VwID0gUUdyb3VwQm94KCJLZXl3b3JkcyIpDQogICAgICAgIGtleXdvcmRzX2xheW91dCA9IFFWQm94TGF5b3V0KGtleXdvcmRzX2dyb3VwKQ0KICAgICAgICBzZWxmLmtleXdvcmRzX3RleHQgPSBRVGV4dEVkaXQoKQ0KICAgICAgICBzZWxmLmtleXdvcmRzX3RleHQuc2V0UGxhY2Vob2xkZXJUZXh0KCJFbnRlciBrZXl3b3JkcyAob25lIHBlciBsaW5lKS4uLiIpDQogICAgICAgIGtleXdvcmRzX2xheW91dC5hZGRXaWRnZXQoc2VsZi5rZXl3b3Jkc190ZXh0KQ0KICAgICAgICBsZWZ0X2xheW91dC5hZGRXaWRnZXQoa2V5d29yZHNfZ3JvdXAsIDEpDQoNCiAgICAgICAgcGF0dGVybnNfZ3JvdXAgPSBRR3JvdXBCb3goIkJhc2UgRG9yayBQYXR0ZXJucyIpDQogICAgICAgIHBhdHRlcm5zX2xheW91dCA9IFFWQm94TGF5b3V0KHBhdHRlcm5zX2dyb3VwKQ0KICAgICAgICBzZWxmLnBhdHRlcm5zX3RleHQgPSBRVGV4dEVkaXQoKQ0KICAgICAgICBzZWxmLnBhdHRlcm5zX3RleHQuc2V0VGV4dCgiXG4iLmpvaW4oc2VsZi5zY2FubmVyLmRlZmF1bHRfcGF0dGVybnMpKQ0KICAgICAgICBwYXR0ZXJuc19sYXlvdXQuYWRkV2lkZ2V0KHNlbGYucGF0dGVybnNfdGV4dCkNCiAgICAgICAgbGVmdF9sYXlvdXQuYWRkV2lkZ2V0KHBhdHRlcm5zX2dyb3VwLCAxKQ0KDQogICAgICAgIHJpZ2h0X3BhbmVsID0gUVdpZGdldCgpDQogICAgICAgIHJpZ2h0X2xheW91dCA9IFFWQm94TGF5b3V0KHJpZ2h0X3BhbmVsKQ0KICAgICAgICBzZWxmLmdlbmVyYXRlX2J0biA9IFFQdXNoQnV0dG9uKCJHZW5lcmF0ZSBEb3JrcyIpDQogICAgICAgIHNlbGYuZ2VuZXJhdGVfYnRuLnNldFRvb2xUaXAoIkdlbmVyYXRlcyBkb3JrcyBmcm9tIGtleXdvcmRzLiBVc2VzIEdlbWluaSBmb3IgbW9yZSBpZiBlbmFibGVkIGluIHNldHRpbmdzLiIpDQogICAgICAgIHNlbGYuZ2VuZXJhdGVfYnRuLmNsaWNrZWQuY29ubmVjdChzZWxmLmdlbmVyYXRlX2RvcmtzKQ0KICAgICAgICANCiAgICAgICAgcHJldmlld19ncm91cCA9IFFHcm91cEJveCgiR2VuZXJhdGVkIERvcmtzIFByZXZpZXciKQ0KICAgICAgICBwcmV2aWV3X2xheW91dCA9IFFWQm94TGF5b3V0KHByZXZpZXdfZ3JvdXApDQogICAgICAgIHNlbGYucHJldmlld190ZXh0ID0gUVRleHRFZGl0KCkNCiAgICAgICAgc2VsZi5wcmV2aWV3X3RleHQuc2V0UmVhZE9ubHkoVHJ1ZSkNCiAgICAgICAgc2VsZi5wcmV2aWV3X2NvdW50X2xhYmVsID0gUUxhYmVsKCIwIGRvcmtzIGdlbmVyYXRlZC4iKQ0KICAgICAgICANCiAgICAgICAgcHJldmlld19sYXlvdXQuYWRkV2lkZ2V0KHNlbGYucHJldmlld190ZXh0KQ0KICAgICAgICBwcmV2aWV3X2xheW91dC5hZGRXaWRnZXQoc2VsZi5wcmV2aWV3X2NvdW50X2xhYmVsKQ0KICAgICAgICANCiAgICAgICAgcmlnaHRfbGF5b3V0LmFkZFdpZGdldChzZWxmLmdlbmVyYXRlX2J0bikNCiAgICAgICAgcmlnaHRfbGF5b3V0LmFkZFdpZGdldChwcmV2aWV3X2dyb3VwKQ0KDQogICAgICAgIGxheW91dC5hZGRXaWRnZXQobGVmdF9wYW5lbCwgMSkNCiAgICAgICAgbGF5b3V0LmFkZFdpZGdldChyaWdodF9wYW5lbCwgMikNCg0KICAgIGRlZiBjcmVhdGVfcmVzdWx0c190YWIoc2VsZik6DQogICAgICAgIHJlc3VsdHNfdGFiID0gUVdpZGdldCgpDQogICAgICAgIHNlbGYudGFicy5hZGRUYWIocmVzdWx0c190YWIsICJSZXN1bHRzIikNCiAgICAgICAgbGF5b3V0ID0gUVZCb3hMYXlvdXQocmVzdWx0c190YWIpDQogICAgICAgIHNwbGl0dGVyID0gUVNwbGl0dGVyKFF0Lkhvcml6b250YWwpDQogICAgICAgIA0KICAgICAgICB1cmxzX2dyb3VwID0gUUdyb3VwQm94KCJEaXNjb3ZlcmVkIFVSTHMiKQ0KICAgICAgICB1cmxzX2xheW91dCA9IFFWQm94TGF5b3V0KHVybHNfZ3JvdXApDQogICAgICAgIHNlbGYudXJsc19saXN0ID0gUVRhYmxlV2lkZ2V0KDAsIDEpDQogICAgICAgIHNlbGYudXJsc19saXN0LnNldEhvcml6b250YWxIZWFkZXJMYWJlbHMoWyJVUkwiXSkNCiAgICAgICAgc2VsZi51cmxzX2xpc3QuaG9yaXpvbnRhbEhlYWRlcigpLnNldFN0cmV0Y2hMYXN0U2VjdGlvbihUcnVlKQ0KICAgICAgICBzZWxmLnVybHNfbGlzdC5zZXRTZWxlY3Rpb25CZWhhdmlvcihRQWJzdHJhY3RJdGVtVmlldy5TZWxlY3RSb3dzKQ0KICAgICAgICB1cmxzX2xheW91dC5hZGRXaWRnZXQoc2VsZi51cmxzX2xpc3QpDQogICAgICAgIHNwbGl0dGVyLmFkZFdpZGdldCh1cmxzX2dyb3VwKQ0KDQogICAgICAgIGRvbWFpbnNfZ3JvdXAgPSBRR3JvdXBCb3goIkRpc2NvdmVyZWQgRG9tYWlucyIpDQogICAgICAgIGRvbWFpbnNfbGF5b3V0ID0gUVZCb3hMYXlvdXQoZG9tYWluc19ncm91cCkNCiAgICAgICAgc2VsZi5kb21haW5zX2xpc3QgPSBRVGFibGVXaWRnZXQoMCwgMSkNCiAgICAgICAgc2VsZi5kb21haW5zX2xpc3Quc2V0SG9yaXpvbnRhbEhlYWRlckxhYmVscyhbIkRvbWFpbiJdKQ0KICAgICAgICBzZWxmLmRvbWFpbnNfbGlzdC5ob3Jpem9udGFsSGVhZGVyKCkuc2V0U3RyZXRjaExhc3RTZWN0aW9uKFRydWUpDQogICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFNlbGVjdGlvbkJlaGF2aW9yKFFBYnN0cmFjdEl0ZW1WaWV3LlNlbGVjdFJvd3MpDQogICAgICAgIGRvbWFpbnNfbGF5b3V0LmFkZFdpZGdldChzZWxmLmRvbWFpbnNfbGlzdCkNCiAgICAgICAgc3BsaXR0ZXIuYWRkV2lkZ2V0KGRvbWFpbnNfZ3JvdXApDQogICAgICAgIA0KICAgICAgICBzcGxpdHRlci5zZXRTaXplcyhbNjAwLCA0MDBdKQ0KICAgICAgICANCiAgICAgICAgYnV0dG9uc19sYXlvdXQgPSBRSEJveExheW91dCgpDQogICAgICAgIHNhdmVfcmVzdWx0c19idG4gPSBRUHVzaEJ1dHRvbigiU2F2ZSBSZXN1bHRzIikNCiAgICAgICAgc2F2ZV9yZXN1bHRzX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5zYXZlX3Jlc3VsdHNfbWFudWFsKQ0KICAgICAgICBjbGVhcl9idG4gPSBRUHVzaEJ1dHRvbigiQ2xlYXIgUmVzdWx0cyIpDQogICAgICAgIGNsZWFyX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5jbGVhcl9yZXN1bHRzKQ0KICAgICAgICBidXR0b25zX2xheW91dC5hZGRXaWRnZXQoc2F2ZV9yZXN1bHRzX2J0bikNCiAgICAgICAgYnV0dG9uc19sYXlvdXQuYWRkV2lkZ2V0KGNsZWFyX2J0bikNCiAgICAgICAgYnV0dG9uc19sYXlvdXQuYWRkU3RyZXRjaCgpDQogICAgICAgIA0KICAgICAgICBsYXlvdXQuYWRkV2lkZ2V0KHNwbGl0dGVyKQ0KICAgICAgICBsYXlvdXQuYWRkTGF5b3V0KGJ1dHRvbnNfbGF5b3V0KQ0KICAgICAgICANCiAgICBkZWYgY3JlYXRlX3N1YmRvbWFpbnNfdGFiKHNlbGYpOg0KICAgICAgICBzdWJkb21haW5zX3RhYiA9IFFXaWRnZXQoKQ0KICAgICAgICBzZWxmLnRhYnMuYWRkVGFiKHN1YmRvbWFpbnNfdGFiLCAiU3ViZG9tYWlucyIpDQogICAgICAgIGxheW91dCA9IFFWQm94TGF5b3V0KHN1YmRvbWFpbnNfdGFiKQ0KICAgICAgICBzZWxmLnN1YmRvbWFpbnNfbGlzdCA9IFFUYWJsZVdpZGdldCgwLCAzKQ0KICAgICAgICBzZWxmLnN1YmRvbWFpbnNfbGlzdC5zZXRIb3Jpem9udGFsSGVhZGVyTGFiZWxzKFsiU3ViZG9tYWluIiwgIlRpdGxlIiwgIkEgUmVjb3JkcyJdKQ0KICAgICAgICBoZWFkZXIgPSBzZWxmLnN1YmRvbWFpbnNfbGlzdC5ob3Jpem9udGFsSGVhZGVyKCkNCiAgICAgICAgaGVhZGVyLnNldFNlY3Rpb25SZXNpemVNb2RlKDAsIFFIZWFkZXJWaWV3LlN0cmV0Y2gpDQogICAgICAgIGhlYWRlci5zZXRTZWN0aW9uUmVzaXplTW9kZSgxLCBRSGVhZGVyVmlldy5TdHJldGNoKQ0KICAgICAgICBoZWFkZXIuc2V0U2VjdGlvblJlc2l6ZU1vZGUoMiwgUUhlYWRlclZpZXcuUmVzaXplVG9Db250ZW50cykNCiAgICAgICAgc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0U2VsZWN0aW9uQmVoYXZpb3IoUUFic3RyYWN0SXRlbVZpZXcuU2VsZWN0Um93cykNCiAgICAgICAgbGF5b3V0LmFkZFdpZGdldChzZWxmLnN1YmRvbWFpbnNfbGlzdCkNCiAgICAgICAgDQogICAgICAgIGJ1dHRvbnNfbGF5b3V0ID0gUUhCb3hMYXlvdXQoKQ0KICAgICAgICBzYXZlX3N1YmRvbWFpbnNfYnRuID0gUVB1c2hCdXR0b24oIlNhdmUgU3ViZG9tYWlucyIpDQogICAgICAgIHNhdmVfc3ViZG9tYWluc19idG4uY2xpY2tlZC5jb25uZWN0KHNlbGYuc2F2ZV9zdWJkb21haW5zX21hbnVhbCkNCiAgICAgICAgY2xlYXJfYnRuID0gUVB1c2hCdXR0b24oIkNsZWFyIFN1YmRvbWFpbnMiKQ0KICAgICAgICBjbGVhcl9idG4uY2xpY2tlZC5jb25uZWN0KGxhbWJkYTogc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0Um93Q291bnQoMCkpDQogICAgICAgIGJ1dHRvbnNfbGF5b3V0LmFkZFdpZGdldChzYXZlX3N1YmRvbWFpbnNfYnRuKQ0KICAgICAgICBidXR0b25zX2xheW91dC5hZGRXaWRnZXQoY2xlYXJfYnRuKQ0KICAgICAgICBidXR0b25zX2xheW91dC5hZGRTdHJldGNoKCkNCiAgICAgICAgbGF5b3V0LmFkZExheW91dChidXR0b25zX2xheW91dCkNCg0KICAgIGRlZiBjcmVhdGVfc2V0dGluZ3NfdGFiKHNlbGYpOg0KICAgICAgICBzZXR0aW5nc190YWIgPSBRV2lkZ2V0KCkNCiAgICAgICAgc2VsZi50YWJzLmFkZFRhYihzZXR0aW5nc190YWIsICJTZXR0aW5ncyIpDQogICAgICAgIGxheW91dCA9IFFWQm94TGF5b3V0KHNldHRpbmdzX3RhYikNCiAgICAgICAgc2Nyb2xsX2FyZWEgPSBRU2Nyb2xsQXJlYSgpDQogICAgICAgIHNjcm9sbF9hcmVhLnNldFdpZGdldFJlc2l6YWJsZShUcnVlKQ0KICAgICAgICBzZXR0aW5nc193aWRnZXQgPSBRV2lkZ2V0KCkNCiAgICAgICAgc2V0dGluZ3NfbGF5b3V0ID0gUVZCb3hMYXlvdXQoc2V0dGluZ3Nfd2lkZ2V0KQ0KDQogICAgICAgIHNjYW5fZ3JvdXAgPSBRR3JvdXBCb3goIlNjYW4gU2V0dGluZ3MiKQ0KICAgICAgICBzY2FuX2xheW91dCA9IFFGb3JtTGF5b3V0KHNjYW5fZ3JvdXApDQogICAgICAgIHNlbGYudGltZW91dF9zcGluID0gUVNwaW5Cb3goKQ0KICAgICAgICBzZWxmLnRpbWVvdXRfc3Bpbi5zZXRSYW5nZSg1LCA2MCkNCiAgICAgICAgc2VsZi50aW1lb3V0X3NwaW4uc2V0U3VmZml4KCIgcyIpDQogICAgICAgIHNlbGYud29ya2Vyc19zcGluID0gUVNwaW5Cb3goKQ0KICAgICAgICBzZWxmLndvcmtlcnNfc3Bpbi5zZXRSYW5nZSgxLCAyMCkNCiAgICAgICAgc2VsZi5kZWJ1Z19jaGVjayA9IFFDaGVja0JveCgiRW5hYmxlIERlYnVnIExvZ2dpbmciKQ0KICAgICAgICBzZWxmLnN1YmRvbWFpbl9jaGVjayA9IFFDaGVja0JveCgiRW5hYmxlIExpdmUgU3ViZG9tYWluIFNjYW5uaW5nIikNCiAgICAgICAgc2Nhbl9sYXlvdXQuYWRkUm93KCJOZXR3b3JrIFRpbWVvdXQ6Iiwgc2VsZi50aW1lb3V0X3NwaW4pDQogICAgICAgIHNjYW5fbGF5b3V0LmFkZFJvdygiTWF4IENvbmN1cnJlbnQgV29ya2VyczoiLCBzZWxmLndvcmtlcnNfc3BpbikNCiAgICAgICAgc2Nhbl9sYXlvdXQuYWRkUm93KHNlbGYuZGVidWdfY2hlY2spDQogICAgICAgIHNjYW5fbGF5b3V0LmFkZFJvdyhzZWxmLnN1YmRvbWFpbl9jaGVjaykNCiAgICAgICAgc2V0dGluZ3NfbGF5b3V0LmFkZFdpZGdldChzY2FuX2dyb3VwKQ0KDQogICAgICAgIGdlbWluaV9ncm91cCA9IFFHcm91cEJveCgiR2VtaW5pIEFJIFNldHRpbmdzIikNCiAgICAgICAgZ2VtaW5pX2xheW91dCA9IFFGb3JtTGF5b3V0KGdlbWluaV9ncm91cCkNCiAgICAgICAgc2VsZi5nZW1pbmlfYXBpX2xpbmUgPSBRTGluZUVkaXQoKQ0KICAgICAgICBzZWxmLmdlbWluaV9hcGlfbGluZS5zZXRFY2hvTW9kZShRTGluZUVkaXQuUGFzc3dvcmQpDQogICAgICAgIHNlbGYuZ2VtaW5pX21vZGVsX2xpbmUgPSBRTGluZUVkaXQoKQ0KICAgICAgICBzZWxmLmFpX2RvcmtfY2hlY2sgPSBRQ2hlY2tCb3goIlVzZSBHZW1pbmkgdG8gZ2VuZXJhdGUgYWRkaXRpb25hbCBkb3JrcyIpDQogICAgICAgIGdlbWluaV9sYXlvdXQuYWRkUm93KCJHZW1pbmkgQVBJIEtleToiLCBzZWxmLmdlbWluaV9hcGlfbGluZSkNCiAgICAgICAgZ2VtaW5pX2xheW91dC5hZGRSb3coIkdlbWluaSBNb2RlbDoiLCBzZWxmLmdlbWluaV9tb2RlbF9saW5lKQ0KICAgICAgICBnZW1pbmlfbGF5b3V0LmFkZFJvdyhzZWxmLmFpX2RvcmtfY2hlY2spDQogICAgICAgIHNldHRpbmdzX2xheW91dC5hZGRXaWRnZXQoZ2VtaW5pX2dyb3VwKQ0KDQogICAgICAgIHNldHRpbmdzX2xheW91dC5hZGRTdHJldGNoKCkNCiAgICAgICAgc2F2ZV9idG4gPSBRUHVzaEJ1dHRvbigiU2F2ZSBTZXR0aW5ncyIpDQogICAgICAgIHNhdmVfYnRuLmNsaWNrZWQuY29ubmVjdChzZWxmLnNhdmVfc2V0dGluZ3MpDQogICAgICAgIHNldHRpbmdzX2xheW91dC5hZGRXaWRnZXQoc2F2ZV9idG4sIDAsIFF0LkFsaWduUmlnaHQpDQogICAgICAgIA0KICAgICAgICBzY3JvbGxfYXJlYS5zZXRXaWRnZXQoc2V0dGluZ3Nfd2lkZ2V0KQ0KICAgICAgICBsYXlvdXQuYWRkV2lkZ2V0KHNjcm9sbF9hcmVhKQ0KDQogICAgZGVmIGNyZWF0ZV9sb2dfdGFiKHNlbGYpOg0KICAgICAgICBsb2dfdGFiID0gUVdpZGdldCgpDQogICAgICAgIHNlbGYudGFicy5hZGRUYWIobG9nX3RhYiwgIkFjdGl2aXR5IExvZyIpDQogICAgICAgIGxheW91dCA9IFFWQm94TGF5b3V0KGxvZ190YWIpDQogICAgICAgIHNlbGYubG9nX3RleHQgPSBRVGV4dEVkaXQoKQ0KICAgICAgICBzZWxmLmxvZ190ZXh0LnNldFJlYWRPbmx5KFRydWUpDQogICAgICAgIA0KICAgICAgICBjbGVhcl9idG4gPSBRUHVzaEJ1dHRvbigiQ2xlYXIgTG9nIikNCiAgICAgICAgY2xlYXJfYnRuLmNsaWNrZWQuY29ubmVjdChzZWxmLmxvZ190ZXh0LmNsZWFyKQ0KICAgICAgICANCiAgICAgICAgbGF5b3V0LmFkZFdpZGdldChzZWxmLmxvZ190ZXh0KQ0KICAgICAgICBsYXlvdXQuYWRkV2lkZ2V0KGNsZWFyX2J0biwgMCwgUXQuQWxpZ25SaWdodCkNCg0KICAgIGRlZiBhcHBseV9kYXJrX3RoZW1lKHNlbGYpOg0KICAgICAgICBzZWxmLnNldFN0eWxlU2hlZXQoIiIiDQogICAgICAgICAgICBRV2lkZ2V0IHsgYmFja2dyb3VuZC1jb2xvcjogIzFBMjAyQzsgY29sb3I6ICNFMkU4RjA7IGZvbnQtZmFtaWx5OiBTZWdvZSBVSSwgc2Fucy1zZXJpZjsgfQ0KICAgICAgICAgICAgUU1haW5XaW5kb3cgeyBib3JkZXI6IDFweCBzb2xpZCAjNEE1NTY4OyB9DQogICAgICAgICAgICBRR3JvdXBCb3ggeyBtYXJnaW4tdG9wOiAxZXg7IGZvbnQtd2VpZ2h0OiBib2xkOyBiYWNrZ3JvdW5kOiAjMkQzNzQ4OyBib3JkZXI6IDFweCBzb2xpZCAjNEE1NTY4OyBib3JkZXItcmFkaXVzOiA2cHg7IH0NCiAgICAgICAgICAgIFFHcm91cEJveDo6dGl0bGUgeyBzdWJjb250cm9sLW9yaWdpbjogbWFyZ2luOyBwYWRkaW5nOiAwIDVweDsgfQ0KICAgICAgICAgICAgUUxpbmVFZGl0LCBRVGV4dEVkaXQsIFFTcGluQm94IHsgYmFja2dyb3VuZC1jb2xvcjogIzJEMzc0ODsgYm9yZGVyOiAxcHggc29saWQgIzRBNTU2ODsgYm9yZGVyLXJhZGl1czogNHB4OyBwYWRkaW5nOiA1cHg7IH0NCiAgICAgICAgICAgIFFMaW5lRWRpdDpmb2N1cywgUVRleHRFZGl0OmZvY3VzLCBRU3BpbkJveDpmb2N1cyB7IGJvcmRlcjogMXB4IHNvbGlkICM0Mjk5RTE7IH0NCiAgICAgICAgICAgIFFQdXNoQnV0dG9uIHsgYmFja2dyb3VuZC1jb2xvcjogIzRBNTU2ODsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA0cHg7IHBhZGRpbmc6IDhweCAxNnB4OyBmb250LXdlaWdodDogYm9sZDsgfQ0KICAgICAgICAgICAgUVB1c2hCdXR0b246aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjNzE4MDk2OyB9DQogICAgICAgICAgICBRUHVzaEJ1dHRvbjpwcmVzc2VkIHsgYmFja2dyb3VuZC1jb2xvcjogIzJEMzc0ODsgfQ0KICAgICAgICAgICAgUVRhYldpZGdldDo6cGFuZSB7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjNEE1NTY4OyBtYXJnaW4tdG9wOiAtMXB4O30NCiAgICAgICAgICAgIFFUYWJCYXI6OnRhYiB7IGJhY2tncm91bmQ6ICMxQTIwMkM7IGJvcmRlcjogMXB4IHNvbGlkICM0QTU1Njg7IGJvcmRlci1ib3R0b206IG5vbmU7IHBhZGRpbmc6IDhweCAxNnB4OyB9DQogICAgICAgICAgICBRVGFiQmFyOjp0YWI6c2VsZWN0ZWQgeyBiYWNrZ3JvdW5kOiAjMkQzNzQ4OyBjb2xvcjogI0ZGRkZGRjsgfQ0KICAgICAgICAgICAgUVRhYmxlV2lkZ2V0IHsgZ3JpZGxpbmUtY29sb3I6ICM0QTU1Njg7IGJhY2tncm91bmQtY29sb3I6ICMyRDM3NDg7IH0NCiAgICAgICAgICAgIFFIZWFkZXJWaWV3OjpzZWN0aW9uIHsgYmFja2dyb3VuZC1jb2xvcjogIzRBNTU2ODsgcGFkZGluZzogNHB4OyBib3JkZXI6IDFweCBzb2xpZCAjMkQzNzQ4OyBmb250LXdlaWdodDogYm9sZDt9DQogICAgICAgICAgICBRUHJvZ3Jlc3NCYXIgeyBib3JkZXItcmFkaXVzOiA0cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6ICNGRkZGRkY7IGZvbnQtd2VpZ2h0OiBib2xkOyB9DQogICAgICAgICAgICBRUHJvZ3Jlc3NCYXI6OmNodW5rIHsgYmFja2dyb3VuZC1jb2xvcjogIzM4QTE2OTsgYm9yZGVyLXJhZGl1czogM3B4OyB9DQogICAgICAgICAgICBRU2Nyb2xsQXJlYSB7IGJvcmRlcjogbm9uZTsgfQ0KICAgICAgICAiIiIpDQoNCiAgICBkZWYgbG9hZF9zZXR0aW5ncyhzZWxmKToNCiAgICAgICAgY29uZmlnID0gc2VsZi5zY2FubmVyLmNvbmZpZw0KICAgICAgICBzZWxmLnRpbWVvdXRfc3Bpbi5zZXRWYWx1ZShjb25maWcuZ2V0KCd0aW1lb3V0JywgMTApKQ0KICAgICAgICBzZWxmLndvcmtlcnNfc3Bpbi5zZXRWYWx1ZShjb25maWcuZ2V0KCdtYXhfd29ya2VycycsIDQpKQ0KICAgICAgICBzZWxmLmRlYnVnX2NoZWNrLnNldENoZWNrZWQoY29uZmlnLmdldCgnZGVidWdfbW9kZScsIFRydWUpKQ0KICAgICAgICBzZWxmLnN1YmRvbWFpbl9jaGVjay5zZXRDaGVja2VkKGNvbmZpZy5nZXQoJ3N1YmRvbWFpbl9zY2FuJywgVHJ1ZSkpDQogICAgICAgIA0KICAgICAgICBzZWxmLmdlbWluaV9hcGlfbGluZS5zZXRUZXh0KGNvbmZpZy5nZXQoJ2dlbWluaV9hcGlfa2V5JywgJycpKQ0KICAgICAgICBzZWxmLmdlbWluaV9tb2RlbF9saW5lLnNldFRleHQoY29uZmlnLmdldCgnZ2VtaW5pX21vZGVsJywgJ2dlbWluaS0xLjUtZmxhc2gtbGF0ZXN0JykpDQogICAgICAgIHNlbGYuYWlfZG9ya19jaGVjay5zZXRDaGVja2VkKGNvbmZpZy5nZXQoJ3VzZV9nZW1pbmlfZm9yX2RvcmtzJywgVHJ1ZSkpDQogICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltJTkZPXSBTZXR0aW5ncyBsb2FkZWQuIikNCg0KICAgIGRlZiBzYXZlX3NldHRpbmdzKHNlbGYpOg0KICAgICAgICBjb25maWcgPSBzZWxmLnNjYW5uZXIuY29uZmlnDQogICAgICAgIGNvbmZpZ1sndGltZW91dCddID0gc2VsZi50aW1lb3V0X3NwaW4udmFsdWUoKQ0KICAgICAgICBjb25maWdbJ21heF93b3JrZXJzJ10gPSBzZWxmLndvcmtlcnNfc3Bpbi52YWx1ZSgpDQogICAgICAgIGNvbmZpZ1snZGVidWdfbW9kZSddID0gc2VsZi5kZWJ1Z19jaGVjay5pc0NoZWNrZWQoKQ0KICAgICAgICBjb25maWdbJ3N1YmRvbWFpbl9zY2FuJ10gPSBzZWxmLnN1YmRvbWFpbl9jaGVjay5pc0NoZWNrZWQoKQ0KICAgICAgICBjb25maWdbJ2dlbWluaV9hcGlfa2V5J10gPSBzZWxmLmdlbWluaV9hcGlfbGluZS50ZXh0KCkNCiAgICAgICAgY29uZmlnWydnZW1pbmlfbW9kZWwnXSA9IHNlbGYuZ2VtaW5pX21vZGVsX2xpbmUudGV4dCgpDQogICAgICAgIGNvbmZpZ1sndXNlX2dlbWluaV9mb3JfZG9ya3MnXSA9IHNlbGYuYWlfZG9ya19jaGVjay5pc0NoZWNrZWQoKQ0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2l0aCBvcGVuKCJjb25maWcuanNvbiIsICd3JykgYXMgZjoNCiAgICAgICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9NCkNCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltTVUNDRVNTXSBTZXR0aW5ncyBzYXZlZC4gTmV3IHNldHRpbmdzIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgbmV4dCBzY2FuLiIpDQogICAgICAgICAgICBzZWxmLnNjYW5uZXIgPSBXb3JkUHJlc3NTY2FubmVyKGNvbmZpZykNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgUU1lc3NhZ2VCb3guY3JpdGljYWwoc2VsZiwgIkVycm9yIiwgZiJDb3VsZCBub3Qgc2F2ZSBzZXR0aW5nczoge2V9IikNCg0KICAgIGRlZiBnZW5lcmF0ZV9kb3JrcyhzZWxmKToNCiAgICAgICAga2V5d29yZHMgPSBbay5zdHJpcCgpIGZvciBrIGluIHNlbGYua2V5d29yZHNfdGV4dC50b1BsYWluVGV4dCgpLnN0cmlwKCkuc3BsaXQoJ1xuJykgaWYgay5zdHJpcCgpXQ0KICAgICAgICBwYXR0ZXJucyA9IFtwLnN0cmlwKCkgZm9yIHAgaW4gc2VsZi5wYXR0ZXJuc190ZXh0LnRvUGxhaW5UZXh0KCkuc3RyaXAoKS5zcGxpdCgnXG4nKSBpZiBwLnN0cmlwKCldDQogICAgICAgIGlmIG5vdCBrZXl3b3JkczoNCiAgICAgICAgICAgIFFNZXNzYWdlQm94Lndhcm5pbmcoc2VsZiwgIklucHV0IE5lZWRlZCIsICJQbGVhc2UgZW50ZXIgYXQgbGVhc3Qgb25lIGtleXdvcmQuIikNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgIGJhc2VfZG9ya3MgPSBzZWxmLnNjYW5uZXIuZ2VuZXJhdGVfZG9ya3NfZnJvbV9rZXl3b3JkcyhrZXl3b3JkcywgcGF0dGVybnMpDQogICAgICAgIHNlbGYucHJldmlld190ZXh0LnNldFRleHQoIlxuIi5qb2luKGJhc2VfZG9ya3MpKQ0KICAgICAgICBzZWxmLnByZXZpZXdfY291bnRfbGFiZWwuc2V0VGV4dChmIntsZW4oYmFzZV9kb3Jrcyl9IGJhc2UgZG9ya3MgZ2VuZXJhdGVkLiIpDQogICAgICAgIHNlbGYubG9nX21lc3NhZ2UoZiJbSU5GT10gR2VuZXJhdGVkIHtsZW4oYmFzZV9kb3Jrcyl9IGRvcmtzIGZyb20gcGF0dGVybnMuIikNCg0KICAgICAgICBpZiBzZWxmLmFpX2RvcmtfY2hlY2suaXNDaGVja2VkKCkgYW5kIHNlbGYuZ2VtaW5pX2FwaV9saW5lLnRleHQoKToNCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltJTkZPXSBHZW5lcmF0aW5nIGFkZGl0aW9uYWwgZG9ya3Mgd2l0aCBHZW1pbmkuLi4iKQ0KICAgICAgICAgICAgc2VsZi5nZW1pbmlfd29ya2VyID0gR2VtaW5pRG9ya1dvcmtlcihzZWxmLmdlbWluaV9hcGlfbGluZS50ZXh0KCksIHNlbGYuZ2VtaW5pX21vZGVsX2xpbmUudGV4dCgpLCBrZXl3b3JkcywgNTApDQogICAgICAgICAgICBzZWxmLmdlbWluaV93b3JrZXIuc2lnbmFscy5sb2dfbWVzc2FnZS5jb25uZWN0KHNlbGYubG9nX21lc3NhZ2UpDQogICAgICAgICAgICBzZWxmLmdlbWluaV93b3JrZXIuc2lnbmFscy5kb3Jrc19nZW5lcmF0ZWQuY29ubmVjdChzZWxmLmFkZF9haV9kb3JrcykNCiAgICAgICAgICAgIHNlbGYuZ2VtaW5pX3dvcmtlci5zdGFydCgpDQoNCiAgICBkZWYgYWRkX2FpX2RvcmtzKHNlbGYsIGFpX2RvcmtzKToNCiAgICAgICAgaWYgbm90IGFpX2RvcmtzOg0KICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZSgiW1dBUk5dIEdlbWluaSBkaWQgbm90IHJldHVybiBhbnkgZG9ya3MuIikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgc2VsZi5sb2dfbWVzc2FnZShmIltTVUNDRVNTXSBHZW1pbmkgZ2VuZXJhdGVkIHtsZW4oYWlfZG9ya3MpfSBhZGRpdGlvbmFsIGRvcmtzLiIpDQogICAgICAgIGN1cnJlbnRfZG9ya3MgPSBzZXQoc2VsZi5zY2FubmVyLmRvcmtzKQ0KICAgICAgICBjdXJyZW50X2RvcmtzLnVwZGF0ZShhaV9kb3JrcykNCiAgICAgICAgc2VsZi5zY2FubmVyLmRvcmtzID0gc29ydGVkKGxpc3QoY3VycmVudF9kb3JrcykpDQogICAgICAgIHNlbGYucHJldmlld190ZXh0LnNldFRleHQoIlxuIi5qb2luKHNlbGYuc2Nhbm5lci5kb3JrcykpDQogICAgICAgIHNlbGYucHJldmlld19jb3VudF9sYWJlbC5zZXRUZXh0KGYie2xlbihzZWxmLnNjYW5uZXIuZG9ya3MpfSB0b3RhbCBkb3JrcyBnZW5lcmF0ZWQuIikNCg0KICAgIGRlZiBzdGFydF9zY2FuKHNlbGYpOg0KICAgICAgICBzZWxmLnNjYW5uZXIgPSBXb3JkUHJlc3NTY2FubmVyKCkNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBzZWxmLnNjYW5uZXIuZG9ya3M6DQogICAgICAgICAgICBzZWxmLmdlbmVyYXRlX2RvcmtzKCkNCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnNjYW5uZXIuZG9ya3M6DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICBzZWxmLndvcmtlciA9IFNjYW5uZXJXb3JrZXIoc2VsZi5zY2FubmVyKQ0KICAgICAgICBzZWxmLndvcmtlci5zaWduYWxzLmxvZ19tZXNzYWdlLmNvbm5lY3Qoc2VsZi5sb2dfbWVzc2FnZSkNCiAgICAgICAgc2VsZi53b3JrZXIuc2lnbmFscy5sb2dfbWVzc2FnZXMuY29ubmVjdChzZWxmLmFkZF9sb2dfbWVzc2FnZXNfYmF0Y2gpDQogICAgICAgIHNlbGYud29ya2VyLnNpZ25hbHMucmVzdWx0c19mb3VuZC5jb25uZWN0KHNlbGYuYWRkX3Jlc3VsdHNfYmF0Y2gpDQogICAgICAgIHNlbGYud29ya2VyLnNpZ25hbHMuc3ViZG9tYWluc19mb3VuZC5jb25uZWN0KHNlbGYuYWRkX3N1YmRvbWFpbnNfYmF0Y2gpDQogICAgICAgIHNlbGYud29ya2VyLnNpZ25hbHMuc2Nhbl9wcm9ncmVzcy5jb25uZWN0KHNlbGYudXBkYXRlX3Byb2dyZXNzKQ0KICAgICAgICBzZWxmLndvcmtlci5zaWduYWxzLnNjYW5uaW5nX3N0b3BwZWQuY29ubmVjdChzZWxmLm9uX3NjYW5fc3RvcCkNCiAgICAgICAgDQogICAgICAgIHNlbGYuc3RhcnRfYnRuLnNldEVuYWJsZWQoRmFsc2UpDQogICAgICAgIHNlbGYuc3RvcF9idG4uc2V0RW5hYmxlZChUcnVlKQ0KICAgICAgICBzZWxmLndvcmtlci5zdGFydCgpDQoNCiAgICBkZWYgc3RvcF9zY2FuKHNlbGYpOg0KICAgICAgICBpZiBzZWxmLndvcmtlciBhbmQgc2VsZi53b3JrZXIuaXNSdW5uaW5nKCk6DQogICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKCJbSU5GT10gU3RvcHBpbmcgc2Nhbi4uLiBQbGVhc2Ugd2FpdC4iKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXIuc3RvcCgpDQogICAgICAgICAgICBzZWxmLnN0b3BfYnRuLnNldEVuYWJsZWQoRmFsc2UpDQoNCiAgICBkZWYgbG9nX21lc3NhZ2Uoc2VsZiwgbWVzc2FnZTogc3RyKToNCiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikNCiAgICAgICAgc2VsZi5sb2dfdGV4dC5hcHBlbmQoZiJbe3RpbWVzdGFtcH1dIHttZXNzYWdlfSIpDQoNCiAgICBkZWYgYWRkX2xvZ19tZXNzYWdlc19iYXRjaChzZWxmLCBtZXNzYWdlczogbGlzdCk6DQogICAgICAgICIiIkFwcGVuZHMgYSBiYXRjaCBvZiBtZXNzYWdlcyB0byB0aGUgbG9nIHRleHQgZWRpdC4iIiINCiAgICAgICAgdGltZXN0YW1wZWRfbWVzc2FnZXMgPSBbZiJbe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpfV0ge21zZ30iIGZvciBtc2cgaW4gbWVzc2FnZXNdDQogICAgICAgIGN1cnJlbnRfdGV4dCA9IHNlbGYubG9nX3RleHQudG9QbGFpblRleHQoKQ0KICAgICAgICBpZiBsZW4oY3VycmVudF90ZXh0KSA+IDUwMDAwOg0KICAgICAgICAgICAgc2VsZi5sb2dfdGV4dC5zZXRQbGFpblRleHQoY3VycmVudF90ZXh0Wy00MDAwMDpdKQ0KDQogICAgICAgIHNlbGYubG9nX3RleHQuYXBwZW5kKCJcbiIuam9pbih0aW1lc3RhbXBlZF9tZXNzYWdlcykpDQogICAgICAgIHNlbGYubG9nX3RleHQudmVydGljYWxTY3JvbGxCYXIoKS5zZXRWYWx1ZShzZWxmLmxvZ190ZXh0LnZlcnRpY2FsU2Nyb2xsQmFyKCkubWF4aW11bSgpKQ0KDQoNCiAgICBkZWYgYWRkX3Jlc3VsdHNfYmF0Y2goc2VsZiwgcmVzdWx0czogbGlzdCk6DQogICAgICAgICIiIkFkZHMgYSBiYXRjaCBvZiBVUkwvZG9tYWluIHJlc3VsdHMgdG8gdGhlIHRhYmxlcyBlZmZpY2llbnRseS4iIiINCiAgICAgICAgc2VsZi51cmxzX2xpc3Quc2V0VXBkYXRlc0VuYWJsZWQoRmFsc2UpDQogICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKEZhbHNlKQ0KICAgICAgICANCiAgICAgICAgZXhpc3RpbmdfZG9tYWlucyA9IHtzZWxmLmRvbWFpbnNfbGlzdC5pdGVtKHIsIDApLnRleHQoKSBmb3IgciBpbiByYW5nZShzZWxmLmRvbWFpbnNfbGlzdC5yb3dDb3VudCgpKX0NCiAgICAgICAgDQogICAgICAgIGZvciB1cmwsIGRvbWFpbiBpbiByZXN1bHRzOg0KICAgICAgICAgICAgc2VsZi5hZGRfaXRlbV90b190YWJsZShzZWxmLnVybHNfbGlzdCwgW3VybF0pDQogICAgICAgICAgICBpZiBkb21haW4gbm90IGluIGV4aXN0aW5nX2RvbWFpbnM6DQogICAgICAgICAgICAgICAgc2VsZi5hZGRfaXRlbV90b190YWJsZShzZWxmLmRvbWFpbnNfbGlzdCwgW2RvbWFpbl0pDQogICAgICAgICAgICAgICAgZXhpc3RpbmdfZG9tYWlucy5hZGQoZG9tYWluKQ0KDQogICAgICAgIHNlbGYudXJsc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKFRydWUpDQogICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKFRydWUpDQogICAgICAgIHNlbGYudXBkYXRlX2NvdW50cygpDQoNCiAgICBkZWYgYWRkX3N1YmRvbWFpbnNfYmF0Y2goc2VsZiwgc3ViZG9tYWluczogbGlzdCk6DQogICAgICAgICIiIkFkZHMgYSBiYXRjaCBvZiBzdWJkb21haW4gcmVzdWx0cyB0byB0aGUgdGFibGUuIiIiDQogICAgICAgIHNlbGYuc3ViZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKEZhbHNlKQ0KICAgICAgICBmb3IgZnFkbiwgZG9tYWluLCBpbmZvIGluIHN1YmRvbWFpbnM6DQogICAgICAgICAgICBzZWxmLmFkZF9pdGVtX3RvX3RhYmxlKHNlbGYuc3ViZG9tYWluc19saXN0LCBbDQogICAgICAgICAgICAgICAgZnFkbiwNCiAgICAgICAgICAgICAgICBpbmZvLmdldCgndGl0bGUnLCAnTi9BJyksDQogICAgICAgICAgICAgICAgIiwgIi5qb2luKGluZm8uZ2V0KCdBJywgW10pKQ0KICAgICAgICAgICAgXSkNCiAgICAgICAgc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0VXBkYXRlc0VuYWJsZWQoVHJ1ZSkNCiAgICAgICAgc2VsZi51cGRhdGVfY291bnRzKCkNCg0KICAgIGRlZiB1cGRhdGVfcHJvZ3Jlc3Moc2VsZiwgdmFsdWU6IGludCwgdG90YWw6IGludCk6DQogICAgICAgIGlmIHRvdGFsID4gMDoNCiAgICAgICAgICAgIHBlcmNlbnQgPSBpbnQoKHZhbHVlIC8gdG90YWwpICogMTAwKQ0KICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19iYXIuc2V0VmFsdWUocGVyY2VudCkNCiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfYmFyLnNldEZvcm1hdChmInt2YWx1ZX0gLyB7dG90YWx9IikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfYmFyLnNldFZhbHVlKDApDQogICAgICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRGb3JtYXQoIk4vQSIpDQoNCiAgICBkZWYgb25fc2Nhbl9zdG9wKHNlbGYsIHJlYXNvbjogc3RyKToNCiAgICAgICAgc2VsZi5zdGFydF9idG4uc2V0RW5hYmxlZChUcnVlKQ0KICAgICAgICBzZWxmLnN0b3BfYnRuLnNldEVuYWJsZWQoRmFsc2UpDQogICAgICAgIHNlbGYubG9nX21lc3NhZ2UoZiJbSU5GT10gU2NhbiBmaW5pc2hlZDoge3JlYXNvbn0iKQ0KICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRWYWx1ZSgxMDApDQogICAgICAgIHNlbGYucHJvZ3Jlc3NfYmFyLnNldEZvcm1hdCgiQ29tcGxldGVkIikNCiAgICAgICAgc2VsZi5zY2FubmVyLnNhdmVfcmVzdWx0cygpDQogICAgICAgIHNlbGYud29ya2VyID0gTm9uZQ0KDQogICAgZGVmIGFkZF9pdGVtX3RvX3RhYmxlKHNlbGYsIHRhYmxlOiBRVGFibGVXaWRnZXQsIGl0ZW1fZGF0YTogTGlzdFtzdHJdKToNCiAgICAgICAgcm93X3Bvc2l0aW9uID0gdGFibGUucm93Q291bnQoKQ0KICAgICAgICB0YWJsZS5pbnNlcnRSb3cocm93X3Bvc2l0aW9uKQ0KICAgICAgICBmb3IgY29sLCB0ZXh0IGluIGVudW1lcmF0ZShpdGVtX2RhdGEpOg0KICAgICAgICAgICAgdGFibGUuc2V0SXRlbShyb3dfcG9zaXRpb24sIGNvbCwgUVRhYmxlV2lkZ2V0SXRlbSh0ZXh0KSkNCg0KICAgIGRlZiB1cGRhdGVfY291bnRzKHNlbGYpOg0KICAgICAgICBzZWxmLnVybHNfbGFiZWwuc2V0VGV4dChmIlVSTHM6IHtzZWxmLnVybHNfbGlzdC5yb3dDb3VudCgpfSIpDQogICAgICAgIHNlbGYuZG9tYWluc19sYWJlbC5zZXRUZXh0KGYiRG9tYWluczoge3NlbGYuZG9tYWluc19saXN0LnJvd0NvdW50KCl9IikNCiAgICAgICAgDQogICAgZGVmIGNsZWFyX3Jlc3VsdHMoc2VsZik6DQogICAgICAgIHNlbGYudXJsc19saXN0LnNldFJvd0NvdW50KDApDQogICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFJvd0NvdW50KDApDQogICAgICAgIGlmIHNlbGYuc2Nhbm5lcjoNCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX3VybHMuY2xlYXIoKQ0KICAgICAgICAgICAgc2VsZi5zY2FubmVyLmRpc2NvdmVyZWRfZG9tYWlucy5jbGVhcigpDQogICAgICAgIHNlbGYudXBkYXRlX2NvdW50cygpDQogICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltJTkZPXSBDbGVhcmVkIFVSTCBhbmQgRG9tYWluIHJlc3VsdHMuIikNCg0KICAgIGRlZiBzYXZlX3Jlc3VsdHNfbWFudWFsKHNlbGYpOg0KICAgICAgICAiIiJNYW51YWxseSBzYXZlIHRoZSBjdXJyZW50IHJlc3VsdHMgdG8gZmlsZXMuIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIG9zLm1ha2VkaXJzKCJyZXN1bHRzIiwgZXhpc3Rfb2s9VHJ1ZSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBTYXZlIFVSTHMNCiAgICAgICAgICAgIHVybHMgPSBbXQ0KICAgICAgICAgICAgZm9yIHJvdyBpbiByYW5nZShzZWxmLnVybHNfbGlzdC5yb3dDb3VudCgpKToNCiAgICAgICAgICAgICAgICBpdGVtID0gc2VsZi51cmxzX2xpc3QuaXRlbShyb3csIDApDQogICAgICAgICAgICAgICAgaWYgaXRlbToNCiAgICAgICAgICAgICAgICAgICAgdXJscy5hcHBlbmQoaXRlbS50ZXh0KCkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLnNjYW5uZXIuY29uZmlnWyd1cmxzX2ZpbGUnXSwgJ3cnKSBhcyBmOg0KICAgICAgICAgICAgICAgIGZvciB1cmwgaW4gdXJsczoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmInt1cmx9XG4iKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFNhdmUgRG9tYWlucw0KICAgICAgICAgICAgZG9tYWlucyA9IFtdDQogICAgICAgICAgICBmb3Igcm93IGluIHJhbmdlKHNlbGYuZG9tYWluc19saXN0LnJvd0NvdW50KCkpOg0KICAgICAgICAgICAgICAgIGl0ZW0gPSBzZWxmLmRvbWFpbnNfbGlzdC5pdGVtKHJvdywgMCkNCiAgICAgICAgICAgICAgICBpZiBpdGVtOg0KICAgICAgICAgICAgICAgICAgICBkb21haW5zLmFwcGVuZChpdGVtLnRleHQoKSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuc2Nhbm5lci5jb25maWdbJ2RvbWFpbnNfZmlsZSddLCAndycpIGFzIGY6DQogICAgICAgICAgICAgICAgZm9yIGRvbWFpbiBpbiBkb21haW5zOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYie2RvbWFpbn1cbiIpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoZiJbU1VDQ0VTU10gUmVzdWx0cyBzYXZlZCB0byB7c2VsZi5zY2FubmVyLmNvbmZpZ1sndXJsc19maWxlJ119IGFuZCB7c2VsZi5zY2FubmVyLmNvbmZpZ1snZG9tYWluc19maWxlJ119IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZShmIltFUlJPUl0gRmFpbGVkIHRvIHNhdmUgcmVzdWx0czoge2V9IikNCiAgICAgICAgICAgIFFNZXNzYWdlQm94LmNyaXRpY2FsKHNlbGYsICJFcnJvciIsIGYiRmFpbGVkIHRvIHNhdmUgcmVzdWx0czoge2V9IikNCg0KICAgIGRlZiBzYXZlX3N1YmRvbWFpbnNfbWFudWFsKHNlbGYpOg0KICAgICAgICAiIiJNYW51YWxseSBzYXZlIHRoZSBjdXJyZW50IHN1YmRvbWFpbnMgdG8gZmlsZS4iIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgb3MubWFrZWRpcnMoInJlc3VsdHMiLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFNhdmUgU3ViZG9tYWlucw0KICAgICAgICAgICAgc3ViZG9tYWlucyA9IFtdDQogICAgICAgICAgICBmb3Igcm93IGluIHJhbmdlKHNlbGYuc3ViZG9tYWluc19saXN0LnJvd0NvdW50KCkpOg0KICAgICAgICAgICAgICAgIHN1YmRvbWFpbl9pdGVtID0gc2VsZi5zdWJkb21haW5zX2xpc3QuaXRlbShyb3csIDApDQogICAgICAgICAgICAgICAgaWYgc3ViZG9tYWluX2l0ZW06DQogICAgICAgICAgICAgICAgICAgIHN1YmRvbWFpbnMuYXBwZW5kKHN1YmRvbWFpbl9pdGVtLnRleHQoKSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuc2Nhbm5lci5jb25maWdbJ3N1YmRvbWFpbnNfZmlsZSddLCAndycpIGFzIGY6DQogICAgICAgICAgICAgICAgZm9yIHN1YmRvbWFpbiBpbiBzdWJkb21haW5zOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYie3N1YmRvbWFpbn1cbiIpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoZiJbU1VDQ0VTU10gU3ViZG9tYWlucyBzYXZlZCB0byB7c2VsZi5zY2FubmVyLmNvbmZpZ1snc3ViZG9tYWluc19maWxlJ119IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZShmIltFUlJPUl0gRmFpbGVkIHRvIHNhdmUgc3ViZG9tYWluczoge2V9IikNCiAgICAgICAgICAgIFFNZXNzYWdlQm94LmNyaXRpY2FsKHNlbGYsICJFcnJvciIsIGYiRmFpbGVkIHRvIHNhdmUgc3ViZG9tYWluczoge2V9IikNCg0KICAgIGRlZiBzZXR1cF9jb250ZXh0X21lbnVzKHNlbGYpOg0KICAgICAgICBmb3IgdGFibGUgaW4gW3NlbGYudXJsc19saXN0LCBzZWxmLmRvbWFpbnNfbGlzdCwgc2VsZi5zdWJkb21haW5zX2xpc3RdOg0KICAgICAgICAgICAgdGFibGUuc2V0Q29udGV4dE1lbnVQb2xpY3koUXQuQ3VzdG9tQ29udGV4dE1lbnUpDQogICAgICAgICAgICB0YWJsZS5jdXN0b21Db250ZXh0TWVudVJlcXVlc3RlZC5jb25uZWN0KGxhbWJkYSBwb3MsIHQ9dGFibGU6IHNlbGYuc2hvd19jb250ZXh0X21lbnUocG9zLCB0KSkNCg0KICAgIGRlZiBzaG93X2NvbnRleHRfbWVudShzZWxmLCBwb3NpdGlvbiwgdGFibGU6IFFUYWJsZVdpZGdldCk6DQogICAgICAgIG1lbnUgPSBRTWVudSgpDQogICAgICAgIG1lbnUuc2V0U3R5bGVTaGVldCgiUU1lbnUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMkQzNzQ4OyBjb2xvcjogI0UyRThGMDsgfSBRTWVudTo6aXRlbTpzZWxlY3RlZCB7IGJhY2tncm91bmQtY29sb3I6ICM0QTU1Njg7IH0iKQ0KICAgICAgICANCiAgICAgICAgc2VsZWN0ZWRfaXRlbXMgPSB0YWJsZS5zZWxlY3RlZEl0ZW1zKCkNCiAgICAgICAgaWYgbm90IHNlbGVjdGVkX2l0ZW1zOg0KICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgY29weV9hY3Rpb24gPSBtZW51LmFkZEFjdGlvbigiQ29weSIpDQogICAgICAgIG9wZW5fYWN0aW9uID0gbWVudS5hZGRBY3Rpb24oIk9wZW4gaW4gQnJvd3NlciIpDQogICAgICAgIA0KICAgICAgICBhY3Rpb24gPSBtZW51LmV4ZWNfKHRhYmxlLnZpZXdwb3J0KCkubWFwVG9HbG9iYWwocG9zaXRpb24pKQ0KICAgICAgICANCiAgICAgICAgaWYgYWN0aW9uID09IGNvcHlfYWN0aW9uOg0KICAgICAgICAgICAgUUFwcGxpY2F0aW9uLmNsaXBib2FyZCgpLnNldFRleHQoc2VsZWN0ZWRfaXRlbXNbMF0udGV4dCgpKQ0KICAgICAgICBlbGlmIGFjdGlvbiA9PSBvcGVuX2FjdGlvbjoNCiAgICAgICAgICAgIGl0ZW1fdGV4dCA9IHNlbGVjdGVkX2l0ZW1zWzBdLnRleHQoKQ0KICAgICAgICAgICAgdXJsID0gaXRlbV90ZXh0IGlmIGl0ZW1fdGV4dC5zdGFydHN3aXRoKCJodHRwIikgZWxzZSBmImh0dHA6Ly97aXRlbV90ZXh0fSINCiAgICAgICAgICAgIHdlYmJyb3dzZXIub3Blbih1cmwpDQoNCiAgICBkZWYgY2xvc2VFdmVudChzZWxmLCBldmVudCk6DQogICAgICAgIGlmIHNlbGYud29ya2VyIGFuZCBzZWxmLndvcmtlci5pc1J1bm5pbmcoKToNCiAgICAgICAgICAgIHJlcGx5ID0gUU1lc3NhZ2VCb3gucXVlc3Rpb24oc2VsZiwgJ1NjYW4gaW4gUHJvZ3Jlc3MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBIHNjYW4gaXMgY3VycmVudGx5IHJ1bm5pbmcuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBleGl0PyIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUU1lc3NhZ2VCb3guWWVzIHwgUU1lc3NhZ2VCb3guTm8sIFFNZXNzYWdlQm94Lk5vKQ0KICAgICAgICAgICAgaWYgcmVwbHkgPT0gUU1lc3NhZ2VCb3guWWVzOg0KICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9zY2FuKCkNCiAgICAgICAgICAgICAgICBzZWxmLndvcmtlci53YWl0KDMwMDApDQogICAgICAgICAgICAgICAgZXZlbnQuYWNjZXB0KCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgZXZlbnQuaWdub3JlKCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIGV2ZW50LmFjY2VwdCgpDQoNCmRlZiBwcmludF9pbnN0YWxsYXRpb25faW5zdHJ1Y3Rpb25zKCk6DQogICAgcHJpbnQoIlxuIiArICI9Iio2MCkNCiAgICBwcmludCgiTUFTUyBXT1JEUFJFU1MgU0NSQVBFUiAtIElOU1RBTExBVElPTiBJTlNUUlVDVElPTlMiKQ0KICAgIHByaW50KCI9Iio2MCkNCiAgICANCiAgICBwcmludCgiXG4xLiBJTlNUQUxMIERFUEVOREVOQ0lFUzoiKQ0KICAgIHByaW50KCIgICBwaXAgaW5zdGFsbCBkZGdzIGFpb2RucyBhaW9odHRwIFB5UXQ1IGNvbG9yYW1hIGdvb2dsZS1nZW5lcmF0aXZlYWkiKQ0KICAgIA0KICAgIHByaW50KCJcbjIuIFBMQVRGT1JNLVNQRUNJRklDIE5PVEVTOiIpDQogICAgDQogICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gIldpbmRvd3MiOg0KICAgICAgICBwcmludCgiXG4gICBXSU5ET1dTIFVTRVJTOiIpDQogICAgICAgIHByaW50KCIgICAtIE1ha2Ugc3VyZSBQeXRob24gMy44KyBpcyBpbnN0YWxsZWQiKQ0KICAgICAgICBwcmludCgiICAgLSBSdW4gdGhlIHNjcmlwdCB3aXRoOiBweXRob24gV29yZHByZXNzR3JhYmJlckQucHkiKQ0KICAgICAgICBwcmludCgiICAgLSBJZiB5b3UgZW5jb3VudGVyIGRpc3BsYXkgaXNzdWVzLCB0cnkgcnVubmluZyBpbiBXaW5kb3dzIFRlcm1pbmFsIikNCiAgICAgICAgDQogICAgZWxpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiTGludXgiOg0KICAgICAgICBwcmludCgiXG4gICBMSU5VWCBVU0VSUzoiKQ0KICAgICAgICBwcmludCgiICAgLSBJbnN0YWxsIFB5dGhvbiAzOiBzdWRvIGFwdCBpbnN0YWxsIHB5dGhvbjMgcHl0aG9uMy1waXAiKQ0KICAgICAgICBwcmludCgiICAgLSBJbnN0YWxsIFF0IGRlcGVuZGVuY2llczogc3VkbyBhcHQgaW5zdGFsbCBweXRob24zLXB5cXQ1IikNCiAgICAgICAgcHJpbnQoIiAgIC0gUnVuIHRoZSBzY3JpcHQgd2l0aDogcHl0aG9uMyBXb3JkcHJlc3NHcmFiYmVyRC5weSIpDQogICAgICAgIHByaW50KCIgICAtIElmIHVzaW5nIFNTSCwgdXNlIFgxMSBmb3J3YXJkaW5nOiBzc2ggLVggdXNlckBob3N0IikNCiAgICANCiAgICBwcmludCgiXG4zLiBPUFRJT05BTDogQUREIEEgTE9HTyIpDQogICAgcHJpbnQoIiAgIC0gUGxhY2UgYSBQTkcgaW1hZ2UgbmFtZWQgJ2xvZ28ucG5nJyBpbiB0aGUgc2FtZSBkaXJlY3RvcnkiKQ0KICAgIHByaW50KCIgICAtIFRoaXMgd2lsbCBiZSB1c2VkIGFzIHRoZSBhcHBsaWNhdGlvbiBpY29uIikNCiAgICANCiAgICBwcmludCgiXG40LiBDT05GSUdVUkFUSU9OOiIpDQogICAgcHJpbnQoIiAgIC0gVGhlIHRvb2wgd2lsbCBjcmVhdGUgYSAnY29uZmlnLmpzb24nIGZpbGUgb24gZmlyc3QgcnVuIikNCiAgICBwcmludCgiICAgLSBSZXN1bHRzIHdpbGwgYmUgc2F2ZWQgaW4gdGhlICdyZXN1bHRzLycgZGlyZWN0b3J5IikNCiAgICANCiAgICBwcmludCgiXG41LiBHRU1JTkkgQUkgRkVBVFVSRVM6IikNCiAgICBwcmludCgiICAgLSBBZGQgeW91ciBBUEkga2V5IGluIFNldHRpbmdzIHRvIGVuYWJsZSBBSS1wb3dlcmVkIGRvcmsgZ2VuZXJhdGlvbiIpDQogICAgcHJpbnQoIiAgIC0gUmVxdWlyZXM6IHBpcCBpbnN0YWxsIGdvb2dsZS1nZW5lcmF0aXZlYWkiKQ0KICAgIA0KICAgIHByaW50KCJcbjYuIEVOSEFOQ0VEIFNVQkRPTUFJTiBTQ0FOTklORzoiKQ0KICAgIHByaW50KCIgICAtIE5vdyB1c2VzIG11bHRpcGxlIG1ldGhvZHMgZm9yIGNvbXByZWhlbnNpdmUgc3ViZG9tYWluIGRpc2NvdmVyeSIpDQogICAgcHJpbnQoIiAgIC0gSW5jbHVkZXMgZXhwYW5kZWQgYmFzZSBzZWVkcyBhbmQgV29yZFByZXNzLXNwZWNpZmljIHBhdHRlcm5zIikNCiAgICANCiAgICBwcmludCgiXG43LiBJTVBST1ZFRCBFUlJPUiBIQU5ETElORzoiKQ0KICAgIHByaW50KCIgICAtIEJldHRlciBoYW5kbGluZyBvZiBnemlwIHJlc3BvbnNlcyBhbmQgbmV0d29yayBpc3N1ZXMiKQ0KICAgIHByaW50KCIgICAtIFJlZHVjZWQgd2FybmluZyBtZXNzYWdlcyBmb3IgZW1wdHkgcmVzcG9uc2VzIikNCiAgICANCiAgICBwcmludCgiXG4iICsgIj0iKjYwKQ0KICAgIHByaW50KCJSRUFEWSBUTyBSVU4hIikNCiAgICBwcmludCgiPSIqNjApDQoNCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6DQogICAgcHJpbnRfaW5zdGFsbGF0aW9uX2luc3RydWN0aW9ucygpDQogICAgDQogICAgUUFwcGxpY2F0aW9uLnNldEF0dHJpYnV0ZShRdC5BQV9FbmFibGVIaWdoRHBpU2NhbGluZywgVHJ1ZSkNCiAgICBRQXBwbGljYXRpb24uc2V0QXR0cmlidXRlKFF0LkFBX1VzZUhpZ2hEcGlQaXhtYXBzLCBUcnVlKQ0KICAgIA0KICAgIGFwcCA9IFFBcHBsaWNhdGlvbihzeXMuYXJndikNCiAgICANCiAgICAjIC0tLSBTZXQgQXBwbGljYXRpb24td2lkZSBJY29uIC0tLQ0KICAgIGxvZ29fcGl4bWFwID0gUVBpeG1hcCgpDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKCJsb2dvLnBuZyIpIG9yIG5vdCBsb2dvX3BpeG1hcC5sb2FkKCJsb2dvLnBuZyIpOg0KICAgICAgICBwcmludCgiW1dBUk5JTkddIGxvZ28ucG5nIG5vdCBmb3VuZCBvciBjb3VsZCBub3QgYmUgbG9hZGVkLiBUaGUgYXBwbGljYXRpb24gd2lsbCBydW4gd2l0aG91dCBhbiBpY29uLiIpDQogICAgICAgIGxvZ29fcGl4bWFwID0gTm9uZQ0KICAgIGVsc2U6DQogICAgICAgIGFwcC5zZXRXaW5kb3dJY29uKFFJY29uKGxvZ29fcGl4bWFwKSkNCiAgICAgICAgDQogICAgd2luZG93ID0gV29yZFByZXNzU2Nhbm5lclVJKGxvZ29fcGl4bWFwPWxvZ29fcGl4bWFwKQ0KICAgIHdpbmRvdy5zaG93KCkNCiAgICBzeXMuZXhpdChhcHAuZXhlY18oKSkNCg=="""

def main():
    try:
        decoded_code = base64.b64decode(ENCRYPTED_CODE).decode('utf-8')
        exec(decoded_code, {"__name__": "__main__", "__builtins__": __builtins__})
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()