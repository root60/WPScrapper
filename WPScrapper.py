import base64
import sys

ENCRYPTED_CODE = """
IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMw0KIyBNYXNzIFdvcmRwcmVzcyBTY3JhcHBlciB2Mi0gRGV2ZWxvcGVkIGJ5IFJlZEh5ZHJhIChlbmhhbmNlZCkNCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KaW1wb3J0IHRpbWUNCmltcG9ydCBhc3luY2lvDQppbXBvcnQgdGhyZWFkaW5nDQppbXBvcnQgdHJhY2ViYWNrDQppbXBvcnQgd2ViYnJvd3Nlcg0KaW1wb3J0IHJlDQppbXBvcnQgaHRtbA0KZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVxdWUNCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZSwgdXJsam9pbg0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUNCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBBbnksIE9wdGlvbmFsLCBMaXN0LCBUdXBsZSwgU2V0DQppbXBvcnQgcGxhdGZvcm0NCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgc2lnbmFsDQoNCiMgLS0tIERlcGVuZGVuY3kgQ2hlY2sgYXQgU3RhcnR1cCAtLS0NCnRyeToNCiAgICBpbXBvcnQgYWlvZG5zDQogICAgaW1wb3J0IGFpb2h0dHANCiAgICBmcm9tIGRkZ3MgaW1wb3J0IERER1MNCiAgICBmcm9tIGNvbG9yYW1hIGltcG9ydCBpbml0LCBGb3JlDQogICAgaW5pdChhdXRvcmVzZXQ9VHJ1ZSkNCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICBwcmludCgiPSIqNjApDQogICAgcHJpbnQoIkVSUk9SOiBNaXNzaW5nIHJlcXVpcmVkIGxpYnJhcmllcy4iKQ0KICAgIHByaW50KCJQbGVhc2UgaW5zdGFsbCB0aGVtIGJ5IHJ1bm5pbmcgdGhlIGZvbGxvd2luZyBjb21tYW5kOiIpDQogICAgcHJpbnQoIlxucGlwIGluc3RhbGwgZGRncyBhaW9kbnMgYWlvaHR0cCBjb2xvcmFtYVxuIikNCiAgICBwcmludCgiRm9yIHRoZSBHVUksIHlvdSBhbHNvIG5lZWQgUHlRdDU6IikNCiAgICBwcmludCgiXG5waXAgaW5zdGFsbCBQeVF0NVxuIikNCiAgICBwcmludCgiPSIqNjApDQogICAgc3lzLmV4aXQoMSkNCg0KIyBGaXggZm9yIExpbnV4IGVudmlyb25tZW50IHZhcmlhYmxlcyB3aGVuIHJ1bm5pbmcgYXMgcm9vdCAoa2VlcHMgb3JpZ2luYWwgYmVoYXZpb3IpDQppZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAiTGludXgiOg0KICAgICMgU2V0IFhER19SVU5USU1FX0RJUiBpZiBub3Qgc2V0DQogICAgaWYgJ1hER19SVU5USU1FX0RJUicgbm90IGluIG9zLmVudmlyb246DQogICAgICAgIHJ1bnRpbWVfZGlyID0gJy90bXAvcnVudGltZS1yb290Jw0KICAgICAgICBvcy5lbnZpcm9uWydYREdfUlVOVElNRV9ESVInXSA9IHJ1bnRpbWVfZGlyDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIG9zLm1ha2VkaXJzKHJ1bnRpbWVfZGlyLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgb3MuY2htb2QocnVudGltZV9kaXIsIDBvNzAwKQ0KICAgICAgICAgICAgcHJpbnQoZiJbSU5GT10gWERHX1JVTlRJTUVfRElSIHNldCB0byB7cnVudGltZV9kaXJ9IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgcHJpbnQoZiJbV0FSTklOR10gQ291bGQgbm90IHNldCBYREdfUlVOVElNRV9ESVI6IHtlfSIpDQoNCiAgICAjIFNldCBESVNQTEFZIGlmIG5vdCBzZXQNCiAgICBpZiAnRElTUExBWScgbm90IGluIG9zLmVudmlyb246DQogICAgICAgIG9zLmVudmlyb25bJ0RJU1BMQVknXSA9ICc6MCcNCiAgICAgICAgcHJpbnQoIltJTkZPXSBESVNQTEFZIHNldCB0byA6MCIpDQoNCiAgICAjIFRyeSB0byBzdGFydCBhIHZpcnR1YWwgZGlzcGxheSBpZiBuZWVkZWQgKGJlc3QtZWZmb3J0KQ0KICAgIHRyeToNCiAgICAgICAgaWYgbm90IG9zLmVudmlyb24uZ2V0KCdESVNQTEFZJykgb3Igbm90IG9zLnBhdGguZXhpc3RzKCcvdG1wLy5YMTEtdW5peC9YMCcpOg0KICAgICAgICAgICAgcHJpbnQoIltJTkZPXSBTdGFydGluZyB2aXJ0dWFsIGRpc3BsYXkgKFh2ZmIpLi4uIikNCiAgICAgICAgICAgIHN1YnByb2Nlc3MuUG9wZW4oWydYdmZiJywgJzowJywgJy1zY3JlZW4nLCAnMCcsICcxMjgweDEwMjR4MjQnLCAnLWFjJ10sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpDQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpICAjIEdpdmUgWHZmYiB0aW1lIHRvIHN0YXJ0DQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIltXQVJOSU5HXSBDb3VsZCBub3Qgc3RhcnQgdmlydHVhbCBkaXNwbGF5OiB7ZX0iKQ0KDQojIE9wdGlvbmFsIEFJIGZlYXR1cmVzDQp0cnk6DQogICAgaW1wb3J0IGdvb2dsZS5nZW5lcmF0aXZlYWkgYXMgZ2VuYWkgICMgdHlwZTogaWdub3JlDQpleGNlcHQgRXhjZXB0aW9uOg0KICAgIGdlbmFpID0gTm9uZQ0KDQojIEF0dGVtcHQgdG8gaW1wb3J0IFB5UXQ1IGZvciBHVUkuIElmIG5vdCBhdmFpbGFibGUsIHdlJ2xsIG9mZmVyIGEgQ0xJIGZhbGxiYWNrLg0KVVNFX0dVSSA9IFRydWUNCnRyeToNCiAgICBmcm9tIFB5UXQ1LlF0V2lkZ2V0cyBpbXBvcnQgKFFBcHBsaWNhdGlvbiwgUU1haW5XaW5kb3csIFFXaWRnZXQsIFFWQm94TGF5b3V0LCBRSEJveExheW91dCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFHcm91cEJveCwgUUZvcm1MYXlvdXQsIFFMYWJlbCwgUUxpbmVFZGl0LCBRUHVzaEJ1dHRvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFUZXh0RWRpdCwgUVRhYldpZGdldCwgUVRhYmxlV2lkZ2V0LCBRVGFibGVXaWRnZXRJdGVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUUNoZWNrQm94LCBRU3BpbkJveCwgUUZpbGVEaWFsb2csIFFNZXNzYWdlQm94LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUVByb2dyZXNzQmFyLCBRU2Nyb2xsQXJlYSwgUVNwbGl0dGVyLCBRVG9vbFRpcCwgUUZyYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUVNpemVQb2xpY3ksIFFIZWFkZXJWaWV3LCBRQWJzdHJhY3RJdGVtVmlldywgUVN0YXR1c0JhciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFUb29sQnV0dG9uLCBRU3R5bGUsIFFNZW51LCBRQWN0aW9uLCBRR3JhcGhpY3NEcm9wU2hhZG93RWZmZWN0KQ0KICAgIGZyb20gUHlRdDUuUXRDb3JlIGltcG9ydCAoUU9iamVjdCwgcHlxdFNpZ25hbCwgUVRocmVhZCwgUUV2ZW50TG9vcCwgUVRpbWVyLCBRdCkNCiAgICBmcm9tIFB5UXQ1LlF0R3VpIGltcG9ydCAoUUZvbnQsIFFQYWxldHRlLCBRQ29sb3IsIFFCcnVzaCwgUUxpbmVhckdyYWRpZW50LCBRSWNvbiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUUN1cnNvciwgUUludFZhbGlkYXRvciwgUURvdWJsZVZhbGlkYXRvciwgUUZvbnRNZXRyaWNzLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBRS2V5U2VxdWVuY2UsIFFDbGlwYm9hcmQsIFFUZXh0Q3Vyc29yLCBRUGl4bWFwKQ0KZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICBVU0VfR1VJID0gRmFsc2UNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gVXRpbGl0aWVzICYgRW5oYW5jZW1lbnRzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpjbGFzcyBSYXRlTGltaXRlcjoNCiAgICAiIiJBc3luYyByYXRlIGxpbWl0ZXIgdXNpbmcgYSBkZXF1ZSBhbmQgYXN5bmNpby5Mb2NrIHRvIGF2b2lkIGJsb2NraW5nIHRoZSBldmVudCBsb29wLiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCByZXF1ZXN0c19wZXJfcGVyaW9kOiBpbnQsIHBlcmlvZF9zZWNvbmRzOiBmbG9hdCk6DQogICAgICAgIHNlbGYucmVxdWVzdHNfcGVyX3BlcmlvZCA9IG1heCgxLCBpbnQocmVxdWVzdHNfcGVyX3BlcmlvZCkpDQogICAgICAgIHNlbGYucGVyaW9kX3NlY29uZHMgPSBmbG9hdChwZXJpb2Rfc2Vjb25kcykNCiAgICAgICAgc2VsZi5yZXF1ZXN0X3RpbWVzdGFtcHMgPSBkZXF1ZSgpDQogICAgICAgIHNlbGYuX2xvY2sgPSBhc3luY2lvLkxvY2soKQ0KDQogICAgYXN5bmMgZGVmIHdhaXQoc2VsZikgLT4gTm9uZToNCiAgICAgICAgIiIiQXdhaXQgdW50aWwgYWxsb3dlZCB0byBwcm9jZWVkIHVuZGVyIHRoZSBjb25maWd1cmVkIHJhdGUuIiIiDQogICAgICAgIGFzeW5jIHdpdGggc2VsZi5fbG9jazoNCiAgICAgICAgICAgIG5vdyA9IHRpbWUubW9ub3RvbmljKCkNCiAgICAgICAgICAgICMgUmVtb3ZlIHN0YWxlIHRpbWVzdGFtcHMNCiAgICAgICAgICAgIHdoaWxlIHNlbGYucmVxdWVzdF90aW1lc3RhbXBzIGFuZCAobm93IC0gc2VsZi5yZXF1ZXN0X3RpbWVzdGFtcHNbMF0pID49IHNlbGYucGVyaW9kX3NlY29uZHM6DQogICAgICAgICAgICAgICAgc2VsZi5yZXF1ZXN0X3RpbWVzdGFtcHMucG9wbGVmdCgpDQoNCiAgICAgICAgICAgIGlmIGxlbihzZWxmLnJlcXVlc3RfdGltZXN0YW1wcykgPj0gc2VsZi5yZXF1ZXN0c19wZXJfcGVyaW9kOg0KICAgICAgICAgICAgICAgICMgY29tcHV0ZSB3YWl0IHRpbWUgdW50aWwgZmlyc3QgdGltZXN0YW1wIGV4cGlyZXMNCiAgICAgICAgICAgICAgICB3YWl0X3RpbWUgPSBzZWxmLnBlcmlvZF9zZWNvbmRzIC0gKG5vdyAtIHNlbGYucmVxdWVzdF90aW1lc3RhbXBzWzBdKQ0KICAgICAgICAgICAgICAgIGlmIHdhaXRfdGltZSA+IDA6DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAod2FpdF90aW1lKQ0KDQogICAgICAgICAgICBzZWxmLnJlcXVlc3RfdGltZXN0YW1wcy5hcHBlbmQodGltZS5tb25vdG9uaWMoKSkNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gU3ViZG9tYWluIC8gSFRUUCBIZWxwZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpjbGFzcyBEbnNDbGllbnQ6DQogICAgIiIiQXN5bmMgRE5TIGNsaWVudCB3aXRoIGNhY2hpbmcgdXNpbmcgYWlvZG5zLiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0aW1lb3V0OiBmbG9hdCA9IDIuMCwgbWF4X2NvbmN1cnJlbmN5OiBpbnQgPSA1MDApOg0KICAgICAgICBzZWxmLnJlc29sdmVyID0gYWlvZG5zLkROU1Jlc29sdmVyKHRpbWVvdXQ9dGltZW91dCwgdHJpZXM9MikNCiAgICAgICAgc2VsZi5jYWNoZTogRGljdFtzdHIsIERpY3Rbc3RyLCBBbnldXSA9IHt9DQogICAgICAgIHNlbGYuc2VtID0gYXN5bmNpby5TZW1hcGhvcmUobWF4X2NvbmN1cnJlbmN5KQ0KDQogICAgYXN5bmMgZGVmIHJlc29sdmVfYWxsKHNlbGYsIGZxZG46IHN0cikgLT4gRGljdFtzdHIsIEFueV06DQogICAgICAgICIiIlJlc29sdmUgQSBhbmQgQ05BTUUgcmVjb3JkcyBmb3IgYW4gZnFkbiwgd2l0aCBjYWNoaW5nLiIiIg0KICAgICAgICBmcWRuID0gZnFkbi5zdHJpcCgpLmxvd2VyKCkNCiAgICAgICAgaWYgbm90IGZxZG46DQogICAgICAgICAgICByZXR1cm4geyJBIjogW10sICJDTkFNRSI6IE5vbmV9DQoNCiAgICAgICAgaWYgZnFkbiBpbiBzZWxmLmNhY2hlOg0KICAgICAgICAgICAgcmV0dXJuIHNlbGYuY2FjaGVbZnFkbl0NCg0KICAgICAgICBhc3luYyB3aXRoIHNlbGYuc2VtOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFfcmVjb3JkcyA9IGF3YWl0IHNlbGYucmVzb2x2ZXIucXVlcnkoZnFkbiwgIkEiKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICBhX3JlY29yZHMgPSBbXQ0KDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgY25hbWVfcmVjb3JkID0gYXdhaXQgc2VsZi5yZXNvbHZlci5xdWVyeShmcWRuLCAiQ05BTUUiKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICBjbmFtZV9yZWNvcmQgPSBOb25lDQoNCiAgICAgICAgICAgIHJlcyA9IHsNCiAgICAgICAgICAgICAgICAiQSI6IFtnZXRhdHRyKHIsICdob3N0Jywgc3RyKHIpKSBmb3IgciBpbiBhX3JlY29yZHNdIGlmIGFfcmVjb3JkcyBlbHNlIFtdLA0KICAgICAgICAgICAgICAgICJDTkFNRSI6IGdldGF0dHIoY25hbWVfcmVjb3JkLCAnY25hbWUnLCBOb25lKSBpZiBjbmFtZV9yZWNvcmQgZWxzZSBOb25lDQogICAgICAgICAgICB9DQogICAgICAgICAgICBzZWxmLmNhY2hlW2ZxZG5dID0gcmVzDQogICAgICAgICAgICByZXR1cm4gcmVzDQoNCmNsYXNzIEh0dHBDbGllbnQ6DQogICAgIiIiQXN5bmMgSFRUUCBjbGllbnQgZm9yIHByb2JpbmcgV29yZFByZXNzIHNpdGVzLiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCB2ZXJpZnlfdGxzOiBib29sLCBtYXhfY29uYzogaW50ID0gMTUwLCB0aW1lb3V0X3NlY29uZHM6IGZsb2F0ID0gMTAuMCk6DQogICAgICAgIHNlbGYuc2VtID0gYXN5bmNpby5TZW1hcGhvcmUobWF4X2NvbmMpDQogICAgICAgIHNlbGYudGltZW91dCA9IGFpb2h0dHAuQ2xpZW50VGltZW91dCh0b3RhbD10aW1lb3V0X3NlY29uZHMpDQogICAgICAgIHNzbF9wYXJhbSA9IFRydWUgaWYgdmVyaWZ5X3RscyBlbHNlIEZhbHNlDQogICAgICAgIHNlbGYuY29ubmVjdG9yID0gYWlvaHR0cC5UQ1BDb25uZWN0b3Ioc3NsPXNzbF9wYXJhbSwgbGltaXRfcGVyX2hvc3Q9MjApDQogICAgICAgIHNlbGYuc2Vzc2lvbiA9IGFpb2h0dHAuQ2xpZW50U2Vzc2lvbih0aW1lb3V0PXNlbGYudGltZW91dCwgdHJ1c3RfZW52PVRydWUsIGNvbm5lY3Rvcj1zZWxmLmNvbm5lY3RvcikNCg0KICAgIGFzeW5jIGRlZiBjbG9zZShzZWxmKToNCiAgICAgICAgIiIiQ2xvc2VzIHRoZSB1bmRlcmx5aW5nIGFpb2h0dHAgc2Vzc2lvbi4iIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgc2VsZi5zZXNzaW9uIGFuZCBub3Qgc2VsZi5zZXNzaW9uLmNsb3NlZDoNCiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNlc3Npb24uY2xvc2UoKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgcGFzcw0KDQogICAgYXN5bmMgZGVmIHByb2JlX2hvc3Qoc2VsZiwgaG9zdDogc3RyKSAtPiBPcHRpb25hbFtEaWN0W3N0ciwgQW55XV06DQogICAgICAgICIiIg0KICAgICAgICBQcm9iZSBhIGhvc3QgdXNpbmcgYm90aCBodHRwcyBhbmQgaHR0cCBhbmQgZGV0ZXJtaW5lIGlmIGl0J3MgYSBXb3JkUHJlc3Mgc2l0ZS4NCiAgICAgICAgIiIiDQogICAgICAgIGlmIG5vdCBob3N0Og0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICBob3N0ID0gaG9zdC5zdHJpcCgpDQogICAgICAgIGZvciBzY2hlbWUgaW4gKCJodHRwcyIsICJodHRwIik6DQogICAgICAgICAgICB1cmwgPSBmIntzY2hlbWV9Oi8ve2hvc3R9Ig0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5zZW06DQogICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5zZXNzaW9uLmdldCh1cmwsIGFsbG93X3JlZGlyZWN0cz1UcnVlKSBhcyByOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgMjAwIDw9IHIuc3RhdHVzIDwgNDAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkgPSBhd2FpdCByLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsX3VybCA9IHN0cihyLnVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX3dvcmRwcmVzc19zaXRlKGJvZHksIGZpbmFsX3VybCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7InVybCI6IGZpbmFsX3VybCwgInRpdGxlIjogc2VsZi5leHRyYWN0X3RpdGxlKGJvZHkpfQ0KICAgICAgICAgICAgZXhjZXB0IChhaW9odHRwLkNsaWVudEVycm9yLCBhc3luY2lvLlRpbWVvdXRFcnJvcik6DQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIEBzdGF0aWNtZXRob2QNCiAgICBkZWYgaXNfd29yZHByZXNzX3NpdGUoYm9keTogYnl0ZXMsIHVybDogc3RyKSAtPiBib29sOg0KICAgICAgICAiIiJIZXVyaXN0aWMgY2hlY2tzIGZvciBXb3JkUHJlc3MgaW5kaWNhdG9ycy4iIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaW5kaWNhdG9ycyA9IFtiJ3dwLWNvbnRlbnQnLCBiJ3dwLWluY2x1ZGVzJywgYidXb3JkUHJlc3MnLCBiJ3dwLWpzb24nXQ0KICAgICAgICAgICAgZm9yIGluZGljYXRvciBpbiBpbmRpY2F0b3JzOg0KICAgICAgICAgICAgICAgIGlmIGluZGljYXRvciBpbiBib2R5Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZm9yIHBhdGggaW4gWycvd3AtYWRtaW4nLCAnL3dwLWxvZ2luLnBocCcsICcveG1scnBjLnBocCddOg0KICAgICAgICAgICAgICAgIGlmIHBhdGggaW4gdXJsOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIEBzdGF0aWNtZXRob2QNCiAgICBkZWYgZXh0cmFjdF90aXRsZShib2R5OiBieXRlcykgLT4gc3RyOg0KICAgICAgICAiIiJFeHRyYWN0IEhUTUwgdGl0bGUgZnJvbSBieXRlcyBjb250ZW50LiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyYic8dGl0bGU+KC4qPyk8L3RpdGxlPicsIGJvZHksIHJlLkkgfCByZS5TKQ0KICAgICAgICAgICAgaWYgbWF0Y2g6DQogICAgICAgICAgICAgICAgcmV0dXJuIGh0bWwudW5lc2NhcGUobWF0Y2guZ3JvdXAoMSkuZGVjb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkuc3RyaXAoKQ0KICAgICAgICAgICAgcmV0dXJuICJObyBUaXRsZSINCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIHJldHVybiAiTm8gVGl0bGUiDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFNpdGUgU2NyYXBlcjogQWRkaXRpb25hbCBTY3JhcGluZyBNZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpjbGFzcyBTaXRlU2NyYXBlcjoNCiAgICAiIiINCiAgICBBZGRpdGlvbmFsIFdvcmRQcmVzcyBzY3JhcGluZyBtZXRob2RzIHRoYXQgcHJvYmUgY29tbW9uIFdQIGVuZHBvaW50cy4NCiAgICAiIiINCiAgICBDT01NT05fUExVR0lOUyA9IFsiYWtpc21ldCIsICJ3b29jb21tZXJjZSIsICJ5b2FzdCIsICJqZXRwYWNrIiwgImVsZW1lbnRvciIsICJjb250YWN0LWZvcm0tNyJdDQogICAgQ09NTU9OX1RIRU1FUyA9IFsidHdlbnR5dHdlbnR5b25lIiwgInR3ZW50eW5pbmV0ZWVuIiwgInR3ZW50eXNldmVudGVlbiIsICJ0d2VudHlzaXh0ZWVuIl0NCiAgICBDT01NT05fQkFDS1VQUyA9IFsiYmFja3VwLnppcCIsICJzaXRlLnppcCIsICJkYi5zcWwiLCAid3AtY29uZmlnLnBocC5iYWsiLCAid3AtY29uZmlnLmJhayJdDQoNCiAgICBkZWYgX19pbml0X18oc2VsZiwgc2Vzc2lvbjogYWlvaHR0cC5DbGllbnRTZXNzaW9uLCBzZW1hcGhvcmU6IGFzeW5jaW8uU2VtYXBob3JlLCBiYXNlX3VybDogc3RyLCB0aW1lb3V0OiBpbnQgPSAxMCk6DQogICAgICAgIHNlbGYuc2Vzc2lvbiA9IHNlc3Npb24NCiAgICAgICAgc2VsZi5zZW0gPSBzZW1hcGhvcmUNCiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2VfdXJsLnJzdHJpcCgnLycpDQogICAgICAgIHNlbGYudGltZW91dCA9IHRpbWVvdXQNCg0KICAgIGFzeW5jIGRlZiBfZmV0Y2goc2VsZiwgcGF0aDogc3RyLCBtZXRob2Q6IHN0ciA9ICJHRVQiLCBhbGxvd19yZWRpcmVjdHM6IGJvb2wgPSBUcnVlKSAtPiBUdXBsZVtpbnQsIGJ5dGVzLCBzdHJdOg0KICAgICAgICB1cmwgPSB1cmxqb2luKHNlbGYuYmFzZV91cmwgKyAnLycsIHBhdGgubHN0cmlwKCcvJykpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGFzeW5jIHdpdGggc2VsZi5zZW06DQogICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBzZWxmLnNlc3Npb24ucmVxdWVzdChtZXRob2QsIHVybCwgYWxsb3dfcmVkaXJlY3RzPWFsbG93X3JlZGlyZWN0cywgdGltZW91dD1zZWxmLnRpbWVvdXQpIGFzIHI6DQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBhd2FpdCByLnJlYWQoKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5zdGF0dXMsIGRhdGEsIHN0cihyLnVybCkNCiAgICAgICAgZXhjZXB0IChhc3luY2lvLlRpbWVvdXRFcnJvciwgYWlvaHR0cC5DbGllbnRFcnJvcik6DQogICAgICAgICAgICByZXR1cm4gMCwgYicnLCB1cmwNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgIHJldHVybiAwLCBiJycsIHVybA0KDQogICAgYXN5bmMgZGVmIHNjYW4oc2VsZikgLT4gRGljdFtzdHIsIEFueV06DQogICAgICAgIHJlc3VsdDogRGljdFtzdHIsIEFueV0gPSB7DQogICAgICAgICAgICAid3BfdmVyc2lvbiI6IE5vbmUsICJlbmRwb2ludHMiOiB7fSwgImV4cG9zZWRfZmlsZXMiOiBbXSwNCiAgICAgICAgICAgICJhdXRob3JzIjogW10sICJwbHVnaW5zIjogW10sICJ0aGVtZXMiOiBbXQ0KICAgICAgICB9DQogICAgICAgIHN0YXR1cywgYm9keSwgZmluYWwgPSBhd2FpdCBzZWxmLl9mZXRjaCgiLyIpDQogICAgICAgIGlmIHN0YXR1cyBhbmQgYm9keToNCiAgICAgICAgICAgIHZlciA9IGF3YWl0IHNlbGYuZGV0ZWN0X3dwX3ZlcnNpb24oYm9keSkNCiAgICAgICAgICAgIGlmIHZlcjoNCiAgICAgICAgICAgICAgICByZXN1bHRbIndwX3ZlcnNpb24iXSA9IHZlcg0KDQogICAgICAgIHRhc2tzID0gew0KICAgICAgICAgICAgIndwX2pzb24iOiBzZWxmLmNoZWNrX3dwX2pzb24oKSwNCiAgICAgICAgICAgICJyZWFkbWVfbGljZW5zZSI6IHNlbGYuY2hlY2tfcmVhZG1lX2FuZF9saWNlbnNlKCksDQogICAgICAgICAgICAieG1scnBjIjogc2VsZi5jaGVja194bWxycGMoKSwNCiAgICAgICAgICAgICJyb2JvdHNfc2l0ZW1hcCI6IHNlbGYuY2hlY2tfcm9ib3RzX3NpdGVtYXAoKSwNCiAgICAgICAgICAgICJhdXRob3JzIjogc2VsZi5lbnVtZXJhdGVfYXV0aG9ycygpLA0KICAgICAgICAgICAgInBsdWdpbnNfdGhlbWVzIjogc2VsZi5jaGVja19wbHVnaW5zX3RoZW1lcygpLA0KICAgICAgICAgICAgImJhY2t1cHMiOiBzZWxmLmNoZWNrX2JhY2t1cF9maWxlcygpLA0KICAgICAgICB9DQogICAgICAgIHJlc3VsdHMgPSBhd2FpdCBhc3luY2lvLmdhdGhlcigqdGFza3MudmFsdWVzKCksIHJldHVybl9leGNlcHRpb25zPVRydWUpDQogICAgICAgIHJlc19tYXAgPSBkaWN0KHppcCh0YXNrcy5rZXlzKCksIHJlc3VsdHMpKQ0KDQogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzX21hcFsid3BfanNvbiJdLCBkaWN0KTogcmVzdWx0WyJlbmRwb2ludHMiXVsid3AtanNvbiJdID0gcmVzX21hcFsid3BfanNvbiJdDQogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzX21hcFsicmVhZG1lX2xpY2Vuc2UiXSwgZGljdCk6DQogICAgICAgICAgICBybCA9IHJlc19tYXBbInJlYWRtZV9saWNlbnNlIl0NCiAgICAgICAgICAgIHJlc3VsdFsiZW5kcG9pbnRzIl1bInJlYWRtZSJdID0gcmwuZ2V0KCJyZWFkbWUiKQ0KICAgICAgICAgICAgcmVzdWx0WyJlbmRwb2ludHMiXVsibGljZW5zZSJdID0gcmwuZ2V0KCJsaWNlbnNlIikNCiAgICAgICAgICAgIGlmIHJsLmdldCgicmVhZG1lIikgYW5kIHJsLmdldCgicmVhZG1lIikgIT0gImZvdW5kIiBhbmQgbm90IHJlc3VsdFsid3BfdmVyc2lvbiJdOg0KICAgICAgICAgICAgICAgIHJlc3VsdFsid3BfdmVyc2lvbiJdID0gcmwuZ2V0KCJyZWFkbWUiKQ0KICAgICAgICBpZiBpc2luc3RhbmNlKHJlc19tYXBbInhtbHJwYyJdLCBib29sKTogcmVzdWx0WyJlbmRwb2ludHMiXVsieG1scnBjIl0gPSByZXNfbWFwWyJ4bWxycGMiXQ0KICAgICAgICBpZiBpc2luc3RhbmNlKHJlc19tYXBbInJvYm90c19zaXRlbWFwIl0sIGRpY3QpOg0KICAgICAgICAgICAgcnMgPSByZXNfbWFwWyJyb2JvdHNfc2l0ZW1hcCJdDQogICAgICAgICAgICByZXN1bHRbImVuZHBvaW50cyJdWyJyb2JvdHMiXSA9IHJzLmdldCgicm9ib3RzIikNCiAgICAgICAgICAgIGlmIHJzLmdldCgic2l0ZW1hcCIpOiByZXN1bHRbImVuZHBvaW50cyJdWyJzaXRlbWFwIl0gPSBycy5nZXQoInNpdGVtYXAiKQ0KICAgICAgICBpZiBpc2luc3RhbmNlKHJlc19tYXBbImF1dGhvcnMiXSwgbGlzdCk6IHJlc3VsdFsiYXV0aG9ycyJdID0gcmVzX21hcFsiYXV0aG9ycyJdDQogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzX21hcFsicGx1Z2luc190aGVtZXMiXSwgZGljdCk6DQogICAgICAgICAgICBwdCA9IHJlc19tYXBbInBsdWdpbnNfdGhlbWVzIl0NCiAgICAgICAgICAgIGlmIHB0LmdldCgicGx1Z2lucyIpOiByZXN1bHRbInBsdWdpbnMiXSA9IHB0WyJwbHVnaW5zIl0NCiAgICAgICAgICAgIGlmIHB0LmdldCgidGhlbWVzIik6IHJlc3VsdFsidGhlbWVzIl0gPSBwdFsidGhlbWVzIl0NCiAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNfbWFwWyJiYWNrdXBzIl0sIGxpc3QpOiByZXN1bHRbImV4cG9zZWRfZmlsZXMiXS5leHRlbmQocmVzX21hcFsiYmFja3VwcyJdKQ0KDQogICAgICAgIHJldHVybiByZXN1bHQNCg0KICAgIGFzeW5jIGRlZiBkZXRlY3Rfd3BfdmVyc2lvbihzZWxmLCBodG1sX2J5dGVzOiBieXRlcykgLT4gT3B0aW9uYWxbc3RyXToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgdHh0ID0gaHRtbF9ieXRlcy5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKQ0KICAgICAgICAgICAgbSA9IHJlLnNlYXJjaChyJzxtZXRhIG5hbWU9WyJcJ11nZW5lcmF0b3JbIlwnXSBjb250ZW50PVsiXCddV29yZFByZXNzXHMqKFswLTlcLl0rKScsIHR4dCwgcmUuSSkNCiAgICAgICAgICAgIHJldHVybiBtLmdyb3VwKDEpIGlmIG0gZWxzZSBOb25lDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgYXN5bmMgZGVmIGNoZWNrX3dwX2pzb24oc2VsZikgLT4gT3B0aW9uYWxbRGljdFtzdHIsIEFueV1dOg0KICAgICAgICBzdGF0dXMsIGJvZHksIGZpbmFsID0gYXdhaXQgc2VsZi5fZmV0Y2goIi93cC1qc29uLyIpDQogICAgICAgIGlmIHN0YXR1cyBhbmQgYm9keToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB0ZXh0ID0gYm9keS5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKQ0KICAgICAgICAgICAgICAgIGlmICJuYW1lc3BhY2VzIiBpbiB0ZXh0IG9yICcicm91dGVzIicgaW4gdGV4dDoNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IGpzb24gYXMgX2pzb24NCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBfanNvbi5sb2Fkcyh0ZXh0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsidXJsIjogZmluYWwsICJwYXJzZWQiOiBUcnVlLCAic3VtbWFyeSI6IHsibmFtZXNwYWNlcyI6IGxpc3QoZGF0YS5nZXQoIm5hbWVzcGFjZXMiLCBbXSkpWzo1XSBpZiBpc2luc3RhbmNlKGRhdGEsIGRpY3QpIGVsc2UgW119fQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsidXJsIjogZmluYWwsICJwYXJzZWQiOiBGYWxzZX0NCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgcmV0dXJuIHsidXJsIjogZmluYWwsICJwYXJzZWQiOiBGYWxzZX0NCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGFzeW5jIGRlZiBjaGVja19yZWFkbWVfYW5kX2xpY2Vuc2Uoc2VsZikgLT4gRGljdFtzdHIsIE9wdGlvbmFsW3N0cl1dOg0KICAgICAgICByZXN1bHQgPSB7InJlYWRtZSI6IE5vbmUsICJsaWNlbnNlIjogTm9uZX0NCiAgICAgICAgczEsIGIxLCB1MSA9IGF3YWl0IHNlbGYuX2ZldGNoKCIvcmVhZG1lLmh0bWwiKQ0KICAgICAgICBpZiBzMSBhbmQgYjE6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdHh0ID0gYjEuZGVjb2RlKCd1dGYtOCcsIGVycm9ycz0naWdub3JlJykNCiAgICAgICAgICAgICAgICBtID0gcmUuc2VhcmNoKHIiU3RhYmxlIHRhZzpccyooWzAtOV0rXC5bMC05XSsoPzpcLlswLTldKyk/KSIsIHR4dCwgcmUuSSkNCiAgICAgICAgICAgICAgICBpZiBub3QgbToNCiAgICAgICAgICAgICAgICAgICAgbSA9IHJlLnNlYXJjaChyIlZlcnNpb25ccyooWzAtOV0rXC5bMC05XSsoPzpcLlswLTldKyk/KSIsIHR4dCwgcmUuSSkNCiAgICAgICAgICAgICAgICByZXN1bHRbInJlYWRtZSJdID0gbS5ncm91cCgxKSBpZiBtIGVsc2UgImZvdW5kIg0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICByZXN1bHRbInJlYWRtZSJdID0gImZvdW5kIg0KICAgICAgICBzMiwgYjIsIHUyID0gYXdhaXQgc2VsZi5fZmV0Y2goIi9saWNlbnNlLnR4dCIpDQogICAgICAgIGlmIHMyIGFuZCBiMjoNCiAgICAgICAgICAgIHJlc3VsdFsibGljZW5zZSJdID0gImZvdW5kIg0KICAgICAgICByZXR1cm4gcmVzdWx0DQoNCiAgICBhc3luYyBkZWYgY2hlY2tfeG1scnBjKHNlbGYpIC0+IGJvb2w6DQogICAgICAgIHN0YXR1cywgXywgXyA9IGF3YWl0IHNlbGYuX2ZldGNoKCIveG1scnBjLnBocCIsIG1ldGhvZD0iUE9TVCIpDQogICAgICAgIHJldHVybiBib29sKHN0YXR1cykNCg0KICAgIGFzeW5jIGRlZiBjaGVja19yb2JvdHNfc2l0ZW1hcChzZWxmKSAtPiBEaWN0W3N0ciwgT3B0aW9uYWxbc3RyXV06DQogICAgICAgIGluZm8gPSB7InJvYm90cyI6IE5vbmUsICJzaXRlbWFwIjogTm9uZX0NCiAgICAgICAgcywgYiwgdSA9IGF3YWl0IHNlbGYuX2ZldGNoKCIvcm9ib3RzLnR4dCIpDQogICAgICAgIGlmIHMgYW5kIGI6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgdHh0ID0gYi5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKQ0KICAgICAgICAgICAgICAgIGlmICJTaXRlbWFwOiIgaW4gdHh0Og0KICAgICAgICAgICAgICAgICAgICBtID0gcmUuc2VhcmNoKHIiU2l0ZW1hcDpccyooXFMrKSIsIHR4dCwgcmUuSSkNCiAgICAgICAgICAgICAgICAgICAgaWYgbToNCiAgICAgICAgICAgICAgICAgICAgICAgIGluZm9bInNpdGVtYXAiXSA9IG0uZ3JvdXAoMSkNCiAgICAgICAgICAgICAgICBpbmZvWyJyb2JvdHMiXSA9ICJmb3VuZCINCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICAgICAgaW5mb1sicm9ib3RzIl0gPSAiZm91bmQiDQogICAgICAgIHMyLCBiMiwgdTIgPSBhd2FpdCBzZWxmLl9mZXRjaCgiL3NpdGVtYXAueG1sIikNCiAgICAgICAgaWYgczIgYW5kIGIyOg0KICAgICAgICAgICAgaW5mb1sic2l0ZW1hcCJdID0gdTINCiAgICAgICAgcmV0dXJuIGluZm8NCg0KICAgIGFzeW5jIGRlZiBlbnVtZXJhdGVfYXV0aG9ycyhzZWxmKSAtPiBMaXN0W3N0cl06DQogICAgICAgIGF1dGhvcnMgPSBbXQ0KICAgICAgICBzdGF0dXMsIGJvZHksIGZpbmFsID0gYXdhaXQgc2VsZi5fZmV0Y2goIi8/YXV0aG9yPTEiLCBhbGxvd19yZWRpcmVjdHM9VHJ1ZSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgbSA9IHJlLnNlYXJjaChyJy9hdXRob3IvKFteL10rKS8nLCBmaW5hbCkNCiAgICAgICAgICAgIGlmIG06DQogICAgICAgICAgICAgICAgYXV0aG9ycy5hcHBlbmQobS5ncm91cCgxKSkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdHh0ID0gYm9keS5kZWNvZGUoJ3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKQ0KICAgICAgICAgICAgICAgIG0yID0gcmUuc2VhcmNoKHInL2F1dGhvci8oW14vXSspLycsIHR4dCkNCiAgICAgICAgICAgICAgICBpZiBtMjoNCiAgICAgICAgICAgICAgICAgICAgYXV0aG9ycy5hcHBlbmQobTIuZ3JvdXAoMSkpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBwYXNzDQogICAgICAgIHJldHVybiBhdXRob3JzDQoNCiAgICBhc3luYyBkZWYgY2hlY2tfcGx1Z2luc190aGVtZXMoc2VsZikgLT4gRGljdFtzdHIsIExpc3Rbc3RyXV06DQogICAgICAgIGRpc2NvdmVyZWRfcGx1Z2luczogTGlzdFtzdHJdID0gW10NCiAgICAgICAgZGlzY292ZXJlZF90aGVtZXM6IExpc3Rbc3RyXSA9IFtdDQoNCiAgICAgICAgYXN5bmMgZGVmIGNoZWNrX3BhdGgocGF0aCwgaXRlbV9saXN0LCBpdGVtX25hbWUpOg0KICAgICAgICAgICAgc3RhdHVzLCBfLCBfID0gYXdhaXQgc2VsZi5fZmV0Y2gocGF0aCwgbWV0aG9kPSJIRUFEIikNCiAgICAgICAgICAgIGlmIHN0YXR1cyBhbmQgc3RhdHVzIDwgNDAwOg0KICAgICAgICAgICAgICAgIGl0ZW1fbGlzdC5hcHBlbmQoaXRlbV9uYW1lKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBzdGF0dXMyLCBfLCBfID0gYXdhaXQgc2VsZi5fZmV0Y2goZiJ7cGF0aH1yZWFkbWUudHh0IiwgbWV0aG9kPSJHRVQiKQ0KICAgICAgICAgICAgICAgIGlmIHN0YXR1czIgYW5kIHN0YXR1czIgPCA0MDA6DQogICAgICAgICAgICAgICAgICAgIGl0ZW1fbGlzdC5hcHBlbmQoaXRlbV9uYW1lKQ0KDQogICAgICAgIHRhc2tzID0gW10NCiAgICAgICAgZm9yIHAgaW4gc2VsZi5DT01NT05fUExVR0lOUzoNCiAgICAgICAgICAgIHRhc2tzLmFwcGVuZChjaGVja19wYXRoKGYiL3dwLWNvbnRlbnQvcGx1Z2lucy97cH0vIiwgZGlzY292ZXJlZF9wbHVnaW5zLCBwKSkNCiAgICAgICAgZm9yIHQgaW4gc2VsZi5DT01NT05fVEhFTUVTOg0KICAgICAgICAgICAgdGFza3MuYXBwZW5kKGNoZWNrX3BhdGgoZiIvd3AtY29udGVudC90aGVtZXMve3R9LyIsIGRpc2NvdmVyZWRfdGhlbWVzLCB0KSkNCg0KICAgICAgICBhd2FpdCBhc3luY2lvLmdhdGhlcigqdGFza3MpDQogICAgICAgIHJldHVybiB7InBsdWdpbnMiOiBkaXNjb3ZlcmVkX3BsdWdpbnMsICJ0aGVtZXMiOiBkaXNjb3ZlcmVkX3RoZW1lc30NCg0KICAgIGFzeW5jIGRlZiBjaGVja19iYWNrdXBfZmlsZXMoc2VsZikgLT4gTGlzdFtzdHJdOg0KICAgICAgICBmb3VuZCA9IFtdDQogICAgICAgIHRhc2tzID0gW10NCiAgICAgICAgZm9yIGZuYW1lIGluIHNlbGYuQ09NTU9OX0JBQ0tVUFM6DQogICAgICAgICAgICBhc3luYyBkZWYgY2hlY2tfZmlsZShmaWxlbmFtZSk6DQogICAgICAgICAgICAgICAgc3RhdHVzLCBfLCB1ID0gYXdhaXQgc2VsZi5fZmV0Y2goZiIve2ZpbGVuYW1lfSIsIG1ldGhvZD0iSEVBRCIpDQogICAgICAgICAgICAgICAgaWYgc3RhdHVzIGFuZCBzdGF0dXMgPCA0MDA6DQogICAgICAgICAgICAgICAgICAgIGZvdW5kLmFwcGVuZCh1KQ0KICAgICAgICAgICAgdGFza3MuYXBwZW5kKGNoZWNrX2ZpbGUoZm5hbWUpKQ0KICAgICAgICBhd2FpdCBhc3luY2lvLmdhdGhlcigqdGFza3MpDQogICAgICAgIHJldHVybiBmb3VuZA0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBTdWJkb21haW4gU2Nhbm5lciAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KY2xhc3MgU3ViZG9tYWluU2Nhbm5lcjoNCiAgICAiIiJTY2FubmVyIGZvciBkaXNjb3ZlcmluZyBXb3JkUHJlc3Mgc2l0ZXMgYWNyb3NzIHN1YmRvbWFpbnMgdXNpbmcgbXVsdGlwbGUgbWV0aG9kcy4iIiINCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZmlnOiBEaWN0W3N0ciwgQW55XSk6DQogICAgICAgIHNlbGYuY29uZmlnID0gY29uZmlnIG9yIHt9DQoNCiAgICBhc3luYyBkZWYgZGlzY292ZXJfd29yZHByZXNzX3N1YmRvbWFpbnMoc2VsZiwgZG9tYWluOiBzdHIsIGh0dHBfY2xpZW50OiBIdHRwQ2xpZW50LCBsb2dfYmF0Y2g6IGxpc3QsIGxvY2s6IGFzeW5jaW8uTG9jaykgLT4gRGljdFtzdHIsIEFueV06DQogICAgICAgICIiIkZpbmRzIHN1YmRvbWFpbnMgdXNpbmcgbXVsdGlwbGUgbWV0aG9kcyBhbmQgcHJvYmVzIHRoZW0gZm9yIFdvcmRQcmVzcy4iIiINCiAgICAgICAgZG9tYWluID0gZG9tYWluLnN0cmlwKCkubG93ZXIoKQ0KICAgICAgICBmb3VuZF9zdWJkb21haW5zOiBTZXRbc3RyXSA9IHNldCgpDQoNCiAgICAgICAgIyBNZXRob2QgMTogY3J0LnNoDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNydF91cmwgPSBmImh0dHBzOi8vY3J0LnNoLz9xPSUue2RvbWFpbn0mb3V0cHV0PWpzb24iDQogICAgICAgICAgICBhc3luYyB3aXRoIGh0dHBfY2xpZW50LnNlc3Npb24uZ2V0KGNydF91cmwsIHRpbWVvdXQ9MjApIGFzIHJlc3BvbnNlOg0KICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1cyA9PSAyMDA6DQogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKGNvbnRlbnRfdHlwZT1Ob25lKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgZW50cnkgaW4gZGF0YToNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVfdmFsdWUgPSBlbnRyeS5nZXQoJ25hbWVfdmFsdWUnLCAnJykNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmRvbWFpbnMgPSBuYW1lX3ZhbHVlLnNwbGl0KCdcbicpDQogICAgICAgICAgICAgICAgICAgICAgICBmb3Igc3ViIGluIHN1YmRvbWFpbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYW5fc3ViID0gc3ViLnN0cmlwKCkubG93ZXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNsZWFuX3N1Yi5lbmRzd2l0aChmJy57ZG9tYWlufScpIGFuZCAnKicgbm90IGluIGNsZWFuX3N1YjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfc3ViZG9tYWlucy5hZGQoY2xlYW5fc3ViKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBhc3luYyB3aXRoIGxvY2s6DQogICAgICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltTdWJkb21haW4gU2Nhbl0gY3J0LnNoIHF1ZXJ5IGZvciB7ZG9tYWlufSBmYWlsZWQ6IHtyZXByKGUpfS4gVXNpbmcgZmFsbGJhY2sgc2VlZHMuIikNCg0KICAgICAgICAjIE1ldGhvZCAyOiBFbmhhbmNlZCBJbnRlcm5hbCB3b3JkbGlzdA0KICAgICAgICBDT01NT05fU1VCRE9NQUlOUyA9IHsNCiAgICAgICAgICAgICJ3d3ciLCAiYmxvZyIsICJzaG9wIiwgIm5ld3MiLCAic3RvcmUiLCAicG9ydGFsIiwgImRldiIsICJzdGFnaW5nIiwgIndwIiwgIndvcmRwcmVzcyIsDQogICAgICAgICAgICAibSIsICJtYWlsIiwgIndlYm1haWwiLCAiZnRwIiwgImNwYW5lbCIsICJ3ZWJkaXNrIiwgImF1dG9kaXNjb3ZlciIsICJhZG1pbiIsICJ0ZXN0IiwNCiAgICAgICAgICAgICJkZW1vIiwgInNlY3VyZSIsICJzdXBwb3J0IiwgImhlbHAiLCAibXkiLCAiYWNjb3VudCIsICJsb2dpbiIsICJhcHAiLCAiYXBpIiwgImRhc2hib2FyZCIsDQogICAgICAgICAgICAiZm9ydW0iLCAiY29tbXVuaXR5IiwgImV2ZW50cyIsICJqb2JzIiwgImNhcmVlcnMiLCAicHJlc3MiLCAibWVkaWEiLCAiZ2FsbGVyeSIsDQogICAgICAgICAgICAidmlkZW8iLCAiZG9jcyIsICJkZXZlbG9wZXIiLCAic3RhdHVzIiwgImluZm8iLCAiY2RuIiwgImFzc2V0cyIsICJzdGF0aWMiLCAiaW1nIiwNCiAgICAgICAgICAgICJpbWFnZXMiLCAiZG93bmxvYWQiLCAiZmlsZXMiLCAiYmV0YSIsICJhbHBoYSIsICJvbGQiLCAibmV3IiwgInNlYXJjaCIsICJzdGF0cyIsDQogICAgICAgICAgICAiYW5hbHl0aWNzIiwgInBpd2lrIiwgIm1hdG9tbyIsICJ2cG4iLCAicmVtb3RlIiwgImdpdCIsICJzdm4iLCAiZmlsZXNlcnZlciIsDQogICAgICAgICAgICAiYmFja3VwIiwgImRiIiwgIm15c3FsIiwgInBocG15YWRtaW4iLCAic3FsIiwgIm5zMSIsICJuczIiLCAibnMzIiwgIm5zNCIsICJkbnMiLA0KICAgICAgICAgICAgInd3dzIiLCAibGVnYWN5IiwgImludHJhbmV0IiwgIndpa2kiLCAic3NvIiwgImF1dGgiLCAidWF0IiwgInByb2QiLCAicHJvZHVjdGlvbiIsDQogICAgICAgICAgICAiY2xpZW50IiwgImN1c3RvbWVyIiwgInBhcnRuZXIiLCAiaW52ZXN0b3JzIiwgImlyIiwgInNob3AtZGV2IiwgInN0YWdpbmctYmxvZyIsDQogICAgICAgICAgICAiZGV2LWFwaSIsICJhd3MiLCAiczMiLCAiY2xvdWQiLCAibWFpbDIiLCAib3dhIiwgImV4Y2hhbmdlIg0KICAgICAgICB9DQogICAgICAgIGZvciBzZWVkIGluIENPTU1PTl9TVUJET01BSU5TOg0KICAgICAgICAgICAgZm91bmRfc3ViZG9tYWlucy5hZGQoZiJ7c2VlZH0ue2RvbWFpbn0iKQ0KDQogICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgIGxvZ19iYXRjaC5hcHBlbmQoZiJbU3ViZG9tYWluIFNjYW5dIEZvdW5kIHtsZW4oZm91bmRfc3ViZG9tYWlucyl9IHBvdGVudGlhbCBjYW5kaWRhdGVzIGZvciB7ZG9tYWlufS4iKQ0KDQogICAgICAgIGlmIG5vdCBmb3VuZF9zdWJkb21haW5zOg0KICAgICAgICAgICAgcmV0dXJuIHt9DQoNCiAgICAgICAgZG5zX2NsaWVudCA9IERuc0NsaWVudCgpDQogICAgICAgIHRhc2tzID0gW3NlbGYucHJvYmVfZnFkbihmcWRuLCBkbnNfY2xpZW50LCBodHRwX2NsaWVudCkgZm9yIGZxZG4gaW4gZm91bmRfc3ViZG9tYWluc10NCiAgICAgICAgcmVzdWx0cyA9IGF3YWl0IGFzeW5jaW8uZ2F0aGVyKCp0YXNrcywgcmV0dXJuX2V4Y2VwdGlvbnM9VHJ1ZSkNCg0KICAgICAgICBkaXNjb3ZlcmVkID0ge30NCiAgICAgICAgZm9yIGVudHJ5IGluIHJlc3VsdHM6DQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGVudHJ5LCB0dXBsZSkgYW5kIGVudHJ5WzBdOg0KICAgICAgICAgICAgICAgIGZxZG4sIGluZm8gPSBlbnRyeQ0KICAgICAgICAgICAgICAgIGRpc2NvdmVyZWRbZnFkbl0gPSBpbmZvDQoNCiAgICAgICAgYXN5bmMgd2l0aCBsb2NrOg0KICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltTdWJkb21haW4gU2Nhbl0gRmluaXNoZWQgcHJvYmUgZm9yICd7ZG9tYWlufScuIElkZW50aWZpZWQge2xlbihkaXNjb3ZlcmVkKX0gV29yZFByZXNzIHNpdGVzLiIpDQoNCiAgICAgICAgcmV0dXJuIGRpc2NvdmVyZWQNCg0KICAgIGFzeW5jIGRlZiBwcm9iZV9mcWRuKHNlbGYsIGZxZG46IHN0ciwgZG5zX2NsaWVudDogRG5zQ2xpZW50LCBodHRwX2NsaWVudDogSHR0cENsaWVudCkgLT4gVHVwbGVbT3B0aW9uYWxbc3RyXSwgT3B0aW9uYWxbRGljdF1dOg0KICAgICAgICBkbnNfaW5mbyA9IGF3YWl0IGRuc19jbGllbnQucmVzb2x2ZV9hbGwoZnFkbikNCiAgICAgICAgaWYgZG5zX2luZm8gYW5kIGRuc19pbmZvLmdldCgiQSIpOg0KICAgICAgICAgICAgaHR0cF9pbmZvID0gYXdhaXQgaHR0cF9jbGllbnQucHJvYmVfaG9zdChmcWRuKQ0KICAgICAgICAgICAgaWYgaHR0cF9pbmZvOg0KICAgICAgICAgICAgICAgIG1lcmdlZCA9IGRpY3QoZG5zX2luZm8pDQogICAgICAgICAgICAgICAgbWVyZ2VkLnVwZGF0ZShodHRwX2luZm8pDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBzY3JhcGVyID0gU2l0ZVNjcmFwZXIoaHR0cF9jbGllbnQuc2Vzc2lvbiwgaHR0cF9jbGllbnQuc2VtLCBtZXJnZWQuZ2V0KCJ1cmwiLCBmImh0dHBzOi8ve2ZxZG59IikpDQogICAgICAgICAgICAgICAgICAgIHNjYW5fcmVzdWx0ID0gYXdhaXQgYXN5bmNpby53YWl0X2ZvcihzY3JhcGVyLnNjYW4oKSwgdGltZW91dD02MCkNCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzY2FuX3Jlc3VsdCwgZGljdCk6DQogICAgICAgICAgICAgICAgICAgICAgICBtZXJnZWRbInNjcmFwZSJdID0gc2Nhbl9yZXN1bHQNCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgICAgICAgICBtZXJnZWRbInNjcmFwZSJdID0ge30NCiAgICAgICAgICAgICAgICByZXR1cm4gZnFkbiwgbWVyZ2VkDQogICAgICAgIHJldHVybiBOb25lLCBOb25lDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIE1haW4gU2Nhbm5lciBMb2dpYyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KY2xhc3MgV29yZFByZXNzU2Nhbm5lcjoNCiAgICAiIiJNYWluIFdvcmRQcmVzcyBzY2FubmVyIGNsYXNzIHRoYXQgaGFuZGxlcyBkb3JrIGdlbmVyYXRpb24gYW5kIHNjYW5uaW5nLiIiIg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25maWc6IE9wdGlvbmFsW0RpY3Rbc3RyLCBBbnldXSA9IE5vbmUpOg0KICAgICAgICBzZWxmLmNvbmZpZyA9IGNvbmZpZyBvciBzZWxmLmxvYWRfZGVmYXVsdF9jb25maWcoKQ0KICAgICAgICBzZWxmLnJhdGVfbGltaXRlciA9IFJhdGVMaW1pdGVyKHJlcXVlc3RzX3Blcl9wZXJpb2Q9c2VsZi5jb25maWcuZ2V0KCdyYXRlX2xpbWl0JywgMTApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmlvZF9zZWNvbmRzPXNlbGYuY29uZmlnLmdldCgncmF0ZV9wZXJpb2QnLCAzKSkNCiAgICAgICAgc2VsZi5nZW1pbmlfc2VlZGVyOiBPcHRpb25hbFsnR2VtaW5pU2VlZGVyJ10gPSBOb25lDQogICAgICAgIGlmIHNlbGYuY29uZmlnLmdldCgnZ2VtaW5pX2FwaV9rZXknKToNCiAgICAgICAgICAgIHNlbGYuZ2VtaW5pX3NlZWRlciA9IEdlbWluaVNlZWRlcihzZWxmLmNvbmZpZy5nZXQoJ2dlbWluaV9hcGlfa2V5JywgJycpLCBzZWxmLmNvbmZpZy5nZXQoJ2dlbWluaV9tb2RlbCcsICdnZW1pbmktMS41LWZsYXNoLWxhdGVzdCcpKQ0KDQogICAgICAgIHNlbGYuZGlzY292ZXJlZF91cmxzOiBMaXN0W3N0cl0gPSBbXQ0KICAgICAgICBzZWxmLmRpc2NvdmVyZWRfZG9tYWluczogTGlzdFtzdHJdID0gW10NCiAgICAgICAgc2VsZi5zdWJkb21haW5fcmVzdWx0czogRGljdFtzdHIsIEFueV0gPSB7fQ0KDQogICAgICAgIHNlbGYuZGVmYXVsdF9wYXR0ZXJucyA9IFsNCiAgICAgICAgICAgICdpbnVybDp3cC1jb250ZW50ICJ7a2V5d29yZH0iJywgJ2ludXJsOndwLWFkbWluICJ7a2V5d29yZH0iJywNCiAgICAgICAgICAgICdpbnVybDp3cC1pbmNsdWRlcyAie2tleXdvcmR9IicsICdpbnRpdGxlOiJXb3JkUHJlc3MiICJ7a2V5d29yZH0iJywNCiAgICAgICAgICAgICdpbnRleHQ6InBvd2VyZWQgYnkgV29yZFByZXNzIiAie2tleXdvcmR9IicNCiAgICAgICAgXQ0KICAgICAgICBzZWxmLmRvcmtzOiBMaXN0W3N0cl0gPSBbXQ0KDQogICAgZGVmIGxvYWRfZGVmYXVsdF9jb25maWcoc2VsZikgLT4gRGljdFtzdHIsIEFueV06DQogICAgICAgIGNvbmZpZ19maWxlID0gImNvbmZpZy5qc29uIg0KICAgICAgICBkZWZhdWx0X2NvbmZpZyA9IHsNCiAgICAgICAgICAgICJ0aW1lb3V0IjogMjAsICJtYXhfd29ya2VycyI6IDUwLCAiZGVidWdfbW9kZSI6IFRydWUsDQogICAgICAgICAgICAidXJsc19maWxlIjogb3MucGF0aC5qb2luKCJyZXN1bHRzIiwgInVybHMudHh0IiksDQogICAgICAgICAgICAiZG9tYWluc19maWxlIjogb3MucGF0aC5qb2luKCJyZXN1bHRzIiwgImRvbWFpbnMudHh0IiksDQogICAgICAgICAgICAic3ViZG9tYWluc19maWxlIjogb3MucGF0aC5qb2luKCJyZXN1bHRzIiwgInN1YmRvbWFpbnMudHh0IiksDQogICAgICAgICAgICAic3ViZG9tYWluX3NjYW4iOiBUcnVlLCAidmVyaWZ5X3RscyI6IEZhbHNlLCAiZ2VtaW5pX2FwaV9rZXkiOiAiIiwNCiAgICAgICAgICAgICJnZW1pbmlfbW9kZWwiOiAiZ2VtaW5pLTEuNS1mbGFzaC1sYXRlc3QiLCAidXNlX2dlbWluaV9mb3JfZG9ya3MiOiBUcnVlLA0KICAgICAgICAgICAgInJhdGVfbGltaXQiOiAxMCwgInJhdGVfcGVyaW9kIjogMw0KICAgICAgICB9DQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGNvbmZpZ19maWxlKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oY29uZmlnX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgZGVmYXVsdF9jb25maWcudXBkYXRlKGNvbmZpZykNCiAgICAgICAgICAgIGV4Y2VwdCAoanNvbi5KU09ORGVjb2RlRXJyb3IsIElPRXJyb3IpOiBwYXNzDQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgb3MubWFrZWRpcnMoInJlc3VsdHMiLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgd2l0aCBvcGVuKGNvbmZpZ19maWxlLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgICAgICAgICAganNvbi5kdW1wKGRlZmF1bHRfY29uZmlnLCBmLCBpbmRlbnQ9NCkNCiAgICAgICAgZXhjZXB0IElPRXJyb3I6IHBhc3MNCiAgICAgICAgcmV0dXJuIGRlZmF1bHRfY29uZmlnDQoNCiAgICBkZWYgZ2VuZXJhdGVfZG9ya3NfZnJvbV9rZXl3b3JkcyhzZWxmLCBrZXl3b3JkczogTGlzdFtzdHJdLCBwYXR0ZXJuczogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUpIC0+IExpc3Rbc3RyXToNCiAgICAgICAgcGF0dGVybnMgPSBwYXR0ZXJucyBvciBzZWxmLmRlZmF1bHRfcGF0dGVybnMNCiAgICAgICAgZG9ya3MgPSBzZXQoKQ0KICAgICAgICBmb3Iga2V5d29yZCBpbiBrZXl3b3JkczoNCiAgICAgICAgICAgIGlmIG5vdCBrZXl3b3JkOiBjb250aW51ZQ0KICAgICAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6DQogICAgICAgICAgICAgICAgZG9ya3MuYWRkKHBhdHRlcm4ucmVwbGFjZSgie2tleXdvcmR9Iiwga2V5d29yZC5zdHJpcCgpKSkNCiAgICAgICAgc2VsZi5kb3JrcyA9IHNvcnRlZChsaXN0KGRvcmtzKSkNCiAgICAgICAgcmV0dXJuIHNlbGYuZG9ya3MNCg0KDQogICAgZGVmIGdldF9iYXNlX2RvbWFpbihzZWxmLCB1cmxfc3RyOiBzdHIpIC0+IHN0cjoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcGFyc2VkID0gdXJscGFyc2UodXJsX3N0cikNCiAgICAgICAgICAgIG5ldGxvYyA9IHBhcnNlZC5uZXRsb2Mgb3IgcGFyc2VkLnBhdGgNCiAgICAgICAgICAgIGlmIG5vdCBuZXRsb2M6IHJldHVybiAidW5rbm93biINCiAgICAgICAgICAgIHBhcnRzID0gbmV0bG9jLnNwbGl0KCc6JylbMF0uc3BsaXQoJy4nKQ0KICAgICAgICAgICAgcmV0dXJuICIuIi5qb2luKHBhcnRzWy0yOl0pIGlmIGxlbihwYXJ0cykgPj0gMiBlbHNlIG5ldGxvYw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgcmV0dXJuICJ1bmtub3duIg0KDQogICAgZGVmIHNhdmVfcmVzdWx0cyhzZWxmKToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgb3MubWFrZWRpcnMoInJlc3VsdHMiLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgcmVzdWx0c19kYXRhID0gew0KICAgICAgICAgICAgICAgICJ1cmxzIjogc29ydGVkKGxpc3Qoc2V0KHNlbGYuZGlzY292ZXJlZF91cmxzKSkpLA0KICAgICAgICAgICAgICAgICJkb21haW5zIjogc29ydGVkKGxpc3Qoc2V0KHNlbGYuZGlzY292ZXJlZF9kb21haW5zKSkpLA0KICAgICAgICAgICAgICAgICJzdWJkb21haW5zIjogc2VsZi5zdWJkb21haW5fcmVzdWx0cw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbigicmVzdWx0cyIsICJzY2FuX3Jlc3VsdHMuanNvbiIpLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6DQogICAgICAgICAgICAgICAganNvbi5kdW1wKHJlc3VsdHNfZGF0YSwgZiwgaW5kZW50PTQpDQoNCiAgICAgICAgICAgIGZvciBrZXksIGRhdGFfbGlzdCBpbiBbKCJ1cmxzIiwgc2VsZi5kaXNjb3ZlcmVkX3VybHMpLCAoImRvbWFpbnMiLCBzZWxmLmRpc2NvdmVyZWRfZG9tYWlucyldOg0KICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IHNlbGYuY29uZmlnLmdldChmJ3trZXl9X2ZpbGUnLCBvcy5wYXRoLmpvaW4oInJlc3VsdHMiLCBmIntrZXl9LnR4dCIpKQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGl0ZW0gaW4gc29ydGVkKGxpc3Qoc2V0KGRhdGFfbGlzdCkpKTogZi53cml0ZShmIntpdGVtfVxuIikNCiAgICAgICAgZXhjZXB0IElPRXJyb3I6IHBhc3MNCg0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBQeVF0NSBXb3JrZXIgU2lnbmFscyAmIFRocmVhZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCmlmIFVTRV9HVUk6DQogICAgY2xhc3MgV29ya2VyU2lnbmFscyhRT2JqZWN0KToNCiAgICAgICAgbG9nX21lc3NhZ2UgPSBweXF0U2lnbmFsKHN0cikNCiAgICAgICAgbG9nX21lc3NhZ2VzID0gcHlxdFNpZ25hbChsaXN0KQ0KICAgICAgICByZXN1bHRzX2ZvdW5kID0gcHlxdFNpZ25hbChsaXN0KQ0KICAgICAgICBzdWJkb21haW5zX2ZvdW5kID0gcHlxdFNpZ25hbChsaXN0KQ0KICAgICAgICBzY2FuX3Byb2dyZXNzID0gcHlxdFNpZ25hbChpbnQsIGludCkNCiAgICAgICAgc2Nhbm5pbmdfc3RvcHBlZCA9IHB5cXRTaWduYWwoc3RyKQ0KICAgICAgICBkb3Jrc19nZW5lcmF0ZWQgPSBweXF0U2lnbmFsKGxpc3QpDQoNCiAgICBjbGFzcyBTY2FubmVyV29ya2VyKFFUaHJlYWQpOg0KICAgICAgICBkZWYgX19pbml0X18oc2VsZiwgc2Nhbm5lcjogV29yZFByZXNzU2Nhbm5lcik6DQogICAgICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkNCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lciA9IHNjYW5uZXINCiAgICAgICAgICAgIHNlbGYuc2lnbmFscyA9IFdvcmtlclNpZ25hbHMoKQ0KICAgICAgICAgICAgc2VsZi5fcnVubmluZyA9IFRydWUNCg0KICAgICAgICBkZWYgcnVuKHNlbGYpOg0KICAgICAgICAgICAgc2VsZi5sb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpDQogICAgICAgICAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKHNlbGYubG9vcCkNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWxmLmxvb3AucnVuX3VudGlsX2NvbXBsZXRlKHNlbGYubWFpbigpKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICBzZWxmLnNpZ25hbHMubG9nX21lc3NhZ2UuZW1pdChmIltFUlJPUl0gU2Nhbm5lciB0aHJlYWQgZXJyb3I6IHt0cmFjZWJhY2suZm9ybWF0X2V4YygpfSIpDQogICAgICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgICAgIHNlbGYuc2lnbmFscy5zY2FubmluZ19zdG9wcGVkLmVtaXQoIkZpbmlzaGVkIikNCg0KICAgICAgICBhc3luYyBkZWYgbWFpbihzZWxmKToNCiAgICAgICAgICAgIGRvbWFpbl9xdWV1ZTogYXN5bmNpby5RdWV1ZSA9IGFzeW5jaW8uUXVldWUoKQ0KICAgICAgICAgICAgcXVldWVkX2RvbWFpbnM6IFNldFtzdHJdID0gc2V0KCkNCiAgICAgICAgICAgIGxvZ19iYXRjaDogbGlzdCA9IFtdOyByZXN1bHRfYmF0Y2g6IGxpc3QgPSBbXTsgc3ViZG9tYWluX2JhdGNoOiBsaXN0ID0gW10NCiAgICAgICAgICAgIGJhdGNoX2xvY2sgPSBhc3luY2lvLkxvY2soKQ0KICAgICAgICAgICAgc3RvcF9lbWl0dGVyID0gYXN5bmNpby5FdmVudCgpDQoNCiAgICAgICAgICAgIGNvbnN1bWVyID0gYXN5bmNpby5jcmVhdGVfdGFzayhzZWxmLnN1YmRvbWFpbl9zY2FuX2NvbnN1bWVyKGRvbWFpbl9xdWV1ZSwgc3ViZG9tYWluX2JhdGNoLCBsb2dfYmF0Y2gsIGJhdGNoX2xvY2spKQ0KICAgICAgICAgICAgZW1pdHRlciA9IGFzeW5jaW8uY3JlYXRlX3Rhc2soc2VsZi5iYXRjaF9lbWl0dGVyKGxvZ19iYXRjaCwgcmVzdWx0X2JhdGNoLCBzdWJkb21haW5fYmF0Y2gsIGJhdGNoX2xvY2ssIHN0b3BfZW1pdHRlcikpDQoNCiAgICAgICAgICAgIGRvcmtfdGFza3MgPSBbc2VsZi5wcm9jZXNzX2RvcmsoZG9yaywgZG9tYWluX3F1ZXVlLCBxdWV1ZWRfZG9tYWlucywgcmVzdWx0X2JhdGNoLCBsb2dfYmF0Y2gsIGJhdGNoX2xvY2spIGZvciBkb3JrIGluIHNlbGYuc2Nhbm5lci5kb3Jrc10NCg0KICAgICAgICAgICAgaWYgZG9ya190YXNrczoNCiAgICAgICAgICAgICAgICBzZWxmLnNpZ25hbHMubG9nX21lc3NhZ2UuZW1pdCgiW0lORk9dIFN0YXJ0aW5nIGNvbmN1cnJlbnQgc2Nhbi4uLiIpDQogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5ydW5fdGFza3NfY29uY3VycmVudGx5KGRvcmtfdGFza3MpDQoNCiAgICAgICAgICAgIGF3YWl0IGRvbWFpbl9xdWV1ZS5wdXQoTm9uZSkNCiAgICAgICAgICAgIGF3YWl0IGNvbnN1bWVyDQogICAgICAgICAgICBzdG9wX2VtaXR0ZXIuc2V0KCkNCiAgICAgICAgICAgIGF3YWl0IGVtaXR0ZXINCg0KICAgICAgICBhc3luYyBkZWYgYmF0Y2hfZW1pdHRlcihzZWxmLCBsb2dfYmF0Y2gsIHJlc3VsdF9iYXRjaCwgc3ViZG9tYWluX2JhdGNoLCBsb2NrLCBzdG9wX2V2ZW50KToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB3aGlsZSBub3Qgc3RvcF9ldmVudC5pc19zZXQoKToNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxLjApDQogICAgICAgICAgICAgICAgICAgIGxvZ3NfdG9fZW1pdCwgcmVzdWx0c190b19lbWl0LCBzdWJkb21haW5zX3RvX2VtaXQgPSBbXSwgW10sIFtdDQogICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvZ19iYXRjaDogbG9nc190b19lbWl0ID0gbG9nX2JhdGNoWzpdOyBsb2dfYmF0Y2guY2xlYXIoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzdWx0X2JhdGNoOiByZXN1bHRzX3RvX2VtaXQgPSByZXN1bHRfYmF0Y2hbOl07IHJlc3VsdF9iYXRjaC5jbGVhcigpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdWJkb21haW5fYmF0Y2g6IHN1YmRvbWFpbnNfdG9fZW1pdCA9IHN1YmRvbWFpbl9iYXRjaFs6XTsgc3ViZG9tYWluX2JhdGNoLmNsZWFyKCkNCg0KICAgICAgICAgICAgICAgICAgICBpZiBsb2dzX3RvX2VtaXQ6IHNlbGYuc2lnbmFscy5sb2dfbWVzc2FnZXMuZW1pdChsb2dzX3RvX2VtaXQpDQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdHNfdG9fZW1pdDogc2VsZi5zaWduYWxzLnJlc3VsdHNfZm91bmQuZW1pdChyZXN1bHRzX3RvX2VtaXQpDQogICAgICAgICAgICAgICAgICAgIGlmIHN1YmRvbWFpbnNfdG9fZW1pdDogc2VsZi5zaWduYWxzLnN1YmRvbWFpbnNfZm91bmQuZW1pdChzdWJkb21haW5zX3RvX2VtaXQpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoZiJbRVJST1JdIEJhdGNoIGVtaXR0ZXIgZmFpbGVkOiB7ZX0iKQ0KDQogICAgICAgIGFzeW5jIGRlZiBzdWJkb21haW5fc2Nhbl9jb25zdW1lcihzZWxmLCBkb21haW5fcXVldWU6IGFzeW5jaW8uUXVldWUsIHN1YmRvbWFpbl9iYXRjaDogbGlzdCwgbG9nX2JhdGNoOiBsaXN0LCBsb2NrOiBhc3luY2lvLkxvY2spOg0KICAgICAgICAgICAgaHR0cF9jbGllbnQgPSBIdHRwQ2xpZW50KHNlbGYuc2Nhbm5lci5jb25maWcuZ2V0KCd2ZXJpZnlfdGxzJywgRmFsc2UpKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHdoaWxlIHNlbGYuX3J1bm5pbmc6DQogICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbiA9IGF3YWl0IGFzeW5jaW8ud2FpdF9mb3IoZG9tYWluX3F1ZXVlLmdldCgpLCB0aW1lb3V0PTEuMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRvbWFpbiBpcyBOb25lOiBicmVhaw0KDQogICAgICAgICAgICAgICAgICAgICAgICBzdWJfc2Nhbm5lciA9IFN1YmRvbWFpblNjYW5uZXIoc2VsZi5zY2FubmVyLmNvbmZpZykNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBhd2FpdCBzdWJfc2Nhbm5lci5kaXNjb3Zlcl93b3JkcHJlc3Nfc3ViZG9tYWlucyhkb21haW4sIGh0dHBfY2xpZW50LCBsb2dfYmF0Y2gsIGxvY2spDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9ydW5uaW5nIGFuZCByZXN1bHRzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNjYW5uZXIuc3ViZG9tYWluX3Jlc3VsdHMudXBkYXRlKHJlc3VsdHMpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmcWRuLCBpbmZvIGluIHJlc3VsdHMuaXRlbXMoKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmRvbWFpbl9iYXRjaC5hcHBlbmQoKGZxZG4sIGRvbWFpbiwgaW5mbykpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBhc3luY2lvLlRpbWVvdXRFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgICAgIGF3YWl0IGh0dHBfY2xpZW50LmNsb3NlKCkNCg0KICAgICAgICBhc3luYyBkZWYgcnVuX3Rhc2tzX2NvbmN1cnJlbnRseShzZWxmLCB0YXNrczogTGlzdFthc3luY2lvLlRhc2tdKToNCiAgICAgICAgICAgIHNlbWFwaG9yZSA9IGFzeW5jaW8uU2VtYXBob3JlKHNlbGYuc2Nhbm5lci5jb25maWcuZ2V0KCdtYXhfd29ya2VycycsIDUwKSkNCiAgICAgICAgICAgIHRvdGFsX3Rhc2tzID0gbGVuKHRhc2tzKQ0KICAgICAgICAgICAgc2VsZi5zaWduYWxzLnNjYW5fcHJvZ3Jlc3MuZW1pdCgwLCB0b3RhbF90YXNrcykNCg0KICAgICAgICAgICAgYXN5bmMgZGVmIHJ1bl93aXRoX3NlbWFwaG9yZSh0YXNrX2Nvcm8sIGlkeCk6DQogICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBzZW1hcGhvcmU6DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9ydW5uaW5nOiByYWlzZSBhc3luY2lvLkNhbmNlbGxlZEVycm9yKCkNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGFza19jb3JvDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2lnbmFscy5zY2FuX3Byb2dyZXNzLmVtaXQoaWR4ICsgMSwgdG90YWxfdGFza3MpDQoNCiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uZ2F0aGVyKCoocnVuX3dpdGhfc2VtYXBob3JlKHRhc2ssIGkpIGZvciBpLCB0YXNrIGluIGVudW1lcmF0ZSh0YXNrcykpKQ0KDQogICAgICAgIGFzeW5jIGRlZiBwcm9jZXNzX2Rvcmsoc2VsZiwgZG9yaywgZG9tYWluX3F1ZXVlLCBxdWV1ZWRfZG9tYWlucywgcmVzdWx0X2JhdGNoLCBsb2dfYmF0Y2gsIGxvY2spOg0KICAgICAgICAgICAgaWYgbm90IHNlbGYuX3J1bm5pbmc6IHJldHVybg0KICAgICAgICAgICAgYXdhaXQgc2VsZi5zY2FubmVyLnJhdGVfbGltaXRlci53YWl0KCkNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBkZWYgc2VhcmNoX2RkZygpOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIERER1ModGltZW91dD1zZWxmLnNjYW5uZXIuY29uZmlnLmdldCgndGltZW91dCcsIDIwKSkgYXMgZGRnczoNCiAgICAgICAgICAgICAgICAgICAgICAgICMgRmV0Y2ggbW9yZSByZXN1bHRzIHBlciBkb3JrDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW3IuZ2V0KCdocmVmJykgZm9yIHIgaW4gZGRncy50ZXh0KGRvcmssIG1heF9yZXN1bHRzPTEwMCkgaWYgci5nZXQoJ2hyZWYnKV0NCg0KICAgICAgICAgICAgICAgIGxpbmtzID0gYXdhaXQgYXN5bmNpby50b190aHJlYWQoc2VhcmNoX2RkZykNCiAgICAgICAgICAgICAgICBhc3luYyB3aXRoIGxvY2s6DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9ydW5uaW5nOiByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltGRVRDSF0gJ3tkb3JrfScgcmV0dXJuZWQge2xlbihsaW5rcyl9IFVSTHMuIikNCiAgICAgICAgICAgICAgICAgICAgZm9yIHVybCBpbiBsaW5rczoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFueShrdyBpbiB1cmwgZm9yIGt3IGluIFsid3AtY29udGVudCIsICJ3cC1pbmNsdWRlcyIsICJ3b3JkcHJlc3MiLCAid3AtanNvbiJdKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1cmwgbm90IGluIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX3VybHM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX3VybHMuYXBwZW5kKHVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9kb21haW4gPSBzZWxmLnNjYW5uZXIuZ2V0X2Jhc2VfZG9tYWluKHVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmFzZV9kb21haW4gbm90IGluIHNlbGYuc2Nhbm5lci5kaXNjb3ZlcmVkX2RvbWFpbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNjYW5uZXIuZGlzY292ZXJlZF9kb21haW5zLmFwcGVuZChiYXNlX2RvbWFpbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0X2JhdGNoLmFwcGVuZCgodXJsLCBiYXNlX2RvbWFpbikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc2Nhbm5lci5jb25maWcuZ2V0KCdzdWJkb21haW5fc2NhbicpIGFuZCBiYXNlX2RvbWFpbiBub3QgaW4gcXVldWVkX2RvbWFpbnM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZWRfZG9tYWlucy5hZGQoYmFzZV9kb21haW4pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkb21haW5fcXVldWUucHV0KGJhc2VfZG9tYWluKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggbG9jazoNCiAgICAgICAgICAgICAgICAgICAgbG9nX2JhdGNoLmFwcGVuZChmIltFUlJPUl0gRG9yayBmYWlsZWQ6ICd7ZG9ya30nLiBSZWFzb246IHtlfSIpDQoNCiAgICAgICAgZGVmIHN0b3Aoc2VsZik6DQogICAgICAgICAgICBzZWxmLl9ydW5uaW5nID0gRmFsc2UNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gR1VJIEltcGxlbWVudGF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQppZiBVU0VfR1VJOg0KICAgIGNsYXNzIEdlbWluaVdvcmtlclNpZ25hbHMoUU9iamVjdCk6DQogICAgICAgIGxvZ19tZXNzYWdlID0gcHlxdFNpZ25hbChzdHIpDQogICAgICAgIGRvcmtzX2dlbmVyYXRlZCA9IHB5cXRTaWduYWwobGlzdCkNCg0KICAgIGNsYXNzIEdlbWluaURvcmtXb3JrZXIoUVRocmVhZCk6DQogICAgICAgICIiIldvcmtlciB0aHJlYWQgdG8gZ2VuZXJhdGUgZG9ya3MgdXNpbmcgR2VtaW5pIEFJIHdpdGhvdXQgYmxvY2tpbmcgdGhlIEdVSS4iIiINCiAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIGFwaV9rZXk6IHN0ciwgbW9kZWw6IHN0ciwga2V5d29yZHM6IExpc3Rbc3RyXSwgbWF4X2RvcmtzOiBpbnQgPSA1MCk6DQogICAgICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkNCiAgICAgICAgICAgIHNlbGYuc2lnbmFscyA9IEdlbWluaVdvcmtlclNpZ25hbHMoKQ0KICAgICAgICAgICAgc2VsZi5hcGlfa2V5ID0gYXBpX2tleQ0KICAgICAgICAgICAgc2VsZi5tb2RlbCA9IG1vZGVsDQogICAgICAgICAgICBzZWxmLmtleXdvcmRzID0ga2V5d29yZHMNCiAgICAgICAgICAgIHNlbGYubWF4X2RvcmtzID0gbWF4X2RvcmtzDQogICAgICAgICAgICBzZWxmLl9ydW5uaW5nID0gVHJ1ZQ0KDQogICAgICAgIGRlZiBydW4oc2VsZik6DQogICAgICAgICAgICBpZiBub3QgZ2VuYWk6DQogICAgICAgICAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoIltFUlJPUl0gR2VtaW5pIGxpYnJhcnkgKGdvb2dsZS5nZW5lcmF0aXZlYWkpIGlzIG5vdCBpbnN0YWxsZWQuIikNCiAgICAgICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGdlbmFpLmNvbmZpZ3VyZShhcGlfa2V5PXNlbGYuYXBpX2tleSkNCiAgICAgICAgICAgICAgICBnZW5lcmF0aW9uX2NvbmZpZyA9IGdlbmFpLkdlbmVyYXRpb25Db25maWcoDQogICAgICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlPTAuNywgdG9wX3A9MS4wLCB0b3Bfaz00MCwgbWF4X291dHB1dF90b2tlbnM9MjA0OCwNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgbW9kZWwgPSBnZW5haS5HZW5lcmF0aXZlTW9kZWwoc2VsZi5tb2RlbCwgZ2VuZXJhdGlvbl9jb25maWc9Z2VuZXJhdGlvbl9jb25maWcpDQoNCiAgICAgICAgICAgICAgICBwcm9tcHQgPSBmIiIiDQogICAgICAgICAgICAgICAgWW91IGFyZSBhIGN5YmVyc2VjdXJpdHkgZXhwZXJ0IHNwZWNpYWxpemluZyBpbiBPU0lOVCBhbmQgc2VhcmNoIGVuZ2luZSBkb3JraW5nLg0KICAgICAgICAgICAgICAgIFlvdXIgdGFzayBpcyB0byBnZW5lcmF0ZSBhIGxpc3Qgb2Yge3NlbGYubWF4X2RvcmtzfSB1bmlxdWUgYW5kIGNyZWF0aXZlIEdvb2dsZSBkb3JrcyB0byBmaW5kIFdvcmRQcmVzcyB3ZWJzaXRlcyByZWxhdGVkIHRvIHRoZSBmb2xsb3dpbmcga2V5d29yZHM6IHsnLCAnLmpvaW4oc2VsZi5rZXl3b3Jkcyl9Lg0KICAgICAgICAgICAgICAgIEZvY3VzIG9uIGRpc2NvdmVyaW5nIGxvZ2luIHBhZ2VzLCB2dWxuZXJhYmxlIHBsdWdpbnMsIGV4cG9zZWQgZmlsZXMsIGFuZCBtaXNjb25maWd1cmF0aW9ucy4NCiAgICAgICAgICAgICAgICBUaGUgZG9ya3Mgc2hvdWxkIHVzZSBhIHZhcmlldHkgb2Ygb3BlcmF0b3JzIGxpa2UgaW51cmw6LCBpbnRpdGxlOiwgaW50ZXh0OiwgZmlsZXR5cGU6LCBhbmQgc2l0ZTouDQogICAgICAgICAgICAgICAgQ29tYmluZSB0aGVtIGluIGludGVyZXN0aW5nIHdheXMuIERvIG5vdCBqdXN0IHJlcGVhdCB0aGUgc2FtZSBwYXR0ZXJuIGZvciBlYWNoIGtleXdvcmQuDQogICAgICAgICAgICAgICAgUHJvdmlkZSBPTkxZIHRoZSBkb3Jrcywgb25lIHBlciBsaW5lLiBEbyBub3QgaW5jbHVkZSBhbnkgZXhwbGFuYXRpb25zLCB0aXRsZXMsIG9yIG1hcmtkb3duIGZvcm1hdHRpbmcgbGlrZSBgYGAuDQoNCiAgICAgICAgICAgICAgICBFeGFtcGxlIG9mIGdvb2Qgb3V0cHV0IGZvcm1hdDoNCiAgICAgICAgICAgICAgICBpbnRpdGxlOiJJbmRleCBvZiAvd3AtY29udGVudC9wbHVnaW5zLyIgImVsZW1lbnRvciINCiAgICAgICAgICAgICAgICBpbnVybDovd3AtY29uZmlnLnR4dCAiREJfUEFTU1dPUkQiDQogICAgICAgICAgICAgICAgZmlsZXR5cGU6c3FsIGludGV4dDp3cF91c2VycyAicGFzc3dvcmQiDQogICAgICAgICAgICAgICAgaW50ZXh0OiJQb3dlcmVkIGJ5IFdvcmRQcmVzcyIgaW50aXRsZToie3NlbGYua2V5d29yZHN9Ig0KDQogICAgICAgICAgICAgICAgTm93LCBnZW5lcmF0ZSB0aGUgbGlzdC4NCiAgICAgICAgICAgICAgICAiIiINCg0KICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLl9ydW5uaW5nOiByZXR1cm4NCg0KICAgICAgICAgICAgICAgIHNlbGYuc2lnbmFscy5sb2dfbWVzc2FnZS5lbWl0KCJbSU5GT10gU2VuZGluZyBwcm9tcHQgdG8gR2VtaW5pLi4uIikNCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG1vZGVsLmdlbmVyYXRlX2NvbnRlbnQocHJvbXB0KQ0KDQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX3J1bm5pbmc6IHJldHVybg0KDQogICAgICAgICAgICAgICAgaWYgcmVzcG9uc2UucGFydHM6DQogICAgICAgICAgICAgICAgICAgIGFpX2RvcmtzID0gcmVzcG9uc2UudGV4dC5zdHJpcCgpLnNwbGl0KCdcbicpDQogICAgICAgICAgICAgICAgICAgIGNsZWFuZWRfZG9ya3MgPSBbZC5zdHJpcCgpIGZvciBkIGluIGFpX2RvcmtzIGlmIGQuc3RyaXAoKSBhbmQgbm90IGQuc3RhcnRzd2l0aCgnYGBgJyldDQogICAgICAgICAgICAgICAgICAgIGlmIGNsZWFuZWRfZG9ya3M6DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNpZ25hbHMuZG9ya3NfZ2VuZXJhdGVkLmVtaXQoY2xlYW5lZF9kb3JrcykNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2lnbmFscy5sb2dfbWVzc2FnZS5lbWl0KCJbV0FSTl0gR2VtaW5pIHJlc3BvbmRlZCwgYnV0IG5vIHZhbGlkIGRvcmtzIHdlcmUgcGFyc2VkLiIpDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaWduYWxzLmxvZ19tZXNzYWdlLmVtaXQoIltXQVJOXSBHZW1pbmkgcmV0dXJuZWQgYW4gZW1wdHkgcmVzcG9uc2UuIikNCg0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2UgPSBzdHIoZSkuc3BsaXQoJ1xuJylbMF0gIyBLZWVwIGl0IGNvbmNpc2UNCiAgICAgICAgICAgICAgICBzZWxmLnNpZ25hbHMubG9nX21lc3NhZ2UuZW1pdChmIltFUlJPUl0gR2VtaW5pIHJlcXVlc3QgZmFpbGVkOiB7ZXJyb3JfbWVzc2FnZX0iKQ0KDQogICAgICAgIGRlZiBzdG9wKHNlbGYpOg0KICAgICAgICAgICAgc2VsZi5fcnVubmluZyA9IEZhbHNlDQoNCg0KICAgIGNsYXNzIFdvcmRQcmVzc1NjYW5uZXJVSShRTWFpbldpbmRvdyk6DQogICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsb2dvX3BpeG1hcD1Ob25lKToNCiAgICAgICAgICAgIHN1cGVyKCkuX19pbml0X18oKQ0KICAgICAgICAgICAgc2VsZi5zZXRXaW5kb3dUaXRsZSgiTWFzcyBXb3JkcHJlc3MgU2NyYXBwZXIgKHYyKSBieSBSZWRIeWRyYSIpDQogICAgICAgICAgICBzZWxmLmxvZ29fcGl4bWFwID0gbG9nb19waXhtYXANCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lciA9IFdvcmRQcmVzc1NjYW5uZXIoKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXI6IE9wdGlvbmFsW1NjYW5uZXJXb3JrZXJdID0gTm9uZQ0KICAgICAgICAgICAgc2VsZi5nZW1pbmlfd29ya2VyOiBPcHRpb25hbFtHZW1pbmlEb3JrV29ya2VyXSA9IE5vbmUNCiAgICAgICAgICAgIHNlbGYuY3JlYXRlX3VpKCkNCiAgICAgICAgICAgIHNlbGYuYXBwbHlfZGFya190aGVtZSgpDQogICAgICAgICAgICBzZWxmLmxvYWRfc2V0dGluZ3MoKQ0KICAgICAgICAgICAgc2VsZi5zZXR1cF9jb250ZXh0X21lbnVzKCkNCg0KICAgICAgICBkZWYgY3JlYXRlX3VpKHNlbGYpOg0KICAgICAgICAgICAgbWFpbl93aWRnZXQgPSBRV2lkZ2V0KCkNCiAgICAgICAgICAgIHNlbGYuc2V0Q2VudHJhbFdpZGdldChtYWluX3dpZGdldCkNCiAgICAgICAgICAgIG1haW5fbGF5b3V0ID0gUVZCb3hMYXlvdXQobWFpbl93aWRnZXQpDQogICAgICAgICAgICBoZWFkZXJfZnJhbWUgPSBRRnJhbWUoKQ0KICAgICAgICAgICAgaGVhZGVyX2xheW91dCA9IFFIQm94TGF5b3V0KGhlYWRlcl9mcmFtZSkNCiAgICAgICAgICAgIGhlYWRlcl90ZXh0X2xheW91dCA9IFFWQm94TGF5b3V0KCkNCiAgICAgICAgICAgIHRpdGxlX2xhYmVsID0gUUxhYmVsKCJNYXNzIFdvcmRwcmVzcyBTY3JhcHBlciIpDQogICAgICAgICAgICB0aXRsZV9sYWJlbC5zZXRTdHlsZVNoZWV0KCJmb250LXNpemU6IDI0cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogI0UyRThGMDsiKQ0KICAgICAgICAgICAgZGVzY19sYWJlbCA9IFFMYWJlbCgiQWR2YW5jZWQgRGlzY292ZXJ5IFRvb2wgZm9yIFdvcmRQcmVzcyBTaXRlcyIpDQogICAgICAgICAgICBkZXNjX2xhYmVsLnNldFN0eWxlU2hlZXQoImZvbnQtc2l6ZTogMTRweDsgY29sb3I6ICNBMEFFQzA7IikNCiAgICAgICAgICAgIGF1dGhvcl9sYWJlbCA9IFFMYWJlbCgiRGV2ZWxvcGVkIGJ5IFJlZEh5ZHJhIikNCiAgICAgICAgICAgIGF1dGhvcl9sYWJlbC5zZXRTdHlsZVNoZWV0KCJmb250LXNpemU6IDEycHg7IGNvbG9yOiAjNzE4MDk2OyIpDQogICAgICAgICAgICBoZWFkZXJfdGV4dF9sYXlvdXQuYWRkV2lkZ2V0KHRpdGxlX2xhYmVsKQ0KICAgICAgICAgICAgaGVhZGVyX3RleHRfbGF5b3V0LmFkZFdpZGdldChkZXNjX2xhYmVsKQ0KICAgICAgICAgICAgaGVhZGVyX3RleHRfbGF5b3V0LmFkZFdpZGdldChhdXRob3JfbGFiZWwpDQogICAgICAgICAgICBoZWFkZXJfbGF5b3V0LmFkZExheW91dChoZWFkZXJfdGV4dF9sYXlvdXQpDQogICAgICAgICAgICBoZWFkZXJfbGF5b3V0LmFkZFN0cmV0Y2goKQ0KICAgICAgICAgICAgaWYgc2VsZi5sb2dvX3BpeG1hcCBhbmQgbm90IHNlbGYubG9nb19waXhtYXAuaXNOdWxsKCk6DQogICAgICAgICAgICAgICAgbG9nb19sYWJlbCA9IFFMYWJlbCgpDQogICAgICAgICAgICAgICAgbG9nb19sYWJlbC5zZXRQaXhtYXAoc2VsZi5sb2dvX3BpeG1hcC5zY2FsZWQoOTYsIDk2LCBRdC5LZWVwQXNwZWN0UmF0aW8sIFF0LlNtb290aFRyYW5zZm9ybWF0aW9uKSkNCiAgICAgICAgICAgICAgICBoZWFkZXJfbGF5b3V0LmFkZFdpZGdldChsb2dvX2xhYmVsKQ0KICAgICAgICAgICAgbWFpbl9sYXlvdXQuYWRkV2lkZ2V0KGhlYWRlcl9mcmFtZSkNCiAgICAgICAgICAgIHNlbGYudGFicyA9IFFUYWJXaWRnZXQoKQ0KICAgICAgICAgICAgc2VsZi5jcmVhdGVfZG9ya3NfdGFiKCkNCiAgICAgICAgICAgIHNlbGYuY3JlYXRlX3Jlc3VsdHNfdGFiKCkNCiAgICAgICAgICAgIHNlbGYuY3JlYXRlX3N1YmRvbWFpbnNfdGFiKCkNCiAgICAgICAgICAgIHNlbGYuY3JlYXRlX3NldHRpbmdzX3RhYigpDQogICAgICAgICAgICBzZWxmLmNyZWF0ZV9sb2dfdGFiKCkNCiAgICAgICAgICAgIG1haW5fbGF5b3V0LmFkZFdpZGdldChzZWxmLnRhYnMpDQogICAgICAgICAgICBjb250cm9sX2dyb3VwID0gUUdyb3VwQm94KCJTY2FuIENvbnRyb2xzIikNCiAgICAgICAgICAgIGNvbnRyb2xfbGF5b3V0ID0gUUhCb3hMYXlvdXQoY29udHJvbF9ncm91cCkNCiAgICAgICAgICAgIHNlbGYuc3RhcnRfYnRuID0gUVB1c2hCdXR0b24oIlN0YXJ0IFNjYW4iKQ0KICAgICAgICAgICAgc2VsZi5zdGFydF9idG4uY2xpY2tlZC5jb25uZWN0KHNlbGYuc3RhcnRfc2NhbikNCiAgICAgICAgICAgIHNlbGYuc3RvcF9idG4gPSBRUHVzaEJ1dHRvbigiU3RvcCBTY2FuIikNCiAgICAgICAgICAgIHNlbGYuc3RvcF9idG4uY2xpY2tlZC5jb25uZWN0KHNlbGYuc3RvcF9zY2FuKQ0KICAgICAgICAgICAgc2VsZi5zdG9wX2J0bi5zZXRFbmFibGVkKEZhbHNlKQ0KICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19iYXIgPSBRUHJvZ3Jlc3NCYXIoKQ0KICAgICAgICAgICAgc2VsZi51cmxzX2xhYmVsID0gUUxhYmVsKCJVUkxzOiAwIikNCiAgICAgICAgICAgIHNlbGYuZG9tYWluc19sYWJlbCA9IFFMYWJlbCgiRG9tYWluczogMCIpDQogICAgICAgICAgICBjb250cm9sX2xheW91dC5hZGRXaWRnZXQoc2VsZi5zdGFydF9idG4pDQogICAgICAgICAgICBjb250cm9sX2xheW91dC5hZGRXaWRnZXQoc2VsZi5zdG9wX2J0bikNCiAgICAgICAgICAgIGNvbnRyb2xfbGF5b3V0LmFkZFN0cmV0Y2goKQ0KICAgICAgICAgICAgY29udHJvbF9sYXlvdXQuYWRkV2lkZ2V0KHNlbGYudXJsc19sYWJlbCkNCiAgICAgICAgICAgIGNvbnRyb2xfbGF5b3V0LmFkZFdpZGdldChzZWxmLmRvbWFpbnNfbGFiZWwpDQogICAgICAgICAgICBjb250cm9sX2xheW91dC5hZGRXaWRnZXQoc2VsZi5wcm9ncmVzc19iYXIpDQogICAgICAgICAgICBtYWluX2xheW91dC5hZGRXaWRnZXQoY29udHJvbF9ncm91cCkNCg0KICAgICAgICBkZWYgY3JlYXRlX2RvcmtzX3RhYihzZWxmKToNCiAgICAgICAgICAgIGRvcmtzX3RhYiA9IFFXaWRnZXQoKQ0KICAgICAgICAgICAgc2VsZi50YWJzLmFkZFRhYihkb3Jrc190YWIsICJEb3JrIEdlbmVyYXRpb24iKQ0KICAgICAgICAgICAgbGF5b3V0ID0gUUhCb3hMYXlvdXQoZG9ya3NfdGFiKQ0KICAgICAgICAgICAgbGVmdF9wYW5lbCA9IFFXaWRnZXQoKQ0KICAgICAgICAgICAgbGVmdF9sYXlvdXQgPSBRVkJveExheW91dChsZWZ0X3BhbmVsKQ0KICAgICAgICAgICAga2V5d29yZHNfZ3JvdXAgPSBRR3JvdXBCb3goIktleXdvcmRzIikNCiAgICAgICAgICAgIHNlbGYua2V5d29yZHNfdGV4dCA9IFFUZXh0RWRpdCgpDQogICAgICAgICAgICBzZWxmLmtleXdvcmRzX3RleHQuc2V0UGxhY2Vob2xkZXJUZXh0KCJFbnRlciBrZXl3b3JkcyAob25lIHBlciBsaW5lKS4uLiIpDQogICAgICAgICAgICBrZXl3b3Jkc19sYXlvdXQgPSBRVkJveExheW91dChrZXl3b3Jkc19ncm91cCkNCiAgICAgICAgICAgIGtleXdvcmRzX2xheW91dC5hZGRXaWRnZXQoc2VsZi5rZXl3b3Jkc190ZXh0KQ0KICAgICAgICAgICAgbGVmdF9sYXlvdXQuYWRkV2lkZ2V0KGtleXdvcmRzX2dyb3VwKQ0KICAgICAgICAgICAgcGF0dGVybnNfZ3JvdXAgPSBRR3JvdXBCb3goIkJhc2UgRG9yayBQYXR0ZXJucyIpDQogICAgICAgICAgICBzZWxmLnBhdHRlcm5zX3RleHQgPSBRVGV4dEVkaXQoKQ0KICAgICAgICAgICAgc2VsZi5wYXR0ZXJuc190ZXh0LnNldFRleHQoIlxuIi5qb2luKHNlbGYuc2Nhbm5lci5kZWZhdWx0X3BhdHRlcm5zKSkNCiAgICAgICAgICAgIHBhdHRlcm5zX2xheW91dCA9IFFWQm94TGF5b3V0KHBhdHRlcm5zX2dyb3VwKQ0KICAgICAgICAgICAgcGF0dGVybnNfbGF5b3V0LmFkZFdpZGdldChzZWxmLnBhdHRlcm5zX3RleHQpDQogICAgICAgICAgICBsZWZ0X2xheW91dC5hZGRXaWRnZXQocGF0dGVybnNfZ3JvdXApDQogICAgICAgICAgICByaWdodF9wYW5lbCA9IFFXaWRnZXQoKQ0KICAgICAgICAgICAgcmlnaHRfbGF5b3V0ID0gUVZCb3hMYXlvdXQocmlnaHRfcGFuZWwpDQogICAgICAgICAgICBzZWxmLmdlbmVyYXRlX2J0biA9IFFQdXNoQnV0dG9uKCJHZW5lcmF0ZSBEb3JrcyIpDQogICAgICAgICAgICBzZWxmLmdlbmVyYXRlX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5nZW5lcmF0ZV9kb3JrcykNCiAgICAgICAgICAgIHByZXZpZXdfZ3JvdXAgPSBRR3JvdXBCb3goIkdlbmVyYXRlZCBEb3JrcyBQcmV2aWV3IikNCiAgICAgICAgICAgIHNlbGYucHJldmlld190ZXh0ID0gUVRleHRFZGl0KCkNCiAgICAgICAgICAgIHNlbGYucHJldmlld190ZXh0LnNldFJlYWRPbmx5KFRydWUpDQogICAgICAgICAgICBzZWxmLnByZXZpZXdfY291bnRfbGFiZWwgPSBRTGFiZWwoIjAgZG9ya3MgZ2VuZXJhdGVkLiIpDQogICAgICAgICAgICBwcmV2aWV3X2xheW91dCA9IFFWQm94TGF5b3V0KHByZXZpZXdfZ3JvdXApDQogICAgICAgICAgICBwcmV2aWV3X2xheW91dC5hZGRXaWRnZXQoc2VsZi5wcmV2aWV3X3RleHQpDQogICAgICAgICAgICBwcmV2aWV3X2xheW91dC5hZGRXaWRnZXQoc2VsZi5wcmV2aWV3X2NvdW50X2xhYmVsKQ0KICAgICAgICAgICAgcmlnaHRfbGF5b3V0LmFkZFdpZGdldChzZWxmLmdlbmVyYXRlX2J0bikNCiAgICAgICAgICAgIHJpZ2h0X2xheW91dC5hZGRXaWRnZXQocHJldmlld19ncm91cCkNCiAgICAgICAgICAgIGxheW91dC5hZGRXaWRnZXQobGVmdF9wYW5lbCwgMSkNCiAgICAgICAgICAgIGxheW91dC5hZGRXaWRnZXQocmlnaHRfcGFuZWwsIDIpDQoNCiAgICAgICAgZGVmIGNyZWF0ZV9yZXN1bHRzX3RhYihzZWxmKToNCiAgICAgICAgICAgIHJlc3VsdHNfdGFiID0gUVdpZGdldCgpDQogICAgICAgICAgICBzZWxmLnRhYnMuYWRkVGFiKHJlc3VsdHNfdGFiLCAiUmVzdWx0cyIpDQogICAgICAgICAgICBsYXlvdXQgPSBRVkJveExheW91dChyZXN1bHRzX3RhYikNCiAgICAgICAgICAgIHNwbGl0dGVyID0gUVNwbGl0dGVyKFF0Lkhvcml6b250YWwpDQogICAgICAgICAgICB1cmxzX2dyb3VwID0gUUdyb3VwQm94KCJEaXNjb3ZlcmVkIFVSTHMiKQ0KICAgICAgICAgICAgdXJsc19sYXlvdXQgPSBRVkJveExheW91dCh1cmxzX2dyb3VwKQ0KICAgICAgICAgICAgc2VsZi51cmxzX2xpc3QgPSBRVGFibGVXaWRnZXQoMCwgMSkNCiAgICAgICAgICAgIHNlbGYudXJsc19saXN0LnNldEhvcml6b250YWxIZWFkZXJMYWJlbHMoWyJVUkwiXSkNCiAgICAgICAgICAgIHNlbGYudXJsc19saXN0Lmhvcml6b250YWxIZWFkZXIoKS5zZXRTdHJldGNoTGFzdFNlY3Rpb24oVHJ1ZSkNCiAgICAgICAgICAgIHNlbGYudXJsc19saXN0LnNldFNlbGVjdGlvbkJlaGF2aW9yKFFBYnN0cmFjdEl0ZW1WaWV3LlNlbGVjdFJvd3MpDQogICAgICAgICAgICB1cmxzX2xheW91dC5hZGRXaWRnZXQoc2VsZi51cmxzX2xpc3QpDQogICAgICAgICAgICBzcGxpdHRlci5hZGRXaWRnZXQodXJsc19ncm91cCkNCiAgICAgICAgICAgIGRvbWFpbnNfZ3JvdXAgPSBRR3JvdXBCb3goIkRpc2NvdmVyZWQgRG9tYWlucyIpDQogICAgICAgICAgICBkb21haW5zX2xheW91dCA9IFFWQm94TGF5b3V0KGRvbWFpbnNfZ3JvdXApDQogICAgICAgICAgICBzZWxmLmRvbWFpbnNfbGlzdCA9IFFUYWJsZVdpZGdldCgwLCAxKQ0KICAgICAgICAgICAgc2VsZi5kb21haW5zX2xpc3Quc2V0SG9yaXpvbnRhbEhlYWRlckxhYmVscyhbIkRvbWFpbiJdKQ0KICAgICAgICAgICAgc2VsZi5kb21haW5zX2xpc3QuaG9yaXpvbnRhbEhlYWRlcigpLnNldFN0cmV0Y2hMYXN0U2VjdGlvbihUcnVlKQ0KICAgICAgICAgICAgc2VsZi5kb21haW5zX2xpc3Quc2V0U2VsZWN0aW9uQmVoYXZpb3IoUUFic3RyYWN0SXRlbVZpZXcuU2VsZWN0Um93cykNCiAgICAgICAgICAgIGRvbWFpbnNfbGF5b3V0LmFkZFdpZGdldChzZWxmLmRvbWFpbnNfbGlzdCkNCiAgICAgICAgICAgIHNwbGl0dGVyLmFkZFdpZGdldChkb21haW5zX2dyb3VwKQ0KICAgICAgICAgICAgYnV0dG9uc19sYXlvdXQgPSBRSEJveExheW91dCgpDQogICAgICAgICAgICBzYXZlX3Jlc3VsdHNfYnRuID0gUVB1c2hCdXR0b24oIlNhdmUgUmVzdWx0cyIpDQogICAgICAgICAgICBzYXZlX3Jlc3VsdHNfYnRuLmNsaWNrZWQuY29ubmVjdChzZWxmLnNhdmVfcmVzdWx0c19tYW51YWwpDQogICAgICAgICAgICBjbGVhcl9idG4gPSBRUHVzaEJ1dHRvbigiQ2xlYXIgUmVzdWx0cyIpDQogICAgICAgICAgICBjbGVhcl9idG4uY2xpY2tlZC5jb25uZWN0KHNlbGYuY2xlYXJfcmVzdWx0cykNCiAgICAgICAgICAgIGJ1dHRvbnNfbGF5b3V0LmFkZFdpZGdldChzYXZlX3Jlc3VsdHNfYnRuKQ0KICAgICAgICAgICAgYnV0dG9uc19sYXlvdXQuYWRkV2lkZ2V0KGNsZWFyX2J0bikNCiAgICAgICAgICAgIGJ1dHRvbnNfbGF5b3V0LmFkZFN0cmV0Y2goKQ0KICAgICAgICAgICAgbGF5b3V0LmFkZFdpZGdldChzcGxpdHRlcikNCiAgICAgICAgICAgIGxheW91dC5hZGRMYXlvdXQoYnV0dG9uc19sYXlvdXQpDQoNCiAgICAgICAgZGVmIGNyZWF0ZV9zdWJkb21haW5zX3RhYihzZWxmKToNCiAgICAgICAgICAgIHN1YmRvbWFpbnNfdGFiID0gUVdpZGdldCgpDQogICAgICAgICAgICBzZWxmLnRhYnMuYWRkVGFiKHN1YmRvbWFpbnNfdGFiLCAiU3ViZG9tYWlucyIpDQogICAgICAgICAgICBsYXlvdXQgPSBRVkJveExheW91dChzdWJkb21haW5zX3RhYikNCiAgICAgICAgICAgIHNlbGYuc3ViZG9tYWluc19saXN0ID0gUVRhYmxlV2lkZ2V0KDAsIDYpDQogICAgICAgICAgICBzZWxmLnN1YmRvbWFpbnNfbGlzdC5zZXRIb3Jpem9udGFsSGVhZGVyTGFiZWxzKFsiU3ViZG9tYWluIiwgIlRpdGxlIiwgIkEgUmVjb3JkcyIsICJXUCBWZXJzaW9uIiwgIkVuZHBvaW50cy9QbHVnaW5zIiwgIkV4cG9zZWQgRmlsZXMvQXV0aG9ycyJdKQ0KICAgICAgICAgICAgaGVhZGVyID0gc2VsZi5zdWJkb21haW5zX2xpc3QuaG9yaXpvbnRhbEhlYWRlcigpDQogICAgICAgICAgICBoZWFkZXIuc2V0U2VjdGlvblJlc2l6ZU1vZGUoMCwgUUhlYWRlclZpZXcuU3RyZXRjaCkNCiAgICAgICAgICAgIGhlYWRlci5zZXRTZWN0aW9uUmVzaXplTW9kZSgxLCBRSGVhZGVyVmlldy5TdHJldGNoKQ0KICAgICAgICAgICAgaGVhZGVyLnNldFNlY3Rpb25SZXNpemVNb2RlKDQsIFFIZWFkZXJWaWV3LlN0cmV0Y2gpDQogICAgICAgICAgICBoZWFkZXIuc2V0U2VjdGlvblJlc2l6ZU1vZGUoNSwgUUhlYWRlclZpZXcuU3RyZXRjaCkNCiAgICAgICAgICAgIHNlbGYuc3ViZG9tYWluc19saXN0LnNldFNlbGVjdGlvbkJlaGF2aW9yKFFBYnN0cmFjdEl0ZW1WaWV3LlNlbGVjdFJvd3MpDQogICAgICAgICAgICBsYXlvdXQuYWRkV2lkZ2V0KHNlbGYuc3ViZG9tYWluc19saXN0KQ0KICAgICAgICAgICAgYnV0dG9uc19sYXlvdXQgPSBRSEJveExheW91dCgpDQogICAgICAgICAgICBzYXZlX3N1YmRvbWFpbnNfYnRuID0gUVB1c2hCdXR0b24oIlNhdmUgU3ViZG9tYWlucyIpDQogICAgICAgICAgICBzYXZlX3N1YmRvbWFpbnNfYnRuLmNsaWNrZWQuY29ubmVjdChzZWxmLnNhdmVfc3ViZG9tYWluc19tYW51YWwpDQogICAgICAgICAgICBjbGVhcl9idG4gPSBRUHVzaEJ1dHRvbigiQ2xlYXIgU3ViZG9tYWlucyIpDQogICAgICAgICAgICBjbGVhcl9idG4uY2xpY2tlZC5jb25uZWN0KGxhbWJkYTogc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0Um93Q291bnQoMCkpDQogICAgICAgICAgICBidXR0b25zX2xheW91dC5hZGRXaWRnZXQoc2F2ZV9zdWJkb21haW5zX2J0bikNCiAgICAgICAgICAgIGJ1dHRvbnNfbGF5b3V0LmFkZFdpZGdldChjbGVhcl9idG4pDQogICAgICAgICAgICBidXR0b25zX2xheW91dC5hZGRTdHJldGNoKCkNCiAgICAgICAgICAgIGxheW91dC5hZGRMYXlvdXQoYnV0dG9uc19sYXlvdXQpDQoNCiAgICAgICAgZGVmIGNyZWF0ZV9zZXR0aW5nc190YWIoc2VsZik6DQogICAgICAgICAgICBzZXR0aW5nc190YWIgPSBRV2lkZ2V0KCkNCiAgICAgICAgICAgIHNlbGYudGFicy5hZGRUYWIoc2V0dGluZ3NfdGFiLCAiU2V0dGluZ3MiKQ0KICAgICAgICAgICAgbGF5b3V0ID0gUVZCb3hMYXlvdXQoc2V0dGluZ3NfdGFiKQ0KICAgICAgICAgICAgc2Nyb2xsX2FyZWEgPSBRU2Nyb2xsQXJlYSgpDQogICAgICAgICAgICBzY3JvbGxfYXJlYS5zZXRXaWRnZXRSZXNpemFibGUoVHJ1ZSkNCiAgICAgICAgICAgIHNldHRpbmdzX3dpZGdldCA9IFFXaWRnZXQoKQ0KICAgICAgICAgICAgc2V0dGluZ3NfbGF5b3V0ID0gUVZCb3hMYXlvdXQoc2V0dGluZ3Nfd2lkZ2V0KQ0KICAgICAgICAgICAgc2Nhbl9ncm91cCA9IFFHcm91cEJveCgiU2NhbiBTZXR0aW5ncyIpDQogICAgICAgICAgICBzY2FuX2xheW91dCA9IFFGb3JtTGF5b3V0KHNjYW5fZ3JvdXApDQogICAgICAgICAgICBzZWxmLnRpbWVvdXRfc3BpbiA9IFFTcGluQm94KCkNCiAgICAgICAgICAgIHNlbGYudGltZW91dF9zcGluLnNldFJhbmdlKDUsIDYwKQ0KICAgICAgICAgICAgc2VsZi50aW1lb3V0X3NwaW4uc2V0U3VmZml4KCIgcyIpDQogICAgICAgICAgICBzZWxmLndvcmtlcnNfc3BpbiA9IFFTcGluQm94KCkNCiAgICAgICAgICAgIHNlbGYud29ya2Vyc19zcGluLnNldFJhbmdlKDEsIDIwMCkgIyBJbmNyZWFzZWQgcmFuZ2UNCiAgICAgICAgICAgIHNlbGYuZGVidWdfY2hlY2sgPSBRQ2hlY2tCb3goIkVuYWJsZSBEZWJ1ZyBMb2dnaW5nIikNCiAgICAgICAgICAgIHNlbGYuc3ViZG9tYWluX2NoZWNrID0gUUNoZWNrQm94KCJFbmFibGUgTGl2ZSBTdWJkb21haW4gU2Nhbm5pbmciKQ0KICAgICAgICAgICAgc2Nhbl9sYXlvdXQuYWRkUm93KCJOZXR3b3JrIFRpbWVvdXQ6Iiwgc2VsZi50aW1lb3V0X3NwaW4pDQogICAgICAgICAgICBzY2FuX2xheW91dC5hZGRSb3coIk1heCBDb25jdXJyZW50IFdvcmtlcnM6Iiwgc2VsZi53b3JrZXJzX3NwaW4pDQogICAgICAgICAgICBzY2FuX2xheW91dC5hZGRSb3coc2VsZi5kZWJ1Z19jaGVjaykNCiAgICAgICAgICAgIHNjYW5fbGF5b3V0LmFkZFJvdyhzZWxmLnN1YmRvbWFpbl9jaGVjaykNCiAgICAgICAgICAgIHNldHRpbmdzX2xheW91dC5hZGRXaWRnZXQoc2Nhbl9ncm91cCkNCiAgICAgICAgICAgIGdlbWluaV9ncm91cCA9IFFHcm91cEJveCgiR2VtaW5pIEFJIFNldHRpbmdzIikNCiAgICAgICAgICAgIGdlbWluaV9sYXlvdXQgPSBRRm9ybUxheW91dChnZW1pbmlfZ3JvdXApDQogICAgICAgICAgICBzZWxmLmdlbWluaV9hcGlfbGluZSA9IFFMaW5lRWRpdCgpDQogICAgICAgICAgICBzZWxmLmdlbWluaV9hcGlfbGluZS5zZXRFY2hvTW9kZShRTGluZUVkaXQuUGFzc3dvcmQpDQogICAgICAgICAgICBzZWxmLmdlbWluaV9tb2RlbF9saW5lID0gUUxpbmVFZGl0KCkNCiAgICAgICAgICAgIHNlbGYuYWlfZG9ya19jaGVjayA9IFFDaGVja0JveCgiVXNlIEdlbWluaSB0byBnZW5lcmF0ZSBhZGRpdGlvbmFsIGRvcmtzIikNCiAgICAgICAgICAgIGdlbWluaV9sYXlvdXQuYWRkUm93KCJHZW1pbmkgQVBJIEtleToiLCBzZWxmLmdlbWluaV9hcGlfbGluZSkNCiAgICAgICAgICAgIGdlbWluaV9sYXlvdXQuYWRkUm93KCJHZW1pbmkgTW9kZWw6Iiwgc2VsZi5nZW1pbmlfbW9kZWxfbGluZSkNCiAgICAgICAgICAgIGdlbWluaV9sYXlvdXQuYWRkUm93KHNlbGYuYWlfZG9ya19jaGVjaykNCiAgICAgICAgICAgIHNldHRpbmdzX2xheW91dC5hZGRXaWRnZXQoZ2VtaW5pX2dyb3VwKQ0KICAgICAgICAgICAgc2V0dGluZ3NfbGF5b3V0LmFkZFN0cmV0Y2goKQ0KICAgICAgICAgICAgc2F2ZV9idG4gPSBRUHVzaEJ1dHRvbigiU2F2ZSBTZXR0aW5ncyIpDQogICAgICAgICAgICBzYXZlX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5zYXZlX3NldHRpbmdzKQ0KICAgICAgICAgICAgc2V0dGluZ3NfbGF5b3V0LmFkZFdpZGdldChzYXZlX2J0biwgMCwgUXQuQWxpZ25SaWdodCkNCiAgICAgICAgICAgIHNjcm9sbF9hcmVhLnNldFdpZGdldChzZXR0aW5nc193aWRnZXQpDQogICAgICAgICAgICBsYXlvdXQuYWRkV2lkZ2V0KHNjcm9sbF9hcmVhKQ0KDQogICAgICAgIGRlZiBjcmVhdGVfbG9nX3RhYihzZWxmKToNCiAgICAgICAgICAgIGxvZ190YWIgPSBRV2lkZ2V0KCkNCiAgICAgICAgICAgIHNlbGYudGFicy5hZGRUYWIobG9nX3RhYiwgIkFjdGl2aXR5IExvZyIpDQogICAgICAgICAgICBsYXlvdXQgPSBRVkJveExheW91dChsb2dfdGFiKQ0KICAgICAgICAgICAgc2VsZi5sb2dfdGV4dCA9IFFUZXh0RWRpdCgpDQogICAgICAgICAgICBzZWxmLmxvZ190ZXh0LnNldFJlYWRPbmx5KFRydWUpDQogICAgICAgICAgICBjbGVhcl9idG4gPSBRUHVzaEJ1dHRvbigiQ2xlYXIgTG9nIikNCiAgICAgICAgICAgIGNsZWFyX2J0bi5jbGlja2VkLmNvbm5lY3Qoc2VsZi5sb2dfdGV4dC5jbGVhcikNCiAgICAgICAgICAgIGxheW91dC5hZGRXaWRnZXQoc2VsZi5sb2dfdGV4dCkNCiAgICAgICAgICAgIGxheW91dC5hZGRXaWRnZXQoY2xlYXJfYnRuLCAwLCBRdC5BbGlnblJpZ2h0KQ0KDQogICAgICAgIGRlZiBhcHBseV9kYXJrX3RoZW1lKHNlbGYpOg0KICAgICAgICAgICAgc2VsZi5zZXRTdHlsZVNoZWV0KCIiIg0KICAgICAgICAgICAgICAgIFFXaWRnZXQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMUEyMDJDOyBjb2xvcjogI0UyRThGMDsgZm9udC1mYW1pbHk6IFNlZ29lIFVJLCBzYW5zLXNlcmlmOyB9DQogICAgICAgICAgICAgICAgUU1haW5XaW5kb3cgeyBib3JkZXI6IDFweCBzb2xpZCAjNEE1NTY4OyB9DQogICAgICAgICAgICAgICAgUUdyb3VwQm94IHsgbWFyZ2luLXRvcDogMWV4OyBmb250LXdlaWdodDogYm9sZDsgYmFja2dyb3VuZDogIzJEMzc0ODsgYm9yZGVyOiAxcHggc29saWQgIzRBNTU2ODsgYm9yZGVyLXJhZGl1czogNnB4OyB9DQogICAgICAgICAgICAgICAgUUdyb3VwQm94Ojp0aXRsZSB7IHN1YmNvbnRyb2wtb3JpZ2luOiBtYXJnaW47IHBhZGRpbmc6IDAgNXB4OyB9DQogICAgICAgICAgICAgICAgUUxpbmVFZGl0LCBRVGV4dEVkaXQsIFFTcGluQm94IHsgYmFja2dyb3VuZC1jb2xvcjogIzJEMzc0ODsgYm9yZGVyOiAxcHggc29saWQgIzRBNTU2ODsgYm9yZGVyLXJhZGl1czogNHB4OyBwYWRkaW5nOiA1cHg7IH0NCiAgICAgICAgICAgICAgICBRTGluZUVkaXQ6Zm9jdXMsIFFUZXh0RWRpdDpmb2N1cywgUVNwaW5Cb3g6Zm9jdXMgeyBib3JkZXI6IDFweCBzb2xpZCAjNDI5OUUxOyB9DQogICAgICAgICAgICAgICAgUVB1c2hCdXR0b24geyBiYWNrZ3JvdW5kLWNvbG9yOiAjNEE1NTY4OyBib3JkZXI6IG5vbmU7IGJvcmRlci1yYWRpdXM6IDRweDsgcGFkZGluZzogOHB4IDE2cHg7IGZvbnQtd2VpZ2h0OiBib2xkOyB9DQogICAgICAgICAgICAgICAgUVB1c2hCdXR0b246aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjNzE4MDk2OyB9DQogICAgICAgICAgICAgICAgUVB1c2hCdXR0b246cHJlc3NlZCB7IGJhY2tncm91bmQtY29sb3I6ICMyRDM3NDg7IH0NCiAgICAgICAgICAgICAgICBRVGFiV2lkZ2V0OjpwYW5lIHsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICM0QTU1Njg7IG1hcmdpbi10b3A6IC0xcHg7fQ0KICAgICAgICAgICAgICAgIFFUYWJCYXI6OnRhYiB7IGJhY2tncm91bmQ6ICMxQTIwMkM7IGJvcmRlcjogMXB4IHNvbGlkICM0QTU1Njg7IGJvcmRlci1ib3R0b206IG5vbmU7IHBhZGRpbmc6IDhweCAxNnB4OyB9DQogICAgICAgICAgICAgICAgUVRhYkJhcjo6dGFiOnNlbGVjdGVkIHsgYmFja2dyb3VuZDogIzJEMzc0ODsgY29sb3I6ICNGRkZGRkY7IH0NCiAgICAgICAgICAgICAgICBRVGFibGVXaWRnZXQgeyBncmlkbGluZS1jb2xvcjogIzRBNTU2ODsgYmFja2dyb3VuZC1jb2xvcjogIzJEMzc0ODsgfQ0KICAgICAgICAgICAgICAgIFFIZWFkZXJWaWV3OjpzZWN0aW9uIHsgYmFja2dyb3VuZC1jb2xvcjogIzRBNTU2ODsgcGFkZGluZzogNHB4OyBib3JkZXI6IDFweCBzb2xpZCAjMkQzNzQ4OyBmb250LXdlaWdodDogYm9sZDt9DQogICAgICAgICAgICAgICAgUVByb2dyZXNzQmFyIHsgYm9yZGVyLXJhZGl1czogNHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOiAjRkZGRkZGOyBmb250LXdlaWdodDogYm9sZDsgfQ0KICAgICAgICAgICAgICAgIFFQcm9ncmVzc0Jhcjo6Y2h1bmsgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMzhBMTY5OyBib3JkZXItcmFkaXVzOiAzcHg7IH0NCiAgICAgICAgICAgICAgICBRU2Nyb2xsQXJlYSB7IGJvcmRlcjogbm9uZTsgfQ0KICAgICAgICAgICAgIiIiKQ0KDQogICAgICAgIGRlZiBsb2FkX3NldHRpbmdzKHNlbGYpOg0KICAgICAgICAgICAgY29uZmlnID0gc2VsZi5zY2FubmVyLmNvbmZpZw0KICAgICAgICAgICAgc2VsZi50aW1lb3V0X3NwaW4uc2V0VmFsdWUoY29uZmlnLmdldCgndGltZW91dCcsIDIwKSkNCiAgICAgICAgICAgIHNlbGYud29ya2Vyc19zcGluLnNldFZhbHVlKGNvbmZpZy5nZXQoJ21heF93b3JrZXJzJywgNTApKQ0KICAgICAgICAgICAgc2VsZi5kZWJ1Z19jaGVjay5zZXRDaGVja2VkKGNvbmZpZy5nZXQoJ2RlYnVnX21vZGUnLCBUcnVlKSkNCiAgICAgICAgICAgIHNlbGYuc3ViZG9tYWluX2NoZWNrLnNldENoZWNrZWQoY29uZmlnLmdldCgnc3ViZG9tYWluX3NjYW4nLCBUcnVlKSkNCiAgICAgICAgICAgIHNlbGYuZ2VtaW5pX2FwaV9saW5lLnNldFRleHQoY29uZmlnLmdldCgnZ2VtaW5pX2FwaV9rZXknLCAnJykpDQogICAgICAgICAgICBzZWxmLmdlbWluaV9tb2RlbF9saW5lLnNldFRleHQoY29uZmlnLmdldCgnZ2VtaW5pX21vZGVsJywgJ2dlbWluaS0xLjUtZmxhc2gtbGF0ZXN0JykpDQogICAgICAgICAgICBzZWxmLmFpX2RvcmtfY2hlY2suc2V0Q2hlY2tlZChjb25maWcuZ2V0KCd1c2VfZ2VtaW5pX2Zvcl9kb3JrcycsIFRydWUpKQ0KICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZSgiW0lORk9dIFNldHRpbmdzIGxvYWRlZC4iKQ0KDQogICAgICAgIGRlZiBzYXZlX3NldHRpbmdzKHNlbGYpOg0KICAgICAgICAgICAgY29uZmlnID0gc2VsZi5zY2FubmVyLmNvbmZpZw0KICAgICAgICAgICAgY29uZmlnWyd0aW1lb3V0J10gPSBzZWxmLnRpbWVvdXRfc3Bpbi52YWx1ZSgpDQogICAgICAgICAgICBjb25maWdbJ21heF93b3JrZXJzJ10gPSBzZWxmLndvcmtlcnNfc3Bpbi52YWx1ZSgpDQogICAgICAgICAgICBjb25maWdbJ2RlYnVnX21vZGUnXSA9IHNlbGYuZGVidWdfY2hlY2suaXNDaGVja2VkKCkNCiAgICAgICAgICAgIGNvbmZpZ1snc3ViZG9tYWluX3NjYW4nXSA9IHNlbGYuc3ViZG9tYWluX2NoZWNrLmlzQ2hlY2tlZCgpDQogICAgICAgICAgICBjb25maWdbJ2dlbWluaV9hcGlfa2V5J10gPSBzZWxmLmdlbWluaV9hcGlfbGluZS50ZXh0KCkNCiAgICAgICAgICAgIGNvbmZpZ1snZ2VtaW5pX21vZGVsJ10gPSBzZWxmLmdlbWluaV9tb2RlbF9saW5lLnRleHQoKQ0KICAgICAgICAgICAgY29uZmlnWyd1c2VfZ2VtaW5pX2Zvcl9kb3JrcyddID0gc2VsZi5haV9kb3JrX2NoZWNrLmlzQ2hlY2tlZCgpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKCJjb25maWcuanNvbiIsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wKGNvbmZpZywgZiwgaW5kZW50PTQpDQogICAgICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZSgiW1NVQ0NFU1NdIFNldHRpbmdzIHNhdmVkLiIpDQogICAgICAgICAgICAgICAgc2VsZi5zY2FubmVyID0gV29yZFByZXNzU2Nhbm5lcihjb25maWcpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgUU1lc3NhZ2VCb3guY3JpdGljYWwoc2VsZiwgIkVycm9yIiwgZiJDb3VsZCBub3Qgc2F2ZSBzZXR0aW5nczoge2V9IikNCg0KICAgICAgICBkZWYgZ2VuZXJhdGVfZG9ya3Moc2VsZik6DQogICAgICAgICAgICBrZXl3b3JkcyA9IFtrLnN0cmlwKCkgZm9yIGsgaW4gc2VsZi5rZXl3b3Jkc190ZXh0LnRvUGxhaW5UZXh0KCkuc3RyaXAoKS5zcGxpdCgnXG4nKSBpZiBrLnN0cmlwKCldDQogICAgICAgICAgICBwYXR0ZXJucyA9IFtwLnN0cmlwKCkgZm9yIHAgaW4gc2VsZi5wYXR0ZXJuc190ZXh0LnRvUGxhaW5UZXh0KCkuc3RyaXAoKS5zcGxpdCgnXG4nKSBpZiBwLnN0cmlwKCldDQogICAgICAgICAgICBpZiBub3Qga2V5d29yZHM6DQogICAgICAgICAgICAgICAgUU1lc3NhZ2VCb3gud2FybmluZyhzZWxmLCAiSW5wdXQgTmVlZGVkIiwgIlBsZWFzZSBlbnRlciBhdCBsZWFzdCBvbmUga2V5d29yZC4iKQ0KICAgICAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgICAgICBiYXNlX2RvcmtzID0gc2VsZi5zY2FubmVyLmdlbmVyYXRlX2RvcmtzX2Zyb21fa2V5d29yZHMoa2V5d29yZHMsIHBhdHRlcm5zKQ0KICAgICAgICAgICAgc2VsZi5wcmV2aWV3X3RleHQuc2V0VGV4dCgiXG4iLmpvaW4oYmFzZV9kb3JrcykpDQogICAgICAgICAgICBzZWxmLnByZXZpZXdfY291bnRfbGFiZWwuc2V0VGV4dChmIntsZW4oYmFzZV9kb3Jrcyl9IGJhc2UgZG9ya3MgZ2VuZXJhdGVkLiIpDQogICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKGYiW0lORk9dIEdlbmVyYXRlZCB7bGVuKGJhc2VfZG9ya3MpfSBkb3JrcyBmcm9tIHBhdHRlcm5zLiIpDQoNCiAgICAgICAgICAgIGlmIHNlbGYuYWlfZG9ya19jaGVjay5pc0NoZWNrZWQoKSBhbmQgc2VsZi5nZW1pbmlfYXBpX2xpbmUudGV4dCgpOg0KICAgICAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltJTkZPXSBHZW5lcmF0aW5nIGFkZGl0aW9uYWwgZG9ya3Mgd2l0aCBHZW1pbmkuLi4iKQ0KICAgICAgICAgICAgICAgIHNlbGYuZ2VtaW5pX3dvcmtlciA9IEdlbWluaURvcmtXb3JrZXIoc2VsZi5nZW1pbmlfYXBpX2xpbmUudGV4dCgpLCBzZWxmLmdlbWluaV9tb2RlbF9saW5lLnRleHQoKSwga2V5d29yZHMsIDUwKQ0KICAgICAgICAgICAgICAgIHNlbGYuZ2VtaW5pX3dvcmtlci5zaWduYWxzLmxvZ19tZXNzYWdlLmNvbm5lY3Qoc2VsZi5sb2dfbWVzc2FnZSkNCiAgICAgICAgICAgICAgICBzZWxmLmdlbWluaV93b3JrZXIuc2lnbmFscy5kb3Jrc19nZW5lcmF0ZWQuY29ubmVjdChzZWxmLmFkZF9haV9kb3JrcykNCiAgICAgICAgICAgICAgICBzZWxmLmdlbWluaV93b3JrZXIuc3RhcnQoKQ0KDQogICAgICAgIGRlZiBhZGRfYWlfZG9ya3Moc2VsZiwgYWlfZG9ya3MpOg0KICAgICAgICAgICAgaWYgbm90IGFpX2RvcmtzOg0KICAgICAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltXQVJOXSBHZW1pbmkgZGlkIG5vdCByZXR1cm4gYW55IGRvcmtzLiIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoZiJbU1VDQ0VTU10gR2VtaW5pIGdlbmVyYXRlZCB7bGVuKGFpX2RvcmtzKX0gYWRkaXRpb25hbCBkb3Jrcy4iKQ0KICAgICAgICAgICAgY3VycmVudF9kb3JrcyA9IHNldChzZWxmLnNjYW5uZXIuZG9ya3MpDQogICAgICAgICAgICBjdXJyZW50X2RvcmtzLnVwZGF0ZShhaV9kb3JrcykNCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lci5kb3JrcyA9IHNvcnRlZChsaXN0KGN1cnJlbnRfZG9ya3MpKQ0KICAgICAgICAgICAgc2VsZi5wcmV2aWV3X3RleHQuc2V0VGV4dCgiXG4iLmpvaW4oc2VsZi5zY2FubmVyLmRvcmtzKSkNCiAgICAgICAgICAgIHNlbGYucHJldmlld19jb3VudF9sYWJlbC5zZXRUZXh0KGYie2xlbihzZWxmLnNjYW5uZXIuZG9ya3MpfSB0b3RhbCBkb3JrcyBnZW5lcmF0ZWQuIikNCg0KICAgICAgICBkZWYgc3RhcnRfc2NhbihzZWxmKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oImNvbmZpZy5qc29uIiwgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOiBjZmcgPSBqc29uLmxvYWQoZikNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246IGNmZyA9IHNlbGYuc2Nhbm5lci5jb25maWcNCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lciA9IFdvcmRQcmVzc1NjYW5uZXIoY2ZnKQ0KICAgICAgICAgICAgaWYgbm90IHNlbGYuc2Nhbm5lci5kb3JrczoNCiAgICAgICAgICAgICAgICBzZWxmLmdlbmVyYXRlX2RvcmtzKCkNCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5zY2FubmVyLmRvcmtzOg0KICAgICAgICAgICAgICAgICAgICBRTWVzc2FnZUJveC53YXJuaW5nKHNlbGYsICJDYW5ub3QgU3RhcnQgU2NhbiIsICJQbGVhc2UgZ2VuZXJhdGUgZG9ya3MgYmVmb3JlIHN0YXJ0aW5nLiIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgc2VsZi53b3JrZXIgPSBTY2FubmVyV29ya2VyKHNlbGYuc2Nhbm5lcikNCiAgICAgICAgICAgIHNlbGYud29ya2VyLnNpZ25hbHMubG9nX21lc3NhZ2UuY29ubmVjdChzZWxmLmxvZ19tZXNzYWdlKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXIuc2lnbmFscy5sb2dfbWVzc2FnZXMuY29ubmVjdChzZWxmLmFkZF9sb2dfbWVzc2FnZXNfYmF0Y2gpDQogICAgICAgICAgICBzZWxmLndvcmtlci5zaWduYWxzLnJlc3VsdHNfZm91bmQuY29ubmVjdChzZWxmLmFkZF9yZXN1bHRzX2JhdGNoKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXIuc2lnbmFscy5zdWJkb21haW5zX2ZvdW5kLmNvbm5lY3Qoc2VsZi5hZGRfc3ViZG9tYWluc19iYXRjaCkNCiAgICAgICAgICAgIHNlbGYud29ya2VyLnNpZ25hbHMuc2Nhbl9wcm9ncmVzcy5jb25uZWN0KHNlbGYudXBkYXRlX3Byb2dyZXNzKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXIuc2lnbmFscy5zY2FubmluZ19zdG9wcGVkLmNvbm5lY3Qoc2VsZi5vbl9zY2FuX3N0b3ApDQogICAgICAgICAgICBzZWxmLnN0YXJ0X2J0bi5zZXRFbmFibGVkKEZhbHNlKQ0KICAgICAgICAgICAgc2VsZi5zdG9wX2J0bi5zZXRFbmFibGVkKFRydWUpDQogICAgICAgICAgICBzZWxmLndvcmtlci5zdGFydCgpDQoNCiAgICAgICAgZGVmIHN0b3Bfc2NhbihzZWxmKToNCiAgICAgICAgICAgIGlmIHNlbGYud29ya2VyIGFuZCBzZWxmLndvcmtlci5pc1J1bm5pbmcoKToNCiAgICAgICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKCJbSU5GT10gU3RvcHBpbmcgc2Nhbi4uLiBQbGVhc2Ugd2FpdC4iKQ0KICAgICAgICAgICAgICAgIHNlbGYud29ya2VyLnN0b3AoKQ0KICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9idG4uc2V0RW5hYmxlZChGYWxzZSkNCg0KICAgICAgICBkZWYgbG9nX21lc3NhZ2Uoc2VsZiwgbWVzc2FnZTogc3RyKToNCiAgICAgICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpDQogICAgICAgICAgICBzZWxmLmxvZ190ZXh0LmFwcGVuZChmIlt7dGltZXN0YW1wfV0ge21lc3NhZ2V9IikNCg0KICAgICAgICBkZWYgYWRkX2xvZ19tZXNzYWdlc19iYXRjaChzZWxmLCBtZXNzYWdlczogbGlzdCk6DQogICAgICAgICAgICB0aW1lc3RhbXBlZF9tZXNzYWdlcyA9IFtmIlt7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIOiVNOiVTJyl9XSB7bXNnfSIgZm9yIG1zZyBpbiBtZXNzYWdlc10NCiAgICAgICAgICAgIHNlbGYubG9nX3RleHQuYXBwZW5kKCJcbiIuam9pbih0aW1lc3RhbXBlZF9tZXNzYWdlcykpDQogICAgICAgICAgICBzZWxmLmxvZ190ZXh0LnZlcnRpY2FsU2Nyb2xsQmFyKCkuc2V0VmFsdWUoc2VsZi5sb2dfdGV4dC52ZXJ0aWNhbFNjcm9sbEJhcigpLm1heGltdW0oKSkNCg0KICAgICAgICBkZWYgYWRkX3Jlc3VsdHNfYmF0Y2goc2VsZiwgcmVzdWx0czogbGlzdCk6DQogICAgICAgICAgICBzZWxmLnVybHNfbGlzdC5zZXRVcGRhdGVzRW5hYmxlZChGYWxzZSkNCiAgICAgICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKEZhbHNlKQ0KICAgICAgICAgICAgZXhpc3RpbmdfZG9tYWlucyA9IHtzZWxmLmRvbWFpbnNfbGlzdC5pdGVtKHIsIDApLnRleHQoKSBmb3IgciBpbiByYW5nZShzZWxmLmRvbWFpbnNfbGlzdC5yb3dDb3VudCgpKSBpZiBzZWxmLmRvbWFpbnNfbGlzdC5pdGVtKHIsIDApfQ0KICAgICAgICAgICAgZm9yIHVybCwgZG9tYWluIGluIHJlc3VsdHM6DQogICAgICAgICAgICAgICAgc2VsZi5hZGRfaXRlbV90b190YWJsZShzZWxmLnVybHNfbGlzdCwgW3VybF0pDQogICAgICAgICAgICAgICAgaWYgZG9tYWluIG5vdCBpbiBleGlzdGluZ19kb21haW5zOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLmFkZF9pdGVtX3RvX3RhYmxlKHNlbGYuZG9tYWluc19saXN0LCBbZG9tYWluXSkNCiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdfZG9tYWlucy5hZGQoZG9tYWluKQ0KICAgICAgICAgICAgc2VsZi51cmxzX2xpc3Quc2V0VXBkYXRlc0VuYWJsZWQoVHJ1ZSkNCiAgICAgICAgICAgIHNlbGYuZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKFRydWUpDQogICAgICAgICAgICBzZWxmLnVwZGF0ZV9jb3VudHMoKQ0KDQogICAgICAgIGRlZiBhZGRfc3ViZG9tYWluc19iYXRjaChzZWxmLCBzdWJkb21haW5zOiBsaXN0KToNCiAgICAgICAgICAgIHNlbGYuc3ViZG9tYWluc19saXN0LnNldFVwZGF0ZXNFbmFibGVkKEZhbHNlKQ0KICAgICAgICAgICAgZm9yIGZxZG4sIGRvbWFpbiwgaW5mbyBpbiBzdWJkb21haW5zOg0KICAgICAgICAgICAgICAgIHNjcmFwZSA9IGluZm8uZ2V0KCdzY3JhcGUnLCB7fSkNCiAgICAgICAgICAgICAgICB3cF92ZXJzaW9uID0gc2NyYXBlLmdldCgnd3BfdmVyc2lvbicpDQogICAgICAgICAgICAgICAgZW5kcG9pbnRzID0gW2sgZm9yIGssIHYgaW4gc2NyYXBlLmdldCgnZW5kcG9pbnRzJywge30pLml0ZW1zKCkgaWYgdl0NCiAgICAgICAgICAgICAgICBwbHVnaW5zID0gc2NyYXBlLmdldCgncGx1Z2lucycsIFtdKQ0KICAgICAgICAgICAgICAgIHRoZW1lcyA9IHNjcmFwZS5nZXQoJ3RoZW1lcycsIFtdKQ0KICAgICAgICAgICAgICAgIGF1dGhvcnMgPSBzY3JhcGUuZ2V0KCdhdXRob3JzJywgW10pDQogICAgICAgICAgICAgICAgZXhwb3NlZCA9IHNjcmFwZS5nZXQoJ2V4cG9zZWRfZmlsZXMnLCBbXSkNCg0KICAgICAgICAgICAgICAgIGVuZHBvaW50c19wbHVnaW5zID0gW10NCiAgICAgICAgICAgICAgICBpZiBlbmRwb2ludHM6IGVuZHBvaW50c19wbHVnaW5zLmFwcGVuZCgiLCIuam9pbihlbmRwb2ludHMpKQ0KICAgICAgICAgICAgICAgIGlmIHBsdWdpbnM6IGVuZHBvaW50c19wbHVnaW5zLmFwcGVuZCgicGx1Z2luczoiICsgIiwiLmpvaW4ocGx1Z2lucykpDQogICAgICAgICAgICAgICAgaWYgdGhlbWVzOiBlbmRwb2ludHNfcGx1Z2lucy5hcHBlbmQoInRoZW1lczoiICsgIiwiLmpvaW4odGhlbWVzKSkNCg0KICAgICAgICAgICAgICAgIGV4cG9zZWRfYXV0aG9ycyA9IFtdDQogICAgICAgICAgICAgICAgaWYgZXhwb3NlZDogZXhwb3NlZF9hdXRob3JzLmFwcGVuZCgiZmlsZXM6IiArICIsIi5qb2luKG9zLnBhdGguYmFzZW5hbWUocCkgZm9yIHAgaW4gZXhwb3NlZCkpDQogICAgICAgICAgICAgICAgaWYgYXV0aG9yczogZXhwb3NlZF9hdXRob3JzLmFwcGVuZCgiYXV0aG9yczoiICsgIiwiLmpvaW4oYXV0aG9ycykpDQoNCiAgICAgICAgICAgICAgICBzZWxmLmFkZF9pdGVtX3RvX3RhYmxlKHNlbGYuc3ViZG9tYWluc19saXN0LCBbDQogICAgICAgICAgICAgICAgICAgIGZxZG4sIGluZm8uZ2V0KCd0aXRsZScsICdOL0EnKSwgIiwgIi5qb2luKGluZm8uZ2V0KCdBJywgW10pKSwNCiAgICAgICAgICAgICAgICAgICAgd3BfdmVyc2lvbiBvciAiIiwgIjsgIi5qb2luKGVuZHBvaW50c19wbHVnaW5zKSwgIjsgIi5qb2luKGV4cG9zZWRfYXV0aG9ycykNCiAgICAgICAgICAgICAgICBdKQ0KICAgICAgICAgICAgc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0VXBkYXRlc0VuYWJsZWQoVHJ1ZSkNCg0KICAgICAgICBkZWYgdXBkYXRlX3Byb2dyZXNzKHNlbGYsIHZhbHVlLCB0b3RhbCk6DQogICAgICAgICAgICBpZiB0b3RhbCA+IDA6DQogICAgICAgICAgICAgICAgcGVyY2VudCA9IGludCgodmFsdWUgLyB0b3RhbCkgKiAxMDApDQogICAgICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19iYXIuc2V0VmFsdWUocGVyY2VudCkNCiAgICAgICAgICAgICAgICBzZWxmLnByb2dyZXNzX2Jhci5zZXRGb3JtYXQoZiJ7dmFsdWV9IC8ge3RvdGFsfSIpDQoNCiAgICAgICAgZGVmIG9uX3NjYW5fc3RvcChzZWxmLCByZWFzb246IHN0cik6DQogICAgICAgICAgICBzZWxmLnN0YXJ0X2J0bi5zZXRFbmFibGVkKFRydWUpDQogICAgICAgICAgICBzZWxmLnN0b3BfYnRuLnNldEVuYWJsZWQoRmFsc2UpDQogICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKGYiW0lORk9dIFNjYW4gZmluaXNoZWQ6IHtyZWFzb259IikNCiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfYmFyLnNldFZhbHVlKDEwMCkNCiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfYmFyLnNldEZvcm1hdCgiQ29tcGxldGVkIikNCiAgICAgICAgICAgIHNlbGYuc2Nhbm5lci5zYXZlX3Jlc3VsdHMoKQ0KICAgICAgICAgICAgc2VsZi53b3JrZXIgPSBOb25lDQoNCiAgICAgICAgZGVmIGFkZF9pdGVtX3RvX3RhYmxlKHNlbGYsIHRhYmxlLCBpdGVtX2RhdGEpOg0KICAgICAgICAgICAgcm93ID0gdGFibGUucm93Q291bnQoKQ0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0Um93KHJvdykNCiAgICAgICAgICAgIGZvciBjb2wsIHRleHQgaW4gZW51bWVyYXRlKGl0ZW1fZGF0YSk6DQogICAgICAgICAgICAgICAgdGFibGUuc2V0SXRlbShyb3csIGNvbCwgUVRhYmxlV2lkZ2V0SXRlbSh0ZXh0KSkNCg0KICAgICAgICBkZWYgdXBkYXRlX2NvdW50cyhzZWxmKToNCiAgICAgICAgICAgIHNlbGYudXJsc19sYWJlbC5zZXRUZXh0KGYiVVJMczoge3NlbGYudXJsc19saXN0LnJvd0NvdW50KCl9IikNCiAgICAgICAgICAgIHNlbGYuZG9tYWluc19sYWJlbC5zZXRUZXh0KGYiRG9tYWluczoge3NlbGYuZG9tYWluc19saXN0LnJvd0NvdW50KCl9IikNCg0KICAgICAgICBkZWYgY2xlYXJfcmVzdWx0cyhzZWxmKToNCiAgICAgICAgICAgIHNlbGYudXJsc19saXN0LnNldFJvd0NvdW50KDApDQogICAgICAgICAgICBzZWxmLmRvbWFpbnNfbGlzdC5zZXRSb3dDb3VudCgwKQ0KICAgICAgICAgICAgc2VsZi5zdWJkb21haW5zX2xpc3Quc2V0Um93Q291bnQoMCkNCiAgICAgICAgICAgIGlmIHNlbGYuc2Nhbm5lcjoNCiAgICAgICAgICAgICAgICBzZWxmLnNjYW5uZXIuZGlzY292ZXJlZF91cmxzLmNsZWFyKCkNCiAgICAgICAgICAgICAgICBzZWxmLnNjYW5uZXIuZGlzY292ZXJlZF9kb21haW5zLmNsZWFyKCkNCiAgICAgICAgICAgICAgICBzZWxmLnNjYW5uZXIuc3ViZG9tYWluX3Jlc3VsdHMuY2xlYXIoKQ0KICAgICAgICAgICAgc2VsZi51cGRhdGVfY291bnRzKCkNCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoIltJTkZPXSBDbGVhcmVkIGFsbCByZXN1bHRzLiIpDQoNCiAgICAgICAgZGVmIHNhdmVfcmVzdWx0c19tYW51YWwoc2VsZik6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoInJlc3VsdHMiLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgICAgIHVybHMgPSBbc2VsZi51cmxzX2xpc3QuaXRlbShyb3csIDApLnRleHQoKSBmb3Igcm93IGluIHJhbmdlKHNlbGYudXJsc19saXN0LnJvd0NvdW50KCkpXQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLnNjYW5uZXIuY29uZmlnWyd1cmxzX2ZpbGUnXSwgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJcbiIuam9pbih1cmxzKSkNCiAgICAgICAgICAgICAgICBkb21haW5zID0gW3NlbGYuZG9tYWluc19saXN0Lml0ZW0ocm93LCAwKS50ZXh0KCkgZm9yIHJvdyBpbiByYW5nZShzZWxmLmRvbWFpbnNfbGlzdC5yb3dDb3VudCgpKV0NCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5zY2FubmVyLmNvbmZpZ1snZG9tYWluc19maWxlJ10sICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiXG4iLmpvaW4oZG9tYWlucykpDQogICAgICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZSgiW1NVQ0NFU1NdIFVSTHMgYW5kIERvbWFpbnMgc2F2ZWQuIikNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBRTWVzc2FnZUJveC5jcml0aWNhbChzZWxmLCAiRXJyb3IiLCBmIkZhaWxlZCB0byBzYXZlIHJlc3VsdHM6IHtlfSIpDQoNCiAgICAgICAgZGVmIHNhdmVfc3ViZG9tYWluc19tYW51YWwoc2VsZik6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoInJlc3VsdHMiLCBleGlzdF9vaz1UcnVlKQ0KICAgICAgICAgICAgICAgIHN1YmRvbWFpbnMgPSBbc2VsZi5zdWJkb21haW5zX2xpc3QuaXRlbShyb3csIDApLnRleHQoKSBmb3Igcm93IGluIHJhbmdlKHNlbGYuc3ViZG9tYWluc19saXN0LnJvd0NvdW50KCkpXQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLnNjYW5uZXIuY29uZmlnWydzdWJkb21haW5zX2ZpbGUnXSwgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJcbiIuam9pbihzdWJkb21haW5zKSkNCiAgICAgICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKGYiW1NVQ0NFU1NdIFN1YmRvbWFpbnMgc2F2ZWQgdG8ge3NlbGYuc2Nhbm5lci5jb25maWdbJ3N1YmRvbWFpbnNfZmlsZSddfSIpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgUU1lc3NhZ2VCb3guY3JpdGljYWwoc2VsZiwgIkVycm9yIiwgZiJGYWlsZWQgdG8gc2F2ZSBzdWJkb21haW5zOiB7ZX0iKQ0KDQogICAgICAgIGRlZiBzZXR1cF9jb250ZXh0X21lbnVzKHNlbGYpOg0KICAgICAgICAgICAgZm9yIHRhYmxlIGluIFtzZWxmLnVybHNfbGlzdCwgc2VsZi5kb21haW5zX2xpc3QsIHNlbGYuc3ViZG9tYWluc19saXN0XToNCiAgICAgICAgICAgICAgICB0YWJsZS5zZXRDb250ZXh0TWVudVBvbGljeShRdC5DdXN0b21Db250ZXh0TWVudSkNCiAgICAgICAgICAgICAgICB0YWJsZS5jdXN0b21Db250ZXh0TWVudVJlcXVlc3RlZC5jb25uZWN0KGxhbWJkYSBwb3MsIHQ9dGFibGU6IHNlbGYuc2hvd19jb250ZXh0X21lbnUocG9zLCB0KSkNCg0KICAgICAgICBkZWYgc2hvd19jb250ZXh0X21lbnUoc2VsZiwgcG9zaXRpb24sIHRhYmxlKToNCiAgICAgICAgICAgIG1lbnUgPSBRTWVudSgpDQogICAgICAgICAgICBtZW51LnNldFN0eWxlU2hlZXQoIlFNZW51IHsgYmFja2dyb3VuZC1jb2xvcjogIzJEMzc0ODsgY29sb3I6ICNFMkU4RjA7IH0gUU1lbnU6Oml0ZW06c2VsZWN0ZWQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjNEE1NTY4OyB9IikNCiAgICAgICAgICAgIHNlbGVjdGVkX2l0ZW1zID0gdGFibGUuc2VsZWN0ZWRJdGVtcygpDQogICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWRfaXRlbXM6IHJldHVybg0KICAgICAgICAgICAgY29weV9hY3Rpb24gPSBtZW51LmFkZEFjdGlvbigiQ29weSIpDQogICAgICAgICAgICBvcGVuX2FjdGlvbiA9IG1lbnUuYWRkQWN0aW9uKCJPcGVuIGluIEJyb3dzZXIiKQ0KICAgICAgICAgICAgYWN0aW9uID0gbWVudS5leGVjXyh0YWJsZS52aWV3cG9ydCgpLm1hcFRvR2xvYmFsKHBvc2l0aW9uKSkNCiAgICAgICAgICAgIGlmIGFjdGlvbiA9PSBjb3B5X2FjdGlvbjoNCiAgICAgICAgICAgICAgICBRQXBwbGljYXRpb24uY2xpcGJvYXJkKCkuc2V0VGV4dChzZWxlY3RlZF9pdGVtc1swXS50ZXh0KCkpDQogICAgICAgICAgICBlbGlmIGFjdGlvbiA9PSBvcGVuX2FjdGlvbjoNCiAgICAgICAgICAgICAgICBpdGVtX3RleHQgPSBzZWxlY3RlZF9pdGVtc1swXS50ZXh0KCkNCiAgICAgICAgICAgICAgICB1cmwgPSBpdGVtX3RleHQgaWYgaXRlbV90ZXh0LnN0YXJ0c3dpdGgoImh0dHAiKSBlbHNlIGYiaHR0cDovL3tpdGVtX3RleHR9Ig0KICAgICAgICAgICAgICAgIHdlYmJyb3dzZXIub3Blbih1cmwpDQoNCiAgICAgICAgZGVmIGNsb3NlRXZlbnQoc2VsZiwgZXZlbnQpOg0KICAgICAgICAgICAgaWYgc2VsZi53b3JrZXIgYW5kIHNlbGYud29ya2VyLmlzUnVubmluZygpOg0KICAgICAgICAgICAgICAgIHJlcGx5ID0gUU1lc3NhZ2VCb3gucXVlc3Rpb24oc2VsZiwgJ1NjYW4gaW4gUHJvZ3Jlc3MnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkEgc2NhbiBpcyBydW5uaW5nLiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZXhpdD8iLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUU1lc3NhZ2VCb3guWWVzIHwgUU1lc3NhZ2VCb3guTm8sIFFNZXNzYWdlQm94Lk5vKQ0KICAgICAgICAgICAgICAgIGlmIHJlcGx5ID09IFFNZXNzYWdlQm94LlllczoNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zdG9wX3NjYW4oKQ0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLndvcmtlcjogc2VsZi53b3JrZXIud2FpdCgzMDAwKQ0KICAgICAgICAgICAgICAgICAgICBldmVudC5hY2NlcHQoKQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGV2ZW50Lmlnbm9yZSgpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGV2ZW50LmFjY2VwdCgpDQoNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIENMSSBGYWxsYmFjayAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KYXN5bmMgZGVmIHJ1bl9zaW1wbGVfc2Nhbl9mcm9tX2NsaShzY2FubmVyOiBXb3JkUHJlc3NTY2FubmVyLCBrZXl3b3JkczogTGlzdFtzdHJdKToNCiAgICAiIiJBIHZlcnkgc21hbGwgQ0xJIHJ1bm5lciBmb3IgcXVpY2sgc2NhbnMgd2l0aG91dCB0aGUgR1VJIChiZXN0LWVmZm9ydCkuIiIiDQogICAgc2Nhbm5lci5nZW5lcmF0ZV9kb3Jrc19mcm9tX2tleXdvcmRzKGtleXdvcmRzKQ0KICAgIHByaW50KGYiW0lORk9dIEdlbmVyYXRlZCB7bGVuKHNjYW5uZXIuZG9ya3MpfSBkb3Jrcy4gU3RhcnRpbmcgRHVja0R1Y2tHbyBxdWVyaWVzIChzZXF1ZW50aWFsKS4iKQ0KICAgIHRyeToNCiAgICAgICAgd2l0aCBEREdTKHRpbWVvdXQ9c2Nhbm5lci5jb25maWcuZ2V0KCd0aW1lb3V0JywgMTUpKSBhcyBkZGdzOg0KICAgICAgICAgICAgZm9yIGRvcmsgaW4gc2Nhbm5lci5kb3JrczoNCiAgICAgICAgICAgICAgICBwcmludChmIltGRVRDSF0ge2Rvcmt9IikNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHJlc3VsdHNfZm91bmQgPSBGYWxzZQ0KICAgICAgICAgICAgICAgICAgICBmb3IgciBpbiBkZGdzLnRleHQoZG9yaywgbWF4X3Jlc3VsdHM9MTUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gci5nZXQoJ2hyZWYnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdXJsIGFuZCAoIndwLWNvbnRlbnQiIGluIHVybCBvciAid3AtaW5jbHVkZXMiIGluIHVybCBvciAid3AtanNvbiIgaW4gdXJsKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2RvbWFpbiA9IHNjYW5uZXIuZ2V0X2Jhc2VfZG9tYWluKHVybCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1cmwgbm90IGluIHNjYW5uZXIuZGlzY292ZXJlZF91cmxzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FubmVyLmRpc2NvdmVyZWRfdXJscy5hcHBlbmQodXJsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJhc2VfZG9tYWluIG5vdCBpbiBzY2FubmVyLmRpc2NvdmVyZWRfZG9tYWluczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nhbm5lci5kaXNjb3ZlcmVkX2RvbWFpbnMuYXBwZW5kKGJhc2VfZG9tYWluKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLkdSRUVOfVtGT1VORF0ge2Jhc2VfZG9tYWlufSB2aWEge3VybH0iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzX2ZvdW5kID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVzdWx0c19mb3VuZDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie0ZvcmUuWUVMTE9XfVtJTkZPXSBObyBXb3JkUHJlc3MgVVJMcyBmb3VuZCBmb3IgdGhpcyBkb3JrLiIpDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLlJFRH1bRVJST1JdIFF1ZXJ5IGZhaWxlZCBmb3IgZG9yayAne2Rvcmt9Jzoge2V9IikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYie0ZvcmUuUkVEfVtFUlJPUl0gRHVja0R1Y2tHbyBjbGllbnQgZmFpbGVkOiB7ZX0iKQ0KDQogICAgc2Nhbm5lci5zYXZlX3Jlc3VsdHMoKQ0KICAgIHByaW50KCJbSU5GT10gQ0xJIHNjYW4gY29tcGxldGVkLiIpDQoNCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRW50cnlwb2ludCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoNCiAgICBpZiBVU0VfR1VJOg0KICAgICAgICBRQXBwbGljYXRpb24uc2V0QXR0cmlidXRlKFF0LkFBX0VuYWJsZUhpZ2hEcGlTY2FsaW5nLCBUcnVlKQ0KICAgICAgICBhcHAgPSBRQXBwbGljYXRpb24oc3lzLmFyZ3YpDQoNCiAgICAgICAgbG9nb19waXhtYXAgPSBRUGl4bWFwKCkNCiAgICAgICAgbG9nb19wYXRoID0gImxvZ28ucG5nIg0KICAgICAgICBwcmludChmIltJTkZPXSBMb29raW5nIGZvciBsb2dvIGF0OiB7b3MucGF0aC5hYnNwYXRoKGxvZ29fcGF0aCl9IikNCg0KICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMobG9nb19wYXRoKToNCiAgICAgICAgICAgIHByaW50KGYiW1dBUk5JTkddICd7bG9nb19wYXRofScgbm90IGZvdW5kLiBUaGUgYXBwbGljYXRpb24gd2lsbCBydW4gd2l0aG91dCBhIGxvZ28uIikNCiAgICAgICAgICAgIGxvZ29fcGl4bWFwID0gTm9uZQ0KICAgICAgICBlbGlmIG5vdCBsb2dvX3BpeG1hcC5sb2FkKGxvZ29fcGF0aCk6DQogICAgICAgICAgICBwcmludChmIltXQVJOSU5HXSBGb3VuZCAne2xvZ29fcGF0aH0nLCBidXQgaXQgY291bGQgbm90IGJlIGxvYWRlZC4gSXQgbWlnaHQgYmUgY29ycnVwdCBvciBub3QgYSB2YWxpZCBQTkcuIikNCiAgICAgICAgICAgIGxvZ29fcGl4bWFwID0gTm9uZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiJbU1VDQ0VTU10gTG9nbyAne2xvZ29fcGF0aH0nIGxvYWRlZCBzdWNjZXNzZnVsbHkuIikNCg0KICAgICAgICB3aW5kb3cgPSBXb3JkUHJlc3NTY2FubmVyVUkobG9nb19waXhtYXA9bG9nb19waXhtYXApDQogICAgICAgIGlmIGxvZ29fcGl4bWFwOg0KICAgICAgICAgICAgYXBwLnNldFdpbmRvd0ljb24oUUljb24obG9nb19waXhtYXApKQ0KDQogICAgICAgIHdpbmRvdy5zaG93KCkNCiAgICAgICAgc3lzLmV4aXQoYXBwLmV4ZWNfKCkpDQogICAgZWxzZToNCiAgICAgICAgcHJpbnQoIltJTkZPXSBQeVF0NSBub3QgYXZhaWxhYmxlLiBSdW5uaW5nIGluIENMSSBtb2RlLiIpDQogICAgICAgIHNjYW5uZXIgPSBXb3JkUHJlc3NTY2FubmVyKCkNCiAgICAgICAgcHJpbnQoIkVudGVyIGtleXdvcmRzIChvbmUgcGVyIGxpbmUsIGVuZCB3aXRoIGVtcHR5IGxpbmUpOiIpDQogICAgICAgIGxpbmVzID0gW10NCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgICAgICAgICBsaW5lID0gaW5wdXQoKQ0KICAgICAgICAgICAgICAgIGlmIG5vdCBsaW5lLnN0cmlwKCk6IGJyZWFrDQogICAgICAgICAgICAgICAgbGluZXMuYXBwZW5kKGxpbmUuc3RyaXAoKSkNCiAgICAgICAgZXhjZXB0IEVPRkVycm9yOiBwYXNzDQogICAgICAgIGlmIG5vdCBsaW5lczogbGluZXMgPSBbIndvcmRwcmVzcyIsICJibG9nIiwgIndwIHBsdWdpbiJdDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGFzeW5jaW8ucnVuKHJ1bl9zaW1wbGVfc2Nhbl9mcm9tX2NsaShzY2FubmVyLCBsaW5lcykpDQogICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoNCiAgICAgICAgICAgIHByaW50KCJcbltJTkZPXSBTY2FuIGludGVycnVwdGVkLiBTYXZpbmcgcmVzdWx0cy4uLiIpDQogICAgICAgICAgICBzY2FubmVyLnNhdmVfcmVzdWx0cygp"""

def main():
    try:
        decoded_code = base64.b64decode(ENCRYPTED_CODE).decode('utf-8')
        exec(decoded_code, {"__name__": "__main__", "__builtins__": __builtins__})
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
